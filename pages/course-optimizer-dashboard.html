<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Optimizer Dashboard - EWU Design</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .back-link {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-50%) translateX(-5px);
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        select, button {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .content {
            padding: 30px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
        }

        .chart-container h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .course-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 5px solid;
            transition: all 0.3s;
        }

        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .course-card.excellent {
            border-left-color: #51cf66;
        }

        .course-card.good {
            border-left-color: #74c0fc;
        }

        .course-card.fair {
            border-left-color: #ffd93d;
        }

        .course-card.poor {
            border-left-color: #ffa726;
        }

        .course-card.critical {
            border-left-color: #ff6b6b;
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .course-code {
            font-size: 1.3em;
            font-weight: bold;
            color: #212529;
        }

        .health-score {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            color: white;
        }

        .health-score.excellent {
            background: #51cf66;
        }

        .health-score.good {
            background: #74c0fc;
        }

        .health-score.fair {
            background: #ffd93d;
            color: #333;
        }

        .health-score.poor {
            background: #ffa726;
        }

        .health-score.critical {
            background: #ff6b6b;
        }

        .course-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .metric {
            font-size: 0.9em;
            color: #495057;
        }

        .metric strong {
            color: #212529;
        }

        .course-recommendation {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #667eea;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="../index.html" class="back-link">‚Üê Back to Schedule</a>
            <h1>üéì Course Optimizer Dashboard</h1>
            <p class="subtitle">Course Health Scores & Optimization Recommendations</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="courseLevel">Filter by Level:</label>
                <select id="courseLevel">
                    <option value="all">All Courses</option>
                    <option value="foundation">Foundation (100-200)</option>
                    <option value="intermediate">Intermediate (300)</option>
                    <option value="advanced">Advanced (400)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="healthFilter">Filter by Health:</label>
                <select id="healthFilter">
                    <option value="all">All Health Levels</option>
                    <option value="critical">Critical</option>
                    <option value="poor">Poor</option>
                    <option value="fair">Fair</option>
                    <option value="good">Good</option>
                    <option value="excellent">Excellent</option>
                </select>
            </div>

            <button onclick="window.location.href='../enrollment-dashboard.html'">üìä Enrollment Trends</button>
            <button onclick="window.location.href='recommendations-dashboard.html'">üí° Recommendations</button>
        </div>

        <div class="content">
            <div id="loadingMessage" class="loading">
                Analyzing course health...
            </div>

            <div id="dashboardContent" style="display: none;">
                <!-- Health Score Legend -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #51cf66;"></div>
                        <span><strong>Excellent (90-100):</strong> High enrollment, growing</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #74c0fc;"></div>
                        <span><strong>Good (75-89):</strong> Solid enrollment, stable</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #ffd93d;"></div>
                        <span><strong>Fair (60-74):</strong> Moderate concerns</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #ffa726;"></div>
                        <span><strong>Poor (40-59):</strong> Needs attention</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #ff6b6b;"></div>
                        <span><strong>Critical (<40):</strong> Immediate action required</span>
                    </div>
                </div>

                <!-- Charts -->
                <div class="dashboard-grid">
                    <div class="chart-container">
                        <h2>Course Health Distribution</h2>
                        <div class="chart-wrapper">
                            <canvas id="healthDistributionChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h2>Average Health by Course Level</h2>
                        <div class="chart-wrapper">
                            <canvas id="healthByLevelChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container full-width">
                        <h2>Course Health Scores</h2>
                        <div class="chart-wrapper">
                            <canvas id="courseHealthChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Course Cards -->
                <div class="chart-container">
                    <h2>Course Details & Recommendations</h2>
                    <div class="course-grid" id="courseGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let enrollmentData = null;

        async function loadData() {
            try {
                const response = await fetch('../enrollment-dashboard-data.json');
                if (response.ok) {
                    enrollmentData = await response.json();
                    return true;
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
            return false;
        }

        async function initDashboard() {
            const loaded = await loadData();

            if (!loaded) {
                document.getElementById('loadingMessage').innerHTML = `
                    <p style="color: #ff6b6b;">‚ö†Ô∏è Unable to load enrollment data.</p>
                `;
                return;
            }

            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('dashboardContent').style.display = 'block';

            analyzeCourses();
            setupFilters();
        }

        function calculateHealthScore(course, courseCode) {
            let score = 50; // Base score

            // Enrollment factor (0-30 points)
            if (course.average > 0) {
                if (course.average >= 20) score += 30;
                else if (course.average >= 15) score += 20;
                else if (course.average >= 10) score += 10;
                else score += 5;
            }

            // Trend factor (0-30 points)
            if (course.trend === 'growing') score += 30;
            else if (course.trend === 'stable') score += 20;
            else if (course.trend === 'declining') score += 5;

            // Capacity utilization factor (0-20 points)
            const utilization = (course.average / 24) * 100;
            if (utilization >= 75 && utilization <= 100) score += 20;
            else if (utilization >= 50 && utilization < 75) score += 15;
            else if (utilization > 100) score += 10; // Overcrowded
            else score += 5;

            // Consistency factor (0-20 points)
            if (course.sections >= 8) score += 20; // Offered frequently
            else if (course.sections >= 5) score += 15;
            else if (course.sections >= 3) score += 10;
            else score += 5;

            return Math.min(100, Math.max(0, score));
        }

        function getHealthRating(score) {
            if (score >= 90) return 'excellent';
            if (score >= 75) return 'good';
            if (score >= 60) return 'fair';
            if (score >= 40) return 'poor';
            return 'critical';
        }

        function getRecommendation(course, score, rating) {
            if (rating === 'excellent') {
                return '‚úÖ Course is performing excellently. Maintain current offering pattern.';
            } else if (rating === 'good') {
                return 'üëç Course is healthy. Monitor enrollment trends and consider minor optimizations.';
            } else if (rating === 'fair') {
                if (course.trend === 'declining') {
                    return '‚ö†Ô∏è Review course content and marketing. Consider student feedback.';
                }
                return '‚ö†Ô∏è Course shows moderate concerns. Review and adjust as needed.';
            } else if (rating === 'poor') {
                if (course.average < 12) {
                    return 'üî¥ Low enrollment. Consider offering less frequently or restructuring.';
                }
                return 'üî¥ Needs attention. Review curriculum, prerequisites, and scheduling.';
            } else {
                return '‚ùå Critical: Consider consolidation, major revision, or discontinuation.';
            }
        }

        function analyzeCourses() {
            const courses = enrollmentData.courseStats;

            const analyzed = Object.entries(courses)
                .filter(([_, data]) => !data.isNew && data.average > 0)
                .map(([code, data]) => {
                    const score = calculateHealthScore(data, code);
                    const rating = getHealthRating(score);
                    const recommendation = getRecommendation(data, score, rating);

                    return {
                        code,
                        ...data,
                        score,
                        rating,
                        recommendation
                    };
                });

            window.analyzedCourses = analyzed;

            renderHealthDistribution(analyzed);
            renderHealthByLevel(analyzed);
            renderCourseHealthChart(analyzed);
            renderCourseCards(analyzed);
        }

        function renderHealthDistribution(courses) {
            const ctx = document.getElementById('healthDistributionChart').getContext('2d');

            const distribution = {
                excellent: courses.filter(c => c.rating === 'excellent').length,
                good: courses.filter(c => c.rating === 'good').length,
                fair: courses.filter(c => c.rating === 'fair').length,
                poor: courses.filter(c => c.rating === 'poor').length,
                critical: courses.filter(c => c.rating === 'critical').length
            };

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Excellent', 'Good', 'Fair', 'Poor', 'Critical'],
                    datasets: [{
                        data: Object.values(distribution),
                        backgroundColor: [
                            'rgba(81, 207, 102, 0.8)',
                            'rgba(116, 192, 252, 0.8)',
                            'rgba(255, 217, 61, 0.8)',
                            'rgba(255, 167, 38, 0.8)',
                            'rgba(255, 107, 107, 0.8)'
                        ],
                        borderColor: ['#51cf66', '#74c0fc', '#ffd93d', '#ffa726', '#ff6b6b'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function renderHealthByLevel(courses) {
            const ctx = document.getElementById('healthByLevelChart').getContext('2d');

            const levels = {
                foundation: [],
                intermediate: [],
                advanced: []
            };

            courses.forEach(course => {
                const level = parseInt(course.code.split(' ')[1]);
                if (level < 300) levels.foundation.push(course.score);
                else if (level < 400) levels.intermediate.push(course.score);
                else levels.advanced.push(course.score);
            });

            const avgScores = {
                foundation: levels.foundation.reduce((a, b) => a + b, 0) / levels.foundation.length || 0,
                intermediate: levels.intermediate.reduce((a, b) => a + b, 0) / levels.intermediate.length || 0,
                advanced: levels.advanced.reduce((a, b) => a + b, 0) / levels.advanced.length || 0
            };

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Foundation\n(100-200)', 'Intermediate\n(300)', 'Advanced\n(400)'],
                    datasets: [{
                        label: 'Average Health Score',
                        data: Object.values(avgScores),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(81, 207, 102, 0.8)'
                        ],
                        borderColor: ['#667eea', '#764ba2', '#51cf66'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Health Score'
                            }
                        }
                    }
                }
            });
        }

        function renderCourseHealthChart(courses) {
            const ctx = document.getElementById('courseHealthChart').getContext('2d');
            const sorted = courses.sort((a, b) => b.score - a.score);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(c => c.code),
                    datasets: [{
                        label: 'Health Score',
                        data: sorted.map(c => c.score),
                        backgroundColor: sorted.map(c => {
                            const colors = {
                                excellent: 'rgba(81, 207, 102, 0.8)',
                                good: 'rgba(116, 192, 252, 0.8)',
                                fair: 'rgba(255, 217, 61, 0.8)',
                                poor: 'rgba(255, 167, 38, 0.8)',
                                critical: 'rgba(255, 107, 107, 0.8)'
                            };
                            return colors[c.rating];
                        }),
                        borderColor: sorted.map(c => {
                            const colors = {
                                excellent: '#51cf66',
                                good: '#74c0fc',
                                fair: '#ffd93d',
                                poor: '#ffa726',
                                critical: '#ff6b6b'
                            };
                            return colors[c.rating];
                        }),
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Health Score'
                            }
                        }
                    }
                }
            });
        }

        function renderCourseCards(courses) {
            const grid = document.getElementById('courseGrid');
            const sorted = courses.sort((a, b) => a.code.localeCompare(b.code));

            grid.innerHTML = sorted.map(course => `
                <div class="course-card ${course.rating}">
                    <div class="course-header">
                        <div class="course-code">${course.code}</div>
                        <div class="health-score ${course.rating}">${course.score}</div>
                    </div>
                    <div class="course-metrics">
                        <div class="metric">üìä <strong>${course.average}</strong> avg enrollment</div>
                        <div class="metric">üìà <strong>${course.trend}</strong></div>
                        <div class="metric">üë• <strong>${course.peak}</strong> peak</div>
                        <div class="metric">üìö <strong>${course.sections}</strong> sections</div>
                    </div>
                    <div class="course-recommendation">${course.recommendation}</div>
                </div>
            `).join('');
        }

        function setupFilters() {
            document.getElementById('courseLevel').addEventListener('change', filterCourses);
            document.getElementById('healthFilter').addEventListener('change', filterCourses);
        }

        function filterCourses() {
            const levelFilter = document.getElementById('courseLevel').value;
            const healthFilter = document.getElementById('healthFilter').value;

            let filtered = window.analyzedCourses;

            if (levelFilter !== 'all') {
                filtered = filtered.filter(course => {
                    const level = parseInt(course.code.split(' ')[1]);
                    if (levelFilter === 'foundation') return level < 300;
                    if (levelFilter === 'intermediate') return level >= 300 && level < 400;
                    if (levelFilter === 'advanced') return level >= 400;
                    return true;
                });
            }

            if (healthFilter !== 'all') {
                filtered = filtered.filter(course => course.rating === healthFilter);
            }

            renderCourseCards(filtered);
        }

        window.addEventListener('load', initDashboard);
    </script>
</body>
</html>
