<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Workload Dashboard - EWU Design</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .back-link {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-50%) translateX(-5px);
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        select, button {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        select:hover, select:focus {
            border-color: #667eea;
            outline: none;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .stats-bar {
            padding: 20px 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            background: #fff;
            border-bottom: 2px solid #dee2e6;
        }

        .stat-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.overloaded {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }

        .stat-card.optimal {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
            color: white;
        }

        .stat-card.underutilized {
            background: linear-gradient(135deg, #74c0fc 0%, #4dabf7 100%);
            color: white;
        }

        .stat-card.info {
            background: linear-gradient(135deg, #ffd93d 0%, #ff9f1c 100%);
            color: #333;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
        }

        .chart-container h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .workload-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .workload-table th {
            background: #495057;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .workload-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }

        .workload-table tr:hover {
            background: #f8f9fa;
        }

        .workload-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .workload-badge.overloaded {
            background: #ff6b6b;
            color: white;
        }

        .workload-badge.optimal {
            background: #51cf66;
            color: white;
        }

        .workload-badge.underutilized {
            background: #74c0fc;
            color: white;
        }

        .applied-learning-section {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }

        .applied-learning-section h2 {
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .applied-learning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .applied-learning-card {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .applied-learning-card h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .applied-learning-stat {
            margin: 8px 0;
            font-size: 1.1em;
        }

        .applied-learning-stat strong {
            font-size: 1.4em;
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #51cf66 0%, #37b24d 100%);
            transition: width 0.3s;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #ffd93d 0%, #ff9f1c 100%);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .back-link {
                position: static;
                transform: none;
                display: block;
                margin-bottom: 15px;
            }
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #667eea;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="../index.html" class="back-link">‚Üê Back to Schedule</a>
            <h1>üë• Faculty Workload Dashboard</h1>
            <p class="subtitle">EWU Design Department - Academic Workload Analysis</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="academicYearFilter">Academic Year:</label>
                <select id="academicYearFilter">
                    <option value="all">All Years (2022-2026)</option>
                    <option value="2022-23">2022-23</option>
                    <option value="2023-24">2023-24</option>
                    <option value="2024-25">2024-25</option>
                    <option value="2025-26" selected>2025-26 (Current)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="statusFilter">Filter by Status:</label>
                <select id="statusFilter">
                    <option value="all">All Faculty</option>
                    <option value="overloaded">Overloaded Only</option>
                    <option value="optimal">Optimal Only</option>
                    <option value="underutilized">Underutilized Only</option>
                </select>
            </div>

            <button onclick="window.location.href='../enrollment-dashboard.html'" style="background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);">üìö Enrollment</button>
            <button onclick="window.location.href='recommendations-dashboard.html'" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">üí° Recommendations</button>
            <button onclick="window.location.href='capacity-planning-dashboard.html'" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">üìä Capacity</button>
            <button onclick="window.location.href='course-optimizer-dashboard.html'" style="background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);">üéì Optimizer</button>
            <button onclick="exportWorkloadData()">üìä Export CSV</button>
        </div>

        <div class="stats-bar">
            <div class="stat-card info">
                <div class="stat-number" id="totalFaculty">0</div>
                <div class="stat-label">Total Faculty</div>
            </div>
            <div class="stat-card overloaded">
                <div class="stat-number" id="overloadedFaculty">0</div>
                <div class="stat-label">Overloaded (>100%)</div>
            </div>
            <div class="stat-card optimal">
                <div class="stat-number" id="optimalFaculty">0</div>
                <div class="stat-label">Optimal (60-100%)</div>
            </div>
            <div class="stat-card underutilized">
                <div class="stat-number" id="underutilizedFaculty">0</div>
                <div class="stat-label">Underutilized (<60%)</div>
            </div>
        </div>

        <div class="content">
            <div id="loadingMessage" class="loading">
                Loading workload data...
            </div>

            <div id="dashboardContent" style="display: none;">
                <div class="dashboard-grid">
                    <div class="chart-container full-width">
                        <h2>Faculty Workload Distribution</h2>
                        <div class="chart-wrapper">
                            <canvas id="workloadDistributionChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h2>Workload by Faculty (Top 10)</h2>
                        <div class="chart-wrapper">
                            <canvas id="topFacultyChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h2>Utilization Status Breakdown</h2>
                        <div class="chart-wrapper">
                            <canvas id="utilizationPieChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Applied Learning Section -->
                <div class="applied-learning-section">
                    <h2>üìö Applied Learning Workload</h2>
                    <p style="margin-bottom: 20px; opacity: 0.9;">
                        Special credit calculations: <strong>DESN 499</strong> (Independent Study) = 0.2 workload credit per credit hour |
                        <strong>DESN 495</strong> (Internship) = 0.1 workload credit per credit hour
                    </p>

                    <div class="applied-learning-grid">
                        <div class="applied-learning-card">
                            <h3>DESN 499 (Independent Study)</h3>
                            <div class="applied-learning-stat">
                                <strong id="desn499Students">0</strong> students
                            </div>
                            <div class="applied-learning-stat">
                                <strong id="desn499Credits">0</strong> total credits
                            </div>
                            <div class="applied-learning-stat">
                                <strong id="desn499Workload">0</strong> workload credits
                            </div>
                        </div>

                        <div class="applied-learning-card">
                            <h3>DESN 495 (Internship)</h3>
                            <div class="applied-learning-stat">
                                <strong id="desn495Students">0</strong> students
                            </div>
                            <div class="applied-learning-stat">
                                <strong id="desn495Credits">0</strong> total credits
                            </div>
                            <div class="applied-learning-stat">
                                <strong id="desn495Workload">0</strong> workload credits
                            </div>
                        </div>

                        <div class="applied-learning-card" style="grid-column: span 2;">
                            <h3>Total Applied Learning</h3>
                            <div class="applied-learning-stat">
                                <strong id="totalAppliedStudents">0</strong> students
                            </div>
                            <div class="applied-learning-stat">
                                <strong id="totalAppliedWorkload">0</strong> workload equivalent credits
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid" style="margin-top: 30px;">
                        <div class="chart-container full-width" style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px);">
                            <h2 style="color: white;">Applied Learning Trends Over Time</h2>
                            <div class="chart-wrapper">
                                <canvas id="appliedLearningTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Workload Table -->
                <div class="chart-container full-width" style="margin-top: 30px;">
                    <h2>Detailed Faculty Workload</h2>
                    <div style="max-height: 600px; overflow-y: auto;">
                        <table class="workload-table" id="workloadTable">
                            <thead>
                                <tr>
                                    <th>Faculty</th>
                                    <th>Total Credits</th>
                                    <th>Workload Credits</th>
                                    <th>Scheduled</th>
                                    <th>Applied Learning</th>
                                    <th>Students</th>
                                    <th>Sections</th>
                                    <th>Utilization</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="workloadTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let workloadData = null;
        let filteredData = null;

        // Load workload data
        async function loadWorkloadData() {
            try {
                const response = await fetch('../workload-data.json');
                if (!response.ok) {
                    throw new Error('Workload data not found. Run workload-calculator.js first.');
                }
                workloadData = await response.json();
                console.log('‚úÖ Loaded workload data:', workloadData);

                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';

                initializeDashboard();
            } catch (error) {
                document.getElementById('loadingMessage').innerHTML = `
                    <div class="error">
                        <h3>‚ö†Ô∏è Data Loading Error</h3>
                        <p>${error.message}</p>
                        <p>Please run: <code>node scripts/workload-calculator.js enrollment-data/processed</code></p>
                    </div>
                `;
            }
        }

        function initializeDashboard() {
            // Initialize with all-years data
            window.currentFacultyData = workloadData.facultyWorkload;

            updateStatistics();
            renderWorkloadDistributionChart();
            renderTopFacultyChart();
            renderUtilizationPieChart();
            renderAppliedLearningSection();
            renderAppliedLearningTrendChart();
            renderWorkloadTable();

            // Set up event listeners
            document.getElementById('academicYearFilter').addEventListener('change', filterData);
            document.getElementById('statusFilter').addEventListener('change', filterData);
        }

        function filterData() {
            const yearFilter = document.getElementById('academicYearFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            // Switch to year-specific data if available
            if (yearFilter !== 'all' && workloadData.workloadByYear && workloadData.workloadByYear.byYear[yearFilter]) {
                // Use specific year's data
                window.currentFacultyData = workloadData.workloadByYear.byYear[yearFilter];
                console.log(`‚úÖ Filtering by academic year: ${yearFilter}`);
            } else {
                // Use all-years data
                window.currentFacultyData = workloadData.facultyWorkload;
                console.log('‚úÖ Showing all years combined');
            }

            // Update all visualizations with filtered data
            updateStatistics();
            renderWorkloadDistributionChart();
            renderTopFacultyChart();
            renderUtilizationPieChart();
            renderWorkloadTable();

            // Update subtitle
            const subtitle = document.querySelector('.subtitle');
            if (yearFilter === 'all') {
                subtitle.textContent = 'EWU Design Department - Academic Workload Analysis';
            } else {
                subtitle.textContent = `EWU Design Department - Academic Year ${yearFilter} Workload`;
            }
        }

        function updateStatistics() {
            const faculty = window.currentFacultyData || workloadData.facultyWorkload;
            const total = Object.keys(faculty).length;

            let overloaded = 0;
            let optimal = 0;
            let underutilized = 0;

            Object.values(faculty).forEach(f => {
                if (f.status === 'overloaded') overloaded++;
                else if (f.status === 'optimal') optimal++;
                else if (f.status === 'underutilized') underutilized++;
            });

            document.getElementById('totalFaculty').textContent = total;
            document.getElementById('overloadedFaculty').textContent = overloaded;
            document.getElementById('optimalFaculty').textContent = optimal;
            document.getElementById('underutilizedFaculty').textContent = underutilized;
        }

        function renderWorkloadDistributionChart() {
            const ctx = document.getElementById('workloadDistributionChart').getContext('2d');
            const faculty = Object.entries(window.currentFacultyData || workloadData.facultyWorkload)
                .sort((a, b) => b[1].totalWorkloadCredits - a[1].totalWorkloadCredits)
                .slice(0, 15);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: faculty.map(([name, _]) => name),
                    datasets: [
                        {
                            label: 'Scheduled Courses',
                            data: faculty.map(([_, data]) => data.scheduledCredits),
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: '#667eea',
                            borderWidth: 2
                        },
                        {
                            label: 'Applied Learning (Weighted)',
                            data: faculty.map(([_, data]) => data.appliedLearningWorkload),
                            backgroundColor: 'rgba(155, 89, 182, 0.8)',
                            borderColor: '#9b59b6',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Workload Credits'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                footer: function(tooltipItems) {
                                    const dataIndex = tooltipItems[0].dataIndex;
                                    const facultyData = faculty[dataIndex][1];
                                    return `Total: ${facultyData.totalWorkloadCredits.toFixed(1)} credits\nUtilization: ${facultyData.utilizationRate}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderTopFacultyChart() {
            const ctx = document.getElementById('topFacultyChart').getContext('2d');
            const faculty = Object.entries(window.currentFacultyData || workloadData.facultyWorkload)
                .sort((a, b) => b[1].totalWorkloadCredits - a[1].totalWorkloadCredits)
                .slice(0, 10);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: faculty.map(([name, _]) => name),
                    datasets: [{
                        label: 'Total Workload Credits',
                        data: faculty.map(([_, data]) => data.totalWorkloadCredits),
                        backgroundColor: faculty.map(([_, data]) => {
                            if (data.status === 'overloaded') return 'rgba(255, 107, 107, 0.8)';
                            if (data.status === 'optimal') return 'rgba(81, 207, 102, 0.8)';
                            return 'rgba(116, 192, 252, 0.8)';
                        }),
                        borderColor: faculty.map(([_, data]) => {
                            if (data.status === 'overloaded') return '#ff6b6b';
                            if (data.status === 'optimal') return '#51cf66';
                            return '#74c0fc';
                        }),
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Workload Credits'
                            }
                        }
                    }
                }
            });
        }

        function renderUtilizationPieChart() {
            const ctx = document.getElementById('utilizationPieChart').getContext('2d');
            const faculty = Object.values(window.currentFacultyData || workloadData.facultyWorkload);

            const overloaded = faculty.filter(f => f.status === 'overloaded').length;
            const optimal = faculty.filter(f => f.status === 'optimal').length;
            const underutilized = faculty.filter(f => f.status === 'underutilized').length;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Overloaded (>100%)', 'Optimal (60-100%)', 'Underutilized (<60%)'],
                    datasets: [{
                        data: [overloaded, optimal, underutilized],
                        backgroundColor: [
                            'rgba(255, 107, 107, 0.8)',
                            'rgba(81, 207, 102, 0.8)',
                            'rgba(116, 192, 252, 0.8)'
                        ],
                        borderColor: [
                            '#ff6b6b',
                            '#51cf66',
                            '#74c0fc'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        function renderAppliedLearningSection() {
            if (!workloadData.appliedLearningTrends) return;

            const latestYear = workloadData.appliedLearningTrends.years[workloadData.appliedLearningTrends.years.length - 1];
            const latestData = workloadData.appliedLearningTrends.trends[latestYear];

            if (!latestData) return;

            document.getElementById('desn499Students').textContent = latestData['DESN 499'].students;
            document.getElementById('desn499Credits').textContent = latestData['DESN 499'].totalCredits;
            document.getElementById('desn499Workload').textContent = latestData['DESN 499'].workloadCredits.toFixed(1);

            document.getElementById('desn495Students').textContent = latestData['DESN 495'].students;
            document.getElementById('desn495Credits').textContent = latestData['DESN 495'].totalCredits;
            document.getElementById('desn495Workload').textContent = latestData['DESN 495'].workloadCredits.toFixed(1);

            document.getElementById('totalAppliedStudents').textContent = latestData.total.students;
            document.getElementById('totalAppliedWorkload').textContent = latestData.total.workloadEquivalent.toFixed(1);
        }

        function renderAppliedLearningTrendChart() {
            const ctx = document.getElementById('appliedLearningTrendChart').getContext('2d');
            const trends = workloadData.appliedLearningTrends;

            if (!trends || !trends.years) return;

            const years = trends.years;
            const desn499Data = years.map(year => trends.trends[year]['DESN 499'].workloadCredits);
            const desn495Data = years.map(year => trends.trends[year]['DESN 495'].workloadCredits);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'DESN 499 Workload',
                            data: desn499Data,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'DESN 495 Workload',
                            data: desn495Data,
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.2)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Workload Credits',
                                color: 'white'
                            },
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: {
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        function renderWorkloadTable() {
            const tbody = document.getElementById('workloadTableBody');
            const faculty = Object.entries(window.currentFacultyData || workloadData.facultyWorkload)
                .sort((a, b) => b[1].totalWorkloadCredits - a[1].totalWorkloadCredits);

            tbody.innerHTML = faculty.map(([name, data]) => {
                const statusClass = data.status;
                const utilizationBar = `
                    <div class="progress-bar">
                        <div class="progress-fill ${data.utilizationRate > 100 ? 'danger' : data.utilizationRate > 80 ? 'warning' : ''}"
                             style="width: ${Math.min(data.utilizationRate, 100)}%"></div>
                    </div>
                `;

                return `
                    <tr>
                        <td><strong>${name}</strong></td>
                        <td>${data.totalCredits}</td>
                        <td><strong>${data.totalWorkloadCredits.toFixed(1)}</strong></td>
                        <td>${data.scheduledCredits}</td>
                        <td>${data.appliedLearningCredits} (${data.appliedLearningWorkload.toFixed(1)} workload)</td>
                        <td>${data.totalStudents}</td>
                        <td>${data.sections}</td>
                        <td>
                            ${data.utilizationRate.toFixed(1)}%
                            ${utilizationBar}
                        </td>
                        <td><span class="workload-badge ${statusClass}">${statusClass}</span></td>
                    </tr>
                `;
            }).join('');
        }

        function exportWorkloadData() {
            const faculty = Object.entries(window.currentFacultyData || workloadData.facultyWorkload);

            let csv = 'Faculty,Total Credits,Workload Credits,Scheduled,Applied Learning,AL Workload,Students,Sections,Utilization %,Status\n';

            faculty.forEach(([name, data]) => {
                csv += `${name},${data.totalCredits},${data.totalWorkloadCredits.toFixed(1)},${data.scheduledCredits},${data.appliedLearningCredits},${data.appliedLearningWorkload.toFixed(1)},${data.totalStudents},${data.sections},${data.utilizationRate.toFixed(1)},${data.status}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `faculty-workload-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        function generateWorkloadReport() {
            alert('PDF report generation would export all charts and tables to a downloadable PDF file.');
        }

        // Load data on page load
        window.addEventListener('load', loadWorkloadData);
    </script>
</body>
</html>
