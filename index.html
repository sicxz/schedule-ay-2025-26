<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EWU Design Schedule Conflict Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        select, button {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        select:hover, select:focus {
            border-color: #667eea;
            outline: none;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 600;
            padding: 10px 25px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .stats-bar {
            padding: 20px 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            background: #fff;
            border-bottom: 2px solid #dee2e6;
        }

        .stat-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.critical {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #ffd93d 0%, #ff9f1c 100%);
            color: #333;
        }

        .stat-card.success {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
            color: white;
        }

        .stat-card.info {
            background: linear-gradient(135deg, #74c0fc 0%, #4dabf7 100%);
            color: white;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            gap: 1px;
            background: #dee2e6;
            border: 1px solid #dee2e6;
            margin-bottom: 30px;
        }

        .grid-header {
            background: #495057;
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
            font-size: 0.9em;
        }

        .time-slot {
            background: #495057;
            color: white;
            padding: 15px 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
        }

        .schedule-cell {
            background: white;
            padding: 8px;
            min-height: 80px;
            position: relative;
            transition: all 0.3s;
        }

        .schedule-cell:hover {
            background: #f8f9fa;
        }

        .course-block {
            background: #e9ecef;
            padding: 8px;
            border-radius: 6px;
            border-left: 4px solid #adb5bd;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 4px;
        }

        .course-block:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .course-block.conflict-0 {
            background: #fff5f5;
            border-left-color: #ff6b6b;
        }

        .course-block.conflict-1 {
            background: #fff3e0;
            border-left-color: #ffa726;
        }

        .course-block.conflict-2 {
            background: #fff9c4;
            border-left-color: #ffd93d;
        }

        .course-name {
            font-weight: 600;
            font-size: 0.85em;
            margin-bottom: 2px;
            color: #212529;
        }

        .course-details {
            font-size: 0.75em;
            color: #6c757d;
        }

        .conflict-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: bold;
        }

        .conflicts-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .conflicts-panel h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .conflict-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #adb5bd;
            transition: all 0.3s;
        }

        .conflict-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .conflict-item.critical {
            border-left-color: #ff6b6b;
        }

        .conflict-item.high {
            border-left-color: #ffa726;
        }

        .conflict-item.medium {
            border-left-color: #ffd93d;
        }

        .conflict-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .conflict-time {
            font-weight: 600;
            color: #212529;
            font-size: 1.1em;
        }

        .severity-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-badge.critical {
            background: #ff6b6b;
            color: white;
        }

        .severity-badge.high {
            background: #ffa726;
            color: white;
        }

        .severity-badge.medium {
            background: #ffd93d;
            color: #333;
        }

        .conflict-courses {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .conflict-course-tag {
            background: #e9ecef;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .recommendations {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }

        .recommendations h2 {
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .recommendation-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .recommendation-item h3 {
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .priority-high {
            border-left: 4px solid #fff;
        }

        .priority-critical {
            border-left: 4px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.2) !important;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .day-divider {
            grid-column: 1 / -1;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            margin: 10px 0;
            position: relative;
        }

        .day-divider::after {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 5px 15px;
            font-weight: 600;
            color: #667eea;
            border-radius: 20px;
            font-size: 0.85em;
        }

        .day-divider.mw::after {
            content: 'Monday/Wednesday';
        }

        .day-divider.tr::after {
            content: 'Tuesday/Thursday';
        }

        /* Faculty color coding */
        .faculty-masingale { border-left-color: #667eea !important; }
        .faculty-durr { border-left-color: #e67e22 !important; }
        .faculty-manikoth { border-left-color: #27ae60 !important; }
        .faculty-mills { border-left-color: #9b59b6 !important; }
        .faculty-lybbert { border-left-color: #e74c3c !important; }
        .faculty-hustrulid { border-left-color: #f39c12 !important; }
        .faculty-sopu { border-left-color: #3498db !important; }
        .faculty-norris { border-left-color: #1abc9c !important; }
        .faculty-braukmann { border-left-color: #34495e !important; }
        .faculty-allison { border-left-color: #d35400 !important; }
        .faculty-online { border-left-color: #7f8c8d !important; }
        .faculty-adjunct { border-left-color: #95a5a6 !important; }
        .faculty-tbd { border-left-color: #bdc3c7 !important; }

        .faculty-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .faculty-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }

        .faculty-color-bar {
            width: 30px;
            height: 15px;
            border-radius: 3px;
        }

        /* Minor highlighting */
        .course-block.minor-highlight {
            border-width: 3px;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .minor-info-panel {
            background: linear-gradient(135deg, #74c0fc 0%, #4dabf7 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .minor-info-panel h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .minor-courses {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .minor-course-tag {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 6px;
            backdrop-filter: blur(10px);
            font-size: 0.9em;
        }

        .minor-note {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.9em;
            font-style: italic;
        }

        .suggested-minors {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .suggested-minors h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .minor-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .minor-chip {
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid #667eea;
            color: #667eea;
            font-weight: 600;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .minor-chip:hover {
            background: #667eea;
            color: white;
        }

        .minor-chip.not-typical {
            border-color: #e67e22;
            color: #e67e22;
        }

        .minor-chip.not-typical:hover {
            background: #e67e22;
            color: white;
        }

        .online-section {
            background: linear-gradient(135deg, #74c0fc 0%, #4dabf7 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            color: white;
        }

        .online-section h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .online-courses {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .online-course-block {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid white;
            backdrop-filter: blur(10px);
        }

        .arranged-section {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            color: white;
        }

        .arranged-section h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .arranged-courses {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .arranged-course-block {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid white;
            backdrop-filter: blur(10px);
        }

        /* Enrollment indicators */
        .enrollment-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: 600;
            margin-left: 4px;
        }

        .enrollment-high {
            background: #ff6b6b;
            color: white;
        }

        .enrollment-medium {
            background: #ffd93d;
            color: #333;
        }

        .enrollment-low {
            background: #51cf66;
            color: white;
        }

        .trend-growing::after {
            content: " â†—";
            color: #51cf66;
            font-weight: bold;
        }

        .trend-declining::after {
            content: " â†˜";
            color: #ff6b6b;
            font-weight: bold;
        }

        .trend-stable::after {
            content: " â†’";
            color: #4dabf7;
            font-weight: bold;
        }

        .trend-new::after {
            content: " âœ¨";
            color: #9b59b6;
            font-weight: bold;
        }

        /* Enrollment tooltip */
        .enrollment-tooltip {
            position: absolute;
            background: #2c3e50;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.8em;
            z-index: 1000;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            pointer-events: none;
        }

        .enrollment-tooltip.show {
            display: block;
        }

        .enrollment-analytics {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .enrollment-analytics h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .enrollment-category {
            margin-bottom: 20px;
        }

        .enrollment-category h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .enrollment-course-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .enrollment-course-tag {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 4px solid;
            font-size: 0.85em;
        }

        .enrollment-course-tag.high {
            border-left-color: #ff6b6b;
        }

        .enrollment-course-tag.low {
            border-left-color: #51cf66;
        }

        .enrollment-course-tag.declining {
            border-left-color: #ffa726;
        }

        .quarterly-enrollment {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .quarterly-enrollment h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .enrollment-history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        .enrollment-history-table th {
            background: #f8f9fa;
            padding: 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }

        .enrollment-history-table td {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .enrollment-history-table tr:hover {
            background: #f8f9fa;
        }

        .enrollment-number {
            font-weight: 600;
            color: #495057;
        }

        .enrollment-split {
            font-size: 0.85em;
            color: #6c757d;
        }

        .course-note-badge {
            display: inline-block;
            background: #9b59b6;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            margin-left: 8px;
        }

        .conflict-solver-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .conflict-solver-panel h2 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .conflict-solution-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ff6b6b;
        }

        .conflict-solution-card h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .solution-option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #51cf66;
        }

        .solution-option.creates-conflict {
            border-left-color: #ff6b6b;
            background: #fff5f5;
        }

        .solution-option.warning {
            border-left-color: #ffd93d;
            background: #fffdf0;
        }

        .solution-recommendation {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .solution-details {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .schedule-grid {
                grid-template-columns: 80px repeat(7, 1fr);
                font-size: 0.8em;
            }

            h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* Edit Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
        }
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            padding: 0;
            line-height: 1;
        }
        .modal-close:hover {
            color: #1f2937;
        }
        .modal-body {
            padding: 24px;
        }
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid #e5e7eb;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }
        .form-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        .course-details-content {
            padding: 20px 24px;
        }
        .course-details-content p {
            margin: 8px 0;
            color: #4b5563;
        }
        .course-details-content strong {
            color: #1f2937;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1f2937;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1100;
        }
        .toast.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    </style>

    <!-- Schedule Manager Scripts -->
    <script src="js/config/constants.js"></script>
    <script src="js/schedule-manager.js"></script>
    <script src="js/data-loader.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>EWU Design Schedule Conflict Analyzer</h1>
            <p class="subtitle">Visual Course Scheduling & Conflict Detection Tool</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="quarterSelect">Select Quarter:</label>
                <select id="quarterSelect">
                    <option value="fall">Fall 2025</option>
                    <option value="winter">Winter 2026</option>
                    <option value="spring" selected>Spring 2026</option>
                </select>
            </div>

            <div class="control-group">
                <label for="courseFilter">Filter by Course:</label>
                <select id="courseFilter">
                    <option value="all">All Courses</option>
                    <option value="DESN 401">DESN 401 - Imaginary Worlds</option>
                    <option value="DESN 463">DESN 463 - Community Design</option>
                    <option value="DESN 379">DESN 379 - Web Dev 2</option>
                </select>
            </div>

            <div class="control-group">
                <label for="roomFilter">Filter by Room:</label>
                <select id="roomFilter">
                    <option value="all">All Rooms</option>
                    <option value="206">206 UX Lab</option>
                    <option value="207">207 Media Lab</option>
                    <option value="209">209 Mac Lab</option>
                    <option value="210">210 Mac Lab</option>
                    <option value="212">212 Project Lab</option>
                    <option value="CEB">CEB Rooms</option>
                </select>
            </div>

            <div class="control-group">
                <label for="minorFilter">Filter by Minor:</label>
                <select id="minorFilter">
                    <option value="all">All Courses</option>
                    <option value="ux">UX/Interaction Design</option>
                    <option value="animation">Animation</option>
                    <option value="gameDesign">Game Design</option>
                    <option value="graphicDesign">Graphic Design</option>
                    <option value="photography">Photography</option>
                    <option value="webDevelopment">Web Development</option>
                </select>
            </div>

            <div class="control-group">
                <label for="trackFilter">Student Track:</label>
                <select id="trackFilter">
                    <option value="all">All Tracks</option>
                    <option value="ux">UX Design</option>
                    <option value="interaction-design">Interaction Design</option>
                    <option value="web-development">Web Development</option>
                    <option value="animation">Animation</option>
                    <option value="game-design">Game Design</option>
                    <option value="motion">Motion Design</option>
                    <option value="photography">Photography</option>
                </select>
            </div>

            <button onclick="highlightConflicts()">Highlight Conflicts</button>
            <button onclick="exportReport()">Export Report</button>
            <button onclick="window.location.href='pages/schedule-editor.html'" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">Edit Schedule</button>
            <button onclick="window.location.href='enrollment-dashboard.html'" style="background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);">Enrollment Trends</button>
            <button onclick="window.location.href='pages/workload-dashboard.html'" style="background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);">Faculty Workload</button>
            <button onclick="window.location.href='pages/applied-learning-dashboard.html'" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Applied Learning</button>
        </div>

        <div style="background: #e7f5ff; border-left: 4px solid #339af0; padding: 12px 16px; margin: 20px; border-radius: 8px; font-size: 0.9em;">
            <strong>ðŸ“Š Enrollment Data:</strong> Course enrollment badges show previous year's same-quarter enrollment.
            Example: <span style="background: #51cf66; color: white; padding: 2px 8px; border-radius: 12px; font-weight: 600;">ðŸ‘¥ 22 ('25)</span> means 22 students enrolled in this course during the same quarter in 2025.
        </div>

        <div class="stats-bar">
            <div class="stat-card critical">
                <div class="stat-number" id="criticalConflicts">3</div>
                <div class="stat-label">Critical Conflicts</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-number" id="totalConflicts">7</div>
                <div class="stat-label">Total Conflicts</div>
            </div>
            <div class="stat-card info">
                <div class="stat-number" id="totalCourses">15</div>
                <div class="stat-label">Total Courses</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="utilizationRate">78%</div>
                <div class="stat-label">Room Utilization</div>
            </div>
        </div>

        <div class="content">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff5f5; border: 2px solid #ff6b6b;"></div>
                    <span>Critical Conflict (3+ courses)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff3e0; border: 2px solid #ffa726;"></div>
                    <span>High Conflict (2 courses)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e9ecef; border: 2px solid #adb5bd;"></div>
                    <span>No Conflict</span>
                </div>
            </div>

            <div class="faculty-legend">
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #667eea;"></div>
                    <span>T.Masingale</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #e67e22;"></div>
                    <span>S.Durr</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #27ae60;"></div>
                    <span>C.Manikoth</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #9b59b6;"></div>
                    <span>S.Mills</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #e74c3c;"></div>
                    <span>M.Lybbert</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #f39c12;"></div>
                    <span>G.Hustrulid</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #3498db;"></div>
                    <span>A.Sopu</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #1abc9c;"></div>
                    <span>E.Norris</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #34495e;"></div>
                    <span>J.Braukmann</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #d35400;"></div>
                    <span>S.Allison</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #7f8c8d;"></div>
                    <span>Barton/Pettigrew (Online)</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #95a5a6;"></div>
                    <span>Adjunct</span>
                </div>
                <div class="faculty-legend-item">
                    <div class="faculty-color-bar" style="background: #bdc3c7;"></div>
                    <span>TBD</span>
                </div>
            </div>

            <div id="minorInfoPanel"></div>
            <div id="trackSuggestionsPanel"></div>

            <div id="enrollmentAnalytics"></div>

            <h2 style="margin-bottom: 20px; color: #495057;">Schedule Grid - <span id="quarterTitle">Spring 2026</span></h2>
            <div class="schedule-grid" id="scheduleGrid"></div>

            <div id="onlineSection"></div>
            <div id="arrangedSection"></div>

            <div class="conflicts-panel">
                <h2>Detected Schedule Conflicts</h2>
                <div id="conflictsList"></div>
            </div>

            <div class="conflict-solver-panel">
                <h2>ðŸ”§ Automated Conflict Resolution Solver</h2>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 20px;">
                    Analyzes schedule matrix to find solutions that won't create new conflicts
                </p>
                <div id="conflictSolverList"></div>
            </div>

            <div class="recommendations">
                <h2>Optimization Recommendations</h2>
                <div id="recommendationsList"></div>
            </div>
        </div>
    </div>

    <script>
        // Faculty color mapping
        const facultyColors = {
            'T.Masingale': { class: 'faculty-masingale', color: '#667eea', name: 'T.Masingale' },
            'T. Masingale': { class: 'faculty-masingale', color: '#667eea', name: 'T.Masingale' },
            'S.Durr': { class: 'faculty-durr', color: '#e67e22', name: 'S.Durr' },
            'C.Manikoth': { class: 'faculty-manikoth', color: '#27ae60', name: 'C.Manikoth' },
            'Manikoth': { class: 'faculty-manikoth', color: '#27ae60', name: 'C.Manikoth' },
            'S.Mills': { class: 'faculty-mills', color: '#9b59b6', name: 'S.Mills' },
            'M.Lybbert': { class: 'faculty-lybbert', color: '#e74c3c', name: 'M.Lybbert' },
            'G.Hustrulid': { class: 'faculty-hustrulid', color: '#f39c12', name: 'G.Hustrulid' },
            'A.Sopu': { class: 'faculty-sopu', color: '#3498db', name: 'A.Sopu' },
            'E.Norris': { class: 'faculty-norris', color: '#1abc9c', name: 'E.Norris' },
            'J.Braukmann': { class: 'faculty-braukmann', color: '#34495e', name: 'J.Braukmann' },
            'S.Allison': { class: 'faculty-allison', color: '#d35400', name: 'S.Allison' },
            'Barton/Pettigrew': { class: 'faculty-online', color: '#7f8c8d', name: 'Barton/Pettigrew' },
            'Adjunct': { class: 'faculty-adjunct', color: '#95a5a6', name: 'Adjunct' },
            'TBD': { class: 'faculty-tbd', color: '#bdc3c7', name: 'TBD' }
        };

        function getFacultyClass(instructor) {
            return facultyColors[instructor]?.class || 'faculty-tbd';
        }

        // Minor data structure
        const minors = {
            ux: {
                name: 'UX/Interaction Design Minor',
                courses: ['DESN 338', 'DESN 348', 'DESN 458', 'DESN 366'],
                tracks: ['ux', 'interaction-design', 'web-development'],
                color: '#e74c3c',
                typical: true
            },
            animation: {
                name: 'Animation Minor',
                courses: ['DESN 326', 'DESN 355', 'DESN 365', 'DESN 336'],
                tracks: ['animation', 'motion'],
                color: '#f39c12',
                typical: false, // UX/Interaction/Web Dev typically don't pursue this
                note: 'UX, Interaction Design, and Web Dev students typically don\'t pursue this minor'
            },
            gameDesign: {
                name: 'Game Design Minor',
                courses: ['DESN 335', 'DESN 345', 'DESN 369', 'DESN 379'],
                tracks: ['animation', 'game-design'],
                color: '#27ae60',
                typical: true,
                note: 'Animation and Game Design students may pursue this minor'
            },
            graphicDesign: {
                name: 'Graphic Design Minor',
                courses: ['DESN 243', 'DESN 263', 'DESN 360', 'DESN 463'],
                tracks: ['all'],
                color: '#3498db',
                typical: true,
                note: 'Can be picked up along the way by any track'
            },
            photography: {
                name: 'Photography Minor',
                courses: ['DESN 350', 'DESN 301'],
                tracks: ['photography', 'visual-storytelling'],
                color: '#9b59b6',
                typical: true,
                note: 'PHOTO 350 only offered in Spring',
                seasonal: { 'DESN 350': 'spring' }
            },
            webDevelopment: {
                name: 'Web Development Minor',
                courses: ['DESN 368', 'DESN 369', 'DESN 379', 'DESN 468'],
                tracks: ['web-development', 'code-design'],
                color: '#667eea',
                typical: true
            }
        };

        // Student track definitions
        const studentTracks = {
            'ux': { name: 'UX Design', suggestedMinors: ['ux', 'graphicDesign', 'webDevelopment'] },
            'interaction-design': { name: 'Interaction Design', suggestedMinors: ['ux', 'graphicDesign', 'webDevelopment'] },
            'web-development': { name: 'Web Development', suggestedMinors: ['webDevelopment', 'graphicDesign', 'ux'] },
            'animation': { name: 'Animation', suggestedMinors: ['animation', 'gameDesign', 'graphicDesign'] },
            'game-design': { name: 'Game Design', suggestedMinors: ['gameDesign', 'animation', 'graphicDesign'] },
            'motion': { name: 'Motion Design', suggestedMinors: ['animation', 'graphicDesign'] },
            'photography': { name: 'Photography', suggestedMinors: ['photography', 'graphicDesign'] },
            'visual-storytelling': { name: 'Visual Storytelling', suggestedMinors: ['photography', 'graphicDesign'] },
            'code-design': { name: 'Code + Design', suggestedMinors: ['webDevelopment', 'gameDesign', 'graphicDesign'] }
        };

        // Load dynamic enrollment data from JSON file
        let enrollmentData = {};

        async function loadEnrollmentData() {
            try {
                const response = await fetch('./enrollment-dashboard-data.json');
                if (response.ok) {
                    const data = await response.json();
                    enrollmentData = data.courseStats || {};
                    console.log('âœ… Loaded dynamic enrollment data');
                    console.log(`   Total courses: ${Object.keys(enrollmentData).length}`);
                    return true;
                }
            } catch (error) {
                console.warn('âš ï¸ Could not load enrollment-dashboard-data.json, using fallback data');
            }
            // Fallback to hardcoded data if JSON fails
            enrollmentData = fallbackEnrollmentData;
            return false;
        }

        // Fallback enrollment data (used if JSON file is not available)
        const fallbackEnrollmentData = {
            "DESN 100": {
                average: 35,
                peak: 48,
                trend: "declining",
                peakQuarter: "fall-2022",
                quarterly: {
                    "winter-2023": 38,
                    "winter-2024": 24,
                    "winter-2025": 22
                }
            },
            "DESN 200": { average: 26, peak: 44, trend: "growing", peakQuarter: "fall-2024" },
            "DESN 216": {
                average: 52,
                peak: 73,
                trend: "declining",
                peakQuarter: "fall-2022",
                quarterly: {
                    "winter-2023": { total: 38, online: 19, inPerson: 19 },
                    "winter-2024": { total: 25, online: 13, inPerson: 12 },
                    "winter-2025": { total: 22, online: 11, inPerson: 11 }
                }
            },
            "DESN 243": { average: 17, peak: 25, trend: "stable", peakQuarter: "spring-2023" },
            "DESN 263": { average: 18, peak: 25, trend: "stable", peakQuarter: "spring-2023" },
            "DESN 301": { average: 21, peak: 25, trend: "growing", peakQuarter: "fall-2024" },
            "DESN 305": { average: 22, peak: 23, trend: "stable", peakQuarter: "spring-2024" },
            "DESN 326": { average: 25, peak: 25, trend: "stable", peakQuarter: "fall-2023" },
            "DESN 335": { average: 24, peak: 24, trend: "stable", peakQuarter: "winter-2025" },
            "DESN 336": { average: 18, peak: 21, trend: "growing", peakQuarter: "spring-2025" },
            "DESN 338": { average: 20, peak: 30, trend: "declining", peakQuarter: "fall-2022" },
            "DESN 345": { average: 0, peak: 0, trend: "new", peakQuarter: "never-offered", isNew: true, note: "New course - Digital Game Design (Spring 2026)" },
            "DESN 348": { average: 16, peak: 20, trend: "stable", peakQuarter: "winter-2024" },
            "DESN 350": { average: 10, peak: 10, trend: "stable", peakQuarter: "spring" },
            "DESN 355": { average: 19, peak: 22, trend: "stable", peakQuarter: "winter-2024" },
            "DESN 359": { average: 19, peak: 24, trend: "growing", peakQuarter: "winter-2024" },
            "DESN 360": { average: 17, peak: 19, trend: "stable", peakQuarter: "winter-2025" },
            "DESN 365": { average: 15, peak: 16, trend: "stable", peakQuarter: "spring-2024" },
            "DESN 366": { average: 12, peak: 18, trend: "declining", peakQuarter: "spring-2023" },
            "DESN 368": { average: 18, peak: 20, trend: "stable", peakQuarter: "fall" },
            "DESN 369": { average: 0, peak: 0, trend: "new", peakQuarter: "never-offered", isNew: true, note: "New course - Web Dev 1 (Winter 2026)" },
            "DESN 374": { average: 22, peak: 25, trend: "stable", peakQuarter: "fall" },
            "DESN 378": { average: 15, peak: 16, trend: "stable", peakQuarter: "winter" },
            "DESN 379": { average: 0, peak: 0, trend: "new", peakQuarter: "never-offered", isNew: true, note: "New course - Web Dev 2 (Spring 2026)" },
            "DESN 384": { average: 19, peak: 24, trend: "stable", peakQuarter: "winter-2023" },
            "DESN 401": { average: 16, peak: 21, trend: "growing", peakQuarter: "winter-2025" },
            "DESN 458": { average: 12, peak: 15, trend: "stable", peakQuarter: "spring-2024" },
            "DESN 463": { average: 16, peak: 24, trend: "growing", peakQuarter: "spring-2025" },
            "DESN 468": { average: 12, peak: 13, trend: "stable", peakQuarter: "spring-2024" },
            "DESN 480": { average: 15, peak: 20, trend: "stable", peakQuarter: "winter-2023" },
            "DESN 490": { average: 15, peak: 25, trend: "growing", peakQuarter: "spring-2025" }
        };

        function getEnrollmentLevel(average) {
            if (average >= 30) return 'high';
            if (average >= 15) return 'medium';
            return 'low';
        }

        function getEnrollmentData(courseCode) {
            return enrollmentData[courseCode] || { average: 0, peak: 0, trend: "unknown", peakQuarter: "" };
        }

        const scheduleData = {
            fall: {
                'MW': {
                    '10:00-12:00': [
                        { code: 'DESN 368', name: 'Code + Design 1', room: '206', instructor: 'T.Masingale', credits: 5 },
                        { code: 'DESN 243', name: 'Typography', room: '209', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 490', name: 'Capstone', room: '210', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'A.Sopu', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 338', name: 'UX 1', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 463', name: 'Community Dr.', room: '209', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 301', name: 'Visual Storyte.', room: '210', instructor: 'S.Mills', credits: 5 },
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'CEB 102', instructor: 'A.Sopu', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'S.Allison', credits: 5 }
                    ],
                    '16:00-18:00': [
                        { code: 'DESN 366', name: 'Production Des.', room: '206', instructor: 'M.Lybbert', credits: 5 }
                    ]
                },
                'TR': {
                    '10:00-12:00': [
                        { code: 'DESN 374', name: 'AI + Design', room: '209', instructor: 'T.Masingale', credits: 5 },
                        { code: 'DESN 200', name: 'Visual Thinking', room: '210', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 359', name: 'Histories of Des.', room: 'CEB 102', instructor: 'S.Durr', credits: 5 },
                        { code: 'ITGS 110', name: 'FYE: Humanities', room: 'CEB 104', instructor: 'S.Mills', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 480', name: 'Pro. Practice', room: '206', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 326', name: 'Intro to Anim.', room: '209', instructor: 'G.Hustrulid', credits: 5 },
                        { code: 'DESN 263', name: 'VCD 1', room: '210', instructor: 'A.Sopu', credits: 5 },
                        { code: 'DESN 200', name: 'Visual Thinking', room: 'CEB 104', instructor: 'S.Mills', credits: 5 }
                    ]
                },
                'ONLINE': {
                    'async': [
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'ONLINE', instructor: 'Barton/Pettigrew', credits: 5 }
                    ]
                }
            },
            winter: {
                'MW': {
                    '10:00-12:00': [
                        { code: 'DESN 335', name: 'Board Game', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 243', name: 'Typography', room: '209', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'CEB 102', instructor: 'A.Sopu', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 348', name: 'UX 2', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 360', name: 'Zine Pubic.', room: '209', instructor: 'S.Mills', credits: 5 },
                        { code: 'DESN 480', name: 'Pro. Practice', room: '210', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'A.Sopu', credits: 5 }
                    ],
                    '16:00-18:00': [
                        { code: 'DESN 338', name: 'UX 1', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 378', name: 'Code + Design 2', room: '209', instructor: 'T. Masingale', credits: 5 }
                    ]
                },
                'TR': {
                    '10:00-12:00': [
                        { code: 'DESN 369', name: 'Web Dev. 1', room: '206', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 490', name: 'Capstone', room: '209', instructor: 'TBD', credits: 5 },
                        { code: 'DESN 359', name: 'Histories of Des.', room: '210', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 200', name: 'Visual Thinking', room: 'CEB 102', instructor: 'S.Mills', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 374', name: 'AI + Design', room: '206', instructor: 'T. Masingale', credits: 5 },
                        { code: 'DESN 355', name: 'Motion Design', room: '209', instructor: 'G.Hustrulid', credits: 5 },
                        { code: 'DESN 263', name: 'VCD 1', room: '210', instructor: 'A.Sopu', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'S.Allison', credits: 5 }
                    ],
                    '16:00-18:00': [
                        { code: 'DESN 336', name: '3D Animation', room: '209', instructor: 'Adjunct', credits: 5 }
                    ]
                },
                'ONLINE': {
                    'async': [
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'ONLINE', instructor: 'Barton/Pettigrew', credits: 5 }
                    ]
                },
                'ARRANGED': {
                    'arranged': [
                        { code: 'DESN 396', name: 'Japan Study Ab.', room: 'ARRANGED', instructor: 'M.Lybbert', credits: 5 }
                    ]
                }
            },
            spring: {
                'MW': {
                    '10:00-12:00': [
                        { code: 'DESN 305', name: 'Social Media', room: '206', instructor: 'E.Norris', credits: 5 },
                        { code: 'DESN 374', name: 'AI + Design', room: '209', instructor: 'T. Masingale', credits: 5 },
                        { code: 'DESN 490', name: 'Capstone', room: '210', instructor: 'TBD', credits: 5 },
                        { code: 'DESN 359', name: 'Histories of Des.', room: 'CEB 102', instructor: 'S.Durr', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 338', name: 'UX 1', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 345', name: 'Digital Game', room: '209', instructor: 'Manikoth', credits: 5 },
                        { code: 'DESN 263', name: 'VCD 1', room: '210', instructor: 'A.Sopu', credits: 5 },
                        { code: 'DESN 200', name: 'Visual Thinking', room: 'CEB 102', instructor: 'S.Mills', credits: 5 }
                    ],
                    '16:00-18:00': [
                        { code: 'DESN 458', name: 'UX 3', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 350', name: 'Digital Photo', room: '209', instructor: 'Adjunct', credits: 5 }
                    ]
                },
                'TR': {
                    '10:00-12:00': [
                        { code: 'DESN 379', name: 'Web Dev. 2', room: '206', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 401', name: 'Imaginary Ws.', room: '209', instructor: 'S.Mills', credits: 5 },
                        { code: 'DESN 463', name: 'Community Dr.', room: '210', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'CEB 102', instructor: 'A.Sopu', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 468', name: 'Code + Design 3', room: '206', instructor: 'T. Masingale', credits: 5 },
                        { code: 'DESN 365', name: 'Motion Des. 2', room: '209', instructor: 'G.Hustrulid', credits: 5 },
                        { code: 'DESN 243', name: 'Typography', room: '210', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 384', name: 'Digital Sound', room: 'CEB 102', instructor: 'J.Braukmann', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'A.Sopu', credits: 5 }
                    ]
                },
                'ONLINE': {
                    'async': [
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'ONLINE', instructor: 'Barton/Pettigrew', credits: 5 }
                    ]
                }
            }
        };

        const conflictData = {
            spring: [
                {
                    time: 'Tuesday & Thursday, 10:00 AM - 12:00 PM',
                    severity: 'critical',
                    courses: ['DESN 379 - Web Dev 2', 'DESN 401 - Imaginary Worlds', 'DESN 463 - Community Design'],
                    impact: 'Students cannot take multiple upper-division electives simultaneously',
                    affected: 'High'
                }
            ],
            fall: [
                {
                    time: 'Monday & Wednesday, 10:00 AM - 12:00 PM',
                    severity: 'high',
                    courses: ['DESN 368 - Code + Design 1', 'DESN 490 - Capstone'],
                    impact: 'Seniors in code track cannot complete both courses',
                    affected: 'High'
                },
                {
                    time: 'Monday & Wednesday, 1:00 PM - 3:00 PM',
                    severity: 'medium',
                    courses: ['DESN 338 - UX 1', 'DESN 463 - Community Design', 'DESN 301 - Visual Storytelling'],
                    impact: 'UX track students limited in elective choices',
                    affected: 'Medium'
                }
            ],
            winter: [
                {
                    time: 'Monday & Wednesday, 1:00 PM - 3:00 PM',
                    severity: 'critical',
                    courses: ['DESN 348 - UX 2', 'DESN 480 - Professional Practice'],
                    impact: 'Seniors pursuing UX minor must choose between DESN 348 (required for UX minor) and DESN 480 (required to graduate). This prevents seniors from completing both the UX minor and graduation requirements in the same quarter.',
                    affected: 'High'
                },
                {
                    time: 'Tuesday & Thursday, 10:00 AM - 12:00 PM',
                    severity: 'high',
                    courses: ['DESN 369 - Web Dev 1', 'DESN 490 - Capstone'],
                    impact: 'Web development students delayed in capstone',
                    affected: 'Medium'
                }
            ]
        };

        const recommendations = {
            spring: [
                {
                    priority: 'high',
                    title: 'Move DESN 463 to Monday/Wednesday 1-3 PM',
                    description: 'Relocating Community Design eliminates the critical three-way conflict and S. Durr has no conflicts at this time.'
                }
            ],
            fall: [
                {
                    priority: 'high',
                    title: 'Add Second Capstone Section',
                    description: 'Offer DESN 490 at Tuesday/Thursday 1-3 PM to allow seniors flexibility in completing degree requirements.'
                }
            ],
            winter: [
                {
                    priority: 'critical',
                    title: 'URGENT: Resolve DESN 348/480 Senior Graduation Conflict',
                    description: 'DESN 348 (UX 2 - UX minor requirement) conflicts with DESN 480 (Professional Practice - required to graduate). Seniors cannot complete UX minor and graduate on time. Recommendation: Move DESN 480 to TR 13:00-15:00 or offer additional DESN 348 section at different time (MW 16:00-18:00 or TR time slot).'
                },
                {
                    priority: 'high',
                    title: 'Optimize DESN 100 Winter Sections',
                    description: 'DESN 100 winter enrollment has declined from 38 (2023) to 22 (2025) students. Currently offering 2 sections, but only 1 section is needed. Consider consolidating to a single section.'
                },
                {
                    priority: 'high',
                    title: 'Review DESN 216 Winter Capacity',
                    description: 'DESN 216 winter shows declining enrollment (38â†’25â†’22 students, split 50/50 between online and in-person). The in-person section now has only ~11 students. Consider consolidating to online-only or offering in-person every other year.'
                }
            ]
        };

        function renderSchedule(quarter) {
            const grid = document.getElementById('scheduleGrid');
            const data = scheduleData[quarter];

            // Clear grid safely
            while (grid.firstChild) {
                grid.removeChild(grid.firstChild);
            }

            // Header row - create elements safely
            const headers = ['Time', '206 UX Lab', '207 Media Lab', '209 Mac Lab', '210 Mac Lab', '212 Project Lab', 'CEB 102', 'CEB 104'];
            headers.forEach(text => {
                const header = document.createElement('div');
                header.className = 'grid-header';
                header.textContent = text;
                grid.appendChild(header);
            });

            const times = ['10:00-12:00', '13:00-15:00', '16:00-18:00'];
            const days = ['MW', 'TR'];
            const rooms = ['206', '207', '209', '210', '212', 'CEB 102', 'CEB 104'];

            days.forEach((day, dayIndex) => {
                // Add divider for each day section
                const divider = document.createElement('div');
                divider.className = 'day-divider ' + (dayIndex === 0 ? 'mw' : 'tr');
                grid.appendChild(divider);

                times.forEach(time => {
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.textContent = day;
                    timeSlot.appendChild(document.createElement('br'));
                    timeSlot.appendChild(document.createTextNode(time));
                    grid.appendChild(timeSlot);

                    rooms.forEach(room => {
                        const courses = data[day] && data[day][time] ?
                            data[day][time].filter(c => c.room === room) : [];

                        const cell = document.createElement('div');
                        cell.className = 'schedule-cell';

                        courses.forEach(course => {
                            const conflictLevel = courses.length > 2 ? 0 : courses.length > 1 ? 1 : 2;
                            const facultyClass = getFacultyClass(course.instructor);
                            const enrollment = getEnrollmentData(course.code);

                            // Get quarter-specific enrollment from previous year instead of overall average
                            const prevYearQuarter = quarter === 'fall' ? 'fall-2025' :
                                                   quarter === 'winter' ? 'winter-2025' :
                                                   quarter === 'spring' ? 'spring-2025' : null;

                            let displayEnrollment = enrollment.average; // fallback
                            let tooltipText = 'Avg enrollment: ' + enrollment.average;
                            let showYearIndicator = false;

                            if (prevYearQuarter && enrollment.quarterly && enrollment.quarterly[prevYearQuarter]) {
                                const prevYearData = enrollment.quarterly[prevYearQuarter];
                                displayEnrollment = typeof prevYearData === 'object' ? prevYearData.total : prevYearData;
                                tooltipText = quarter.charAt(0).toUpperCase() + quarter.slice(1) + ' 2025: ' + displayEnrollment + ' students';
                                showYearIndicator = true;
                            } else if (enrollment.isNew) {
                                displayEnrollment = 'NEW';
                                tooltipText = 'New course - no historical data';
                            }

                            const enrollmentLevel = typeof displayEnrollment === 'number' ? getEnrollmentLevel(displayEnrollment) : 'medium';
                            const trendClass = 'trend-' + enrollment.trend;

                            // Generate a course ID for editing
                            const courseId = '2025-26-' + quarter + '-' + course.code.replace(/\s+/g, '').toLowerCase() + '-001';

                            const block = document.createElement('div');
                            block.className = 'course-block conflict-' + conflictLevel + ' ' + facultyClass + ' ' + trendClass;
                            block.dataset.courseId = courseId;
                            block.dataset.quarter = quarter;
                            block.title = tooltipText + ' | Peak: ' + enrollment.peak + ' | Trend: ' + enrollment.trend;
                            block.onclick = function() {
                                showCourseDetails(course.code, course.name, course.instructor, course.credits, course.room, courseId, quarter);
                            };

                            if (courses.length > 1) {
                                const badge = document.createElement('span');
                                badge.className = 'conflict-badge';
                                badge.textContent = courses.length;
                                block.appendChild(badge);
                            }

                            const nameDiv = document.createElement('div');
                            nameDiv.className = 'course-name';
                            nameDiv.textContent = course.code + ' ';
                            const enrollBadge = document.createElement('span');
                            enrollBadge.className = 'enrollment-badge enrollment-' + enrollmentLevel;
                            enrollBadge.textContent = 'ðŸ‘¥ ' + displayEnrollment;
                            if (showYearIndicator) {
                                const yearSpan = document.createElement('span');
                                yearSpan.style.fontSize = '0.75em';
                                yearSpan.style.opacity = '0.8';
                                yearSpan.textContent = " ('25)";
                                enrollBadge.appendChild(yearSpan);
                            }
                            nameDiv.appendChild(enrollBadge);

                            const titleDiv = document.createElement('div');
                            titleDiv.className = 'course-details';
                            titleDiv.textContent = course.name;

                            const instructorDiv = document.createElement('div');
                            instructorDiv.className = 'course-details';
                            instructorDiv.textContent = course.instructor;

                            block.appendChild(nameDiv);
                            block.appendChild(titleDiv);
                            block.appendChild(instructorDiv);
                            cell.appendChild(block);
                        });

                        grid.appendChild(cell);
                    });
                });
            });
        }

        function renderOnlineCourses(quarter) {
            const onlineSection = document.getElementById('onlineSection');
            const data = scheduleData[quarter];

            // Clear section safely
            while (onlineSection.firstChild) {
                onlineSection.removeChild(onlineSection.firstChild);
            }

            if (!data['ONLINE']) {
                return;
            }

            const onlineCourses = data['ONLINE']['async'] || [];

            if (onlineCourses.length === 0) {
                return;
            }

            const section = document.createElement('div');
            section.className = 'online-section';

            const heading = document.createElement('h3');
            heading.textContent = 'ðŸ“± Online Courses (Asynchronous)';
            section.appendChild(heading);

            const coursesContainer = document.createElement('div');
            coursesContainer.className = 'online-courses';

            onlineCourses.forEach(course => {
                const facultyClass = getFacultyClass(course.instructor);
                const block = document.createElement('div');
                block.className = 'online-course-block ' + facultyClass;

                const nameDiv = document.createElement('div');
                nameDiv.className = 'course-name';
                nameDiv.style.cssText = 'color: white; font-size: 1em; margin-bottom: 5px;';
                nameDiv.textContent = course.code;

                const titleDiv = document.createElement('div');
                titleDiv.className = 'course-details';
                titleDiv.style.color = 'rgba(255,255,255,0.9)';
                titleDiv.textContent = course.name;

                const instructorDiv = document.createElement('div');
                instructorDiv.className = 'course-details';
                instructorDiv.style.color = 'rgba(255,255,255,0.9)';
                instructorDiv.textContent = course.instructor;

                const creditsDiv = document.createElement('div');
                creditsDiv.className = 'course-details';
                creditsDiv.style.cssText = 'color: rgba(255,255,255,0.9); margin-top: 5px;';
                creditsDiv.textContent = course.credits + ' credits';

                block.appendChild(nameDiv);
                block.appendChild(titleDiv);
                block.appendChild(instructorDiv);
                block.appendChild(creditsDiv);
                coursesContainer.appendChild(block);
            });

            section.appendChild(coursesContainer);
            onlineSection.appendChild(section);
        }

        function renderArrangedCourses(quarter) {
            const arrangedSection = document.getElementById('arrangedSection');
            const data = scheduleData[quarter];

            // Clear section safely
            while (arrangedSection.firstChild) {
                arrangedSection.removeChild(arrangedSection.firstChild);
            }

            if (!data['ARRANGED']) {
                return;
            }

            const arrangedCourses = data['ARRANGED']['arranged'] || [];

            if (arrangedCourses.length === 0) {
                return;
            }

            const section = document.createElement('div');
            section.className = 'arranged-section';

            const heading = document.createElement('h3');
            heading.textContent = 'âœˆï¸ Arranged Courses (Study Abroad & Independent Study)';
            section.appendChild(heading);

            const coursesContainer = document.createElement('div');
            coursesContainer.className = 'arranged-courses';

            arrangedCourses.forEach(course => {
                const facultyClass = getFacultyClass(course.instructor);
                const block = document.createElement('div');
                block.className = 'arranged-course-block ' + facultyClass;

                const nameDiv = document.createElement('div');
                nameDiv.className = 'course-name';
                nameDiv.style.cssText = 'color: white; font-size: 1em; margin-bottom: 5px;';
                nameDiv.textContent = course.code;

                const titleDiv = document.createElement('div');
                titleDiv.className = 'course-details';
                titleDiv.style.color = 'rgba(255,255,255,0.9)';
                titleDiv.textContent = course.name;

                const instructorDiv = document.createElement('div');
                instructorDiv.className = 'course-details';
                instructorDiv.style.color = 'rgba(255,255,255,0.9)';
                instructorDiv.textContent = course.instructor;

                const creditsDiv = document.createElement('div');
                creditsDiv.className = 'course-details';
                creditsDiv.style.cssText = 'color: rgba(255,255,255,0.9); margin-top: 5px;';
                creditsDiv.textContent = course.credits + ' credits';

                block.appendChild(nameDiv);
                block.appendChild(titleDiv);
                block.appendChild(instructorDiv);
                block.appendChild(creditsDiv);
                coursesContainer.appendChild(block);
            });

            section.appendChild(coursesContainer);
            arrangedSection.appendChild(section);
        }

        // Helper: Create quarter data cell content
        function createQuarterCell(data, isNew) {
            const cell = document.createElement('td');
            if (isNew) {
                const span = document.createElement('span');
                span.style.cssText = 'color: #9b59b6; font-weight: 600;';
                span.textContent = 'NEW';
                cell.appendChild(span);
            } else if (!data) {
                cell.textContent = '-';
            } else if (typeof data === 'object' && data.total !== undefined) {
                const numSpan = document.createElement('span');
                numSpan.className = 'enrollment-number';
                numSpan.textContent = data.total;
                cell.appendChild(numSpan);
                cell.appendChild(document.createElement('br'));
                const splitSpan = document.createElement('span');
                splitSpan.className = 'enrollment-split';
                splitSpan.textContent = '(' + (data.online || '-') + ' online, ' + (data.inPerson || '-') + ' in-person)';
                cell.appendChild(splitSpan);
            } else {
                const numSpan = document.createElement('span');
                numSpan.className = 'enrollment-number';
                numSpan.textContent = data;
                cell.appendChild(numSpan);
            }
            return cell;
        }

        // Helper: Create enrollment category section
        function createEnrollmentCategory(title, subtitle, courses, type, formatFn) {
            const section = document.createElement('div');
            section.className = 'enrollment-category';

            const h3 = document.createElement('h3');
            h3.textContent = title;

            const p = document.createElement('p');
            p.style.cssText = 'color: #666; font-size: 0.9em; margin-bottom: 10px;';
            p.textContent = subtitle;

            const list = document.createElement('div');
            list.className = 'enrollment-course-list';

            courses.forEach(c => {
                const tag = document.createElement('div');
                tag.className = 'enrollment-course-tag ' + type;
                const strong = document.createElement('strong');
                strong.textContent = c.code;
                tag.appendChild(strong);
                tag.appendChild(document.createTextNode(' - ' + formatFn(c)));
                list.appendChild(tag);
            });

            section.appendChild(h3);
            section.appendChild(p);
            section.appendChild(list);
            return section;
        }

        function renderEnrollmentAnalytics(quarter) {
            const analyticsPanel = document.getElementById('enrollmentAnalytics');
            const data = scheduleData[quarter];

            // Clear safely
            while (analyticsPanel.firstChild) {
                analyticsPanel.removeChild(analyticsPanel.firstChild);
            }

            // Collect all courses from the quarter
            let allCourses = [];
            ['MW', 'TR'].forEach(day => {
                if (data[day]) {
                    ['10:00-12:00', '13:00-15:00', '16:00-18:00'].forEach(time => {
                        if (data[day][time]) {
                            allCourses = allCourses.concat(data[day][time]);
                        }
                    });
                }
            });

            if (data['ONLINE'] && data['ONLINE']['async']) {
                allCourses = allCourses.concat(data['ONLINE']['async']);
            }

            // Categorize courses
            const highEnrollment = [];
            const lowEnrollment = [];
            const decliningTrend = [];

            allCourses.forEach(course => {
                const enrollment = getEnrollmentData(course.code);
                if (enrollment.average >= 30) highEnrollment.push({ ...course, enrollment });
                if (enrollment.average < 15 && enrollment.average > 0) lowEnrollment.push({ ...course, enrollment });
                if (enrollment.trend === 'declining') decliningTrend.push({ ...course, enrollment });
            });

            const coursesWithHistory = allCourses
                .reduce((unique, course) => {
                    if (!unique.find(c => c.code === course.code)) unique.push(course);
                    return unique;
                }, [])
                .sort((a, b) => parseInt(a.code.split(' ')[1]) - parseInt(b.code.split(' ')[1]));

            const quarterName = quarter.charAt(0).toUpperCase() + quarter.slice(1);
            const q2023Key = quarter + '-2023';
            const q2024Key = quarter + '-2024';
            const q2025Key = quarter + '-2025';

            // Main container
            const container = document.createElement('div');
            container.className = 'enrollment-analytics';

            const mainTitle = document.createElement('h2');
            mainTitle.textContent = 'ðŸ“Š Enrollment Analytics - ' + quarterName + ' 2026';
            container.appendChild(mainTitle);

            // Per-Class Enrollment History (collapsible)
            if (coursesWithHistory.length > 0) {
                const historySection = document.createElement('div');
                historySection.className = 'quarterly-enrollment';

                const accordionHeader = document.createElement('h3');
                accordionHeader.style.cssText = 'cursor: pointer; user-select: none; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;';

                const headerText = document.createElement('span');
                headerText.textContent = 'ðŸ“ˆ Per-Class Enrollment History ';
                const countSpan = document.createElement('span');
                countSpan.style.cssText = 'font-size: 0.8em; color: #666; font-weight: normal;';
                countSpan.textContent = '(' + coursesWithHistory.length + ' courses)';
                headerText.appendChild(countSpan);

                const arrow = document.createElement('span');
                arrow.className = 'accordion-arrow';
                arrow.style.fontSize = '0.8em';
                arrow.textContent = 'â–¶';

                accordionHeader.appendChild(headerText);
                accordionHeader.appendChild(arrow);

                const contentDiv = document.createElement('div');
                contentDiv.style.display = 'none';

                accordionHeader.onclick = function() {
                    if (contentDiv.style.display === 'none') {
                        contentDiv.style.display = 'block';
                        arrow.textContent = 'â–¼';
                    } else {
                        contentDiv.style.display = 'none';
                        arrow.textContent = 'â–¶';
                    }
                };

                const historyDesc = document.createElement('p');
                historyDesc.style.cssText = 'color: #666; font-size: 0.9em; margin-bottom: 15px;';
                historyDesc.textContent = 'Historical enrollment data for ' + quarterName + ' quarter courses';

                const table = document.createElement('table');
                table.className = 'enrollment-history-table';

                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                ['Course', 'Course Name', 'Instructor', quarterName + ' 2023', quarterName + ' 2024', quarterName + ' 2025', 'Trend'].forEach(text => {
                    const th = document.createElement('th');
                    th.textContent = text;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                const tbody = document.createElement('tbody');
                coursesWithHistory.forEach(c => {
                    const enrollment = getEnrollmentData(c.code);
                    const quarterly = enrollment.quarterly || {};
                    const row = document.createElement('tr');

                    // Course code cell
                    const codeCell = document.createElement('td');
                    const codeStrong = document.createElement('strong');
                    codeStrong.textContent = c.code;
                    codeCell.appendChild(codeStrong);
                    if (enrollment.isNew) {
                        const badge = document.createElement('span');
                        badge.className = 'course-note-badge';
                        badge.textContent = 'NEW';
                        codeCell.appendChild(badge);
                    }

                    const nameCell = document.createElement('td');
                    nameCell.textContent = c.name;

                    const instructorCell = document.createElement('td');
                    instructorCell.textContent = c.instructor;

                    const trendCell = document.createElement('td');
                    const trendIcon = enrollment.trend === 'declining' ? 'ðŸ“‰' : enrollment.trend === 'growing' ? 'ðŸ“ˆ' : enrollment.trend === 'new' ? 'âœ¨' : 'âž¡ï¸';
                    trendCell.textContent = trendIcon + ' ' + enrollment.trend;

                    row.appendChild(codeCell);
                    row.appendChild(nameCell);
                    row.appendChild(instructorCell);
                    row.appendChild(createQuarterCell(quarterly[q2023Key], enrollment.isNew));
                    row.appendChild(createQuarterCell(quarterly[q2024Key], enrollment.isNew));
                    row.appendChild(createQuarterCell(quarterly[q2025Key], enrollment.isNew));
                    row.appendChild(trendCell);
                    tbody.appendChild(row);
                });

                table.appendChild(thead);
                table.appendChild(tbody);
                contentDiv.appendChild(historyDesc);
                contentDiv.appendChild(table);
                historySection.appendChild(accordionHeader);
                historySection.appendChild(contentDiv);
                container.appendChild(historySection);
            }

            // High Demand section
            if (highEnrollment.length > 0) {
                container.appendChild(createEnrollmentCategory(
                    'ðŸ”´ High Demand Courses (30+ students)',
                    'These courses may need larger rooms or additional sections',
                    highEnrollment,
                    'high',
                    c => 'Avg: ' + c.enrollment.average + ' | Peak: ' + c.enrollment.peak
                ));
            }

            // Low Enrollment section
            if (lowEnrollment.length > 0) {
                container.appendChild(createEnrollmentCategory(
                    'ðŸŸ¢ Low Enrollment Courses (<15 students)',
                    'Consider consolidation or review offering frequency',
                    lowEnrollment,
                    'low',
                    c => 'Avg: ' + c.enrollment.average + ' | Instructor: ' + c.instructor
                ));
            }

            // Declining Trend section
            if (decliningTrend.length > 0) {
                container.appendChild(createEnrollmentCategory(
                    'âš ï¸ Declining Enrollment Trends',
                    'Courses showing declining enrollment patterns',
                    decliningTrend,
                    'declining',
                    c => 'Avg: ' + c.enrollment.average + ' | Trend: ' + c.enrollment.trend + ' â†˜'
                ));
            }

            analyticsPanel.appendChild(container);
        }

        function renderConflicts(quarter) {
            const conflictsList = document.getElementById('conflictsList');
            const conflicts = conflictData[quarter] || [];

            // Clear safely
            while (conflictsList.firstChild) {
                conflictsList.removeChild(conflictsList.firstChild);
            }

            if (conflicts.length === 0) {
                const noConflicts = document.createElement('p');
                noConflicts.style.cssText = 'color: #51cf66; font-weight: 600;';
                noConflicts.textContent = 'No major conflicts detected for this quarter!';
                conflictsList.appendChild(noConflicts);
                return;
            }

            conflicts.forEach(conflict => {
                const item = document.createElement('div');
                item.className = 'conflict-item ' + conflict.severity;

                const header = document.createElement('div');
                header.className = 'conflict-header';

                const timeSpan = document.createElement('span');
                timeSpan.className = 'conflict-time';
                timeSpan.textContent = conflict.time;

                const severityBadge = document.createElement('span');
                severityBadge.className = 'severity-badge ' + conflict.severity;
                severityBadge.textContent = conflict.severity;

                header.appendChild(timeSpan);
                header.appendChild(severityBadge);

                const impactP = document.createElement('p');
                impactP.style.cssText = 'margin: 10px 0; color: #495057;';
                impactP.textContent = conflict.impact;

                const affectedP = document.createElement('p');
                affectedP.style.cssText = 'margin: 10px 0; color: #6c757d; font-size: 0.9em;';
                const affectedStrong = document.createElement('strong');
                affectedStrong.textContent = 'Students Affected:';
                affectedP.appendChild(affectedStrong);
                affectedP.appendChild(document.createTextNode(' ' + conflict.affected));

                const coursesDiv = document.createElement('div');
                coursesDiv.className = 'conflict-courses';
                conflict.courses.forEach(course => {
                    const tag = document.createElement('span');
                    tag.className = 'conflict-course-tag';
                    tag.textContent = course;
                    coursesDiv.appendChild(tag);
                });

                item.appendChild(header);
                item.appendChild(impactP);
                item.appendChild(affectedP);
                item.appendChild(coursesDiv);
                conflictsList.appendChild(item);
            });
        }

        function renderConflictSolver(quarter) {
            const solverList = document.getElementById('conflictSolverList');
            const data = scheduleData[quarter];

            // Build schedule matrix from current quarter data
            const scheduleMatrix = {};
            const days = ['MW', 'TR'];
            const times = ['10:00-12:00', '13:00-15:00', '16:00-18:00'];

            days.forEach(day => {
                times.forEach(time => {
                    const key = `${day} ${time}`;
                    const courses = data[day] && data[day][time] ? data[day][time] : [];
                    scheduleMatrix[key] = courses.map(c => `${c.code} (${c.room})`);
                });
            });

            // Define conflicts that need automated resolution
            const conflictsToSolve = [];

            // Winter: DESN 348/480 conflict
            if (quarter === 'winter') {
                conflictsToSolve.push({
                    name: 'DESN 348 / DESN 480 Conflict',
                    description: 'Both courses scheduled MW 13:00-15:00. Seniors cannot complete UX minor and graduate on time.',
                    affectedStudents: 17,
                    currentSlot: 'MW 13:00-15:00',
                    courseToMove: 'DESN 480 (Professional Practice)',
                    instructor: 'C.Manikoth',
                    alternativeSlots: [
                        'TR 16:00-18:00',
                        'MW 16:00-18:00',
                        'TR 13:00-15:00',
                        'TR 10:00-12:00'
                    ]
                });
            }

            // Spring: TR 10-12 three-way conflict
            if (quarter === 'spring') {
                conflictsToSolve.push({
                    name: 'Spring TR 10-12 Three-Way Conflict',
                    description: 'DESN 379, DESN 401, and DESN 463 all at TR 10:00-12:00. Students cannot take multiple desired upper-division courses.',
                    affectedStudents: 46,
                    currentSlot: 'TR 10:00-12:00',
                    courseToMove: 'DESN 463 (Community Design)',
                    instructor: 'S.Durr',
                    alternativeSlots: [
                        'MW 13:00-15:00',
                        'MW 16:00-18:00',
                        'TR 13:00-15:00',
                        'TR 16:00-18:00'
                    ]
                });
            }

            // Clear safely
            while (solverList.firstChild) {
                solverList.removeChild(solverList.firstChild);
            }

            if (conflictsToSolve.length === 0) {
                const noConflicts = document.createElement('p');
                noConflicts.style.cssText = 'color: #51cf66; font-weight: 600;';
                noConflicts.textContent = 'âœ“ No urgent conflicts requiring automated resolution for this quarter.';
                solverList.appendChild(noConflicts);
                return;
            }

            // Analyze solutions for each conflict
            conflictsToSolve.forEach(conflict => {
                const solutions = conflict.alternativeSlots.map(slot => {
                    const existingCourses = scheduleMatrix[slot] || [];
                    const roomsUsed = existingCourses.length;
                    const roomsAvailable = 6 - roomsUsed;

                    const wouldCreateConflict = roomsUsed >= 4;
                    const hasSpace = roomsAvailable > 0;

                    const instructorConflict = existingCourses.some(course =>
                        course.includes(conflict.instructor) ||
                        course.includes(conflict.instructor.split('.')[1])
                    );

                    let status = 'viable';
                    let recommendation = 'âœ… RECOMMENDED';

                    if (instructorConflict) {
                        status = 'blocked';
                        recommendation = 'âŒ Instructor conflict';
                    } else if (!hasSpace) {
                        status = 'blocked';
                        recommendation = 'âŒ No rooms available';
                    } else if (wouldCreateConflict) {
                        status = 'warning';
                        recommendation = 'âš ï¸ May create new conflict';
                    } else if (roomsUsed <= 2) {
                        recommendation = 'âœ… BEST OPTION';
                    }

                    return { slot, existingCourses, roomsAvailable, status, recommendation, instructorConflict };
                }).sort((a, b) => {
                    if (a.status === 'viable' && b.status !== 'viable') return -1;
                    if (b.status === 'viable' && a.status !== 'viable') return 1;
                    return b.roomsAvailable - a.roomsAvailable;
                });

                const card = document.createElement('div');
                card.className = 'conflict-solution-card';

                const title = document.createElement('h3');
                title.textContent = conflict.name;

                const infoP = document.createElement('p');
                infoP.style.cssText = 'color: #666; margin-bottom: 15px;';
                const impactStrong = document.createElement('strong');
                impactStrong.textContent = 'Impact:';
                infoP.appendChild(impactStrong);
                infoP.appendChild(document.createTextNode(' ' + conflict.affectedStudents + ' students affected'));
                infoP.appendChild(document.createElement('br'));
                const issueStrong = document.createElement('strong');
                issueStrong.textContent = 'Issue:';
                infoP.appendChild(issueStrong);
                infoP.appendChild(document.createTextNode(' ' + conflict.description));
                infoP.appendChild(document.createElement('br'));
                const slotStrong = document.createElement('strong');
                slotStrong.textContent = 'Current Slot:';
                infoP.appendChild(slotStrong);
                infoP.appendChild(document.createTextNode(' ' + conflict.currentSlot));

                const analysisH4 = document.createElement('h4');
                analysisH4.style.cssText = 'margin-top: 15px; margin-bottom: 10px; color: #495057;';
                analysisH4.textContent = 'Automated Solutions Analysis:';

                const matrixP = document.createElement('p');
                matrixP.style.cssText = 'font-size: 0.9em; color: #666; margin-bottom: 15px;';
                matrixP.appendChild(document.createTextNode('Matrix analysis for moving '));
                const courseStrong = document.createElement('strong');
                courseStrong.textContent = conflict.courseToMove;
                matrixP.appendChild(courseStrong);
                matrixP.appendChild(document.createTextNode(' (' + conflict.instructor + '):'));

                card.appendChild(title);
                card.appendChild(infoP);
                card.appendChild(analysisH4);
                card.appendChild(matrixP);

                solutions.forEach(sol => {
                    const option = document.createElement('div');
                    option.className = 'solution-option' + (sol.status === 'blocked' ? ' creates-conflict' : sol.status === 'warning' ? ' warning' : '');

                    const recDiv = document.createElement('div');
                    recDiv.className = 'solution-recommendation';
                    recDiv.textContent = sol.recommendation + ' Move to ' + sol.slot;

                    const detailsDiv = document.createElement('div');
                    detailsDiv.className = 'solution-details';
                    const schedStrong = document.createElement('strong');
                    schedStrong.textContent = 'Currently scheduled:';
                    detailsDiv.appendChild(schedStrong);
                    detailsDiv.appendChild(document.createTextNode(' ' + (sol.existingCourses.length > 0 ? sol.existingCourses.join(', ') : 'EMPTY SLOT')));
                    detailsDiv.appendChild(document.createElement('br'));
                    const roomsStrong = document.createElement('strong');
                    roomsStrong.textContent = 'Rooms available:';
                    detailsDiv.appendChild(roomsStrong);
                    detailsDiv.appendChild(document.createTextNode(' ' + sol.roomsAvailable + ' of 6'));
                    detailsDiv.appendChild(document.createElement('br'));

                    if (sol.instructorConflict) {
                        const warnSpan = document.createElement('span');
                        warnSpan.style.color = '#ff6b6b';
                        warnSpan.textContent = 'âš ï¸ Instructor already teaching at this time';
                        detailsDiv.appendChild(warnSpan);
                    }
                    if (sol.status === 'viable' && sol.roomsAvailable >= 4) {
                        const okSpan = document.createElement('span');
                        okSpan.style.color = '#51cf66';
                        okSpan.textContent = 'âœ“ Minimal impact, plenty of space';
                        detailsDiv.appendChild(okSpan);
                    }

                    option.appendChild(recDiv);
                    option.appendChild(detailsDiv);
                    card.appendChild(option);
                });

                solverList.appendChild(card);
            });
        }

        function renderRecommendations(quarter) {
            const recList = document.getElementById('recommendationsList');
            const recs = recommendations[quarter] || [];

            // Clear safely
            while (recList.firstChild) {
                recList.removeChild(recList.firstChild);
            }

            if (recs.length === 0) {
                const noRecs = document.createElement('p');
                noRecs.textContent = 'No specific recommendations for this quarter.';
                recList.appendChild(noRecs);
                return;
            }

            recs.forEach(rec => {
                const item = document.createElement('div');
                let className = 'recommendation-item';
                if (rec.priority === 'critical') className += ' priority-critical';
                else if (rec.priority === 'high') className += ' priority-high';
                item.className = className;

                const title = document.createElement('h3');
                title.textContent = rec.title;

                const desc = document.createElement('p');
                desc.textContent = rec.description;

                item.appendChild(title);
                item.appendChild(desc);
                recList.appendChild(item);
            });
        }

        function updateStats(quarter) {
            const data = scheduleData[quarter];
            const conflicts = conflictData[quarter] || [];

            let totalCourses = 0;
            Object.values(data).forEach(dayData => {
                Object.values(dayData).forEach(timeSlot => {
                    totalCourses += timeSlot.length;
                });
            });

            const criticalConflicts = conflicts.filter(c => c.severity === 'critical').length;

            // Calculate room utilization (excluding room 207 - Media Lab flex space)
            const rooms = ['206', '209', '210', '212', 'CEB 102', 'CEB 104']; // Excluding 207
            const times = ['10:00-12:00', '13:00-15:00', '16:00-18:00'];
            const days = ['MW', 'TR'];

            let totalSlots = 0;
            let filledSlots = 0;

            days.forEach(day => {
                if (data[day]) {
                    times.forEach(time => {
                        if (data[day][time]) {
                            rooms.forEach(room => {
                                totalSlots++;
                                const coursesInRoom = data[day][time].filter(c => c.room === room);
                                if (coursesInRoom.length > 0) {
                                    filledSlots++;
                                }
                            });
                        }
                    });
                }
            });

            const utilizationRate = totalSlots > 0 ? Math.round((filledSlots / totalSlots) * 100) : 0;

            document.getElementById('criticalConflicts').textContent = criticalConflicts;
            document.getElementById('totalConflicts').textContent = conflicts.length;
            document.getElementById('totalCourses').textContent = totalCourses;
            document.getElementById('utilizationRate').textContent = utilizationRate + '%';
        }

        function isCourseInMinor(courseCode, minorKey) {
            return minors[minorKey].courses.includes(courseCode);
        }

        function displayMinorInfo(minorKey) {
            const panel = document.getElementById('minorInfoPanel');

            // Clear safely
            while (panel.firstChild) {
                panel.removeChild(panel.firstChild);
            }

            if (minorKey === 'all') {
                return;
            }

            const minor = minors[minorKey];

            const infoPanel = document.createElement('div');
            infoPanel.className = 'minor-info-panel';

            const title = document.createElement('h3');
            title.textContent = minor.name;

            const reqText = document.createElement('p');
            reqText.textContent = 'Required Courses:';

            const coursesDiv = document.createElement('div');
            coursesDiv.className = 'minor-courses';
            minor.courses.forEach(course => {
                const tag = document.createElement('div');
                tag.className = 'minor-course-tag';
                tag.textContent = course;
                coursesDiv.appendChild(tag);
            });

            infoPanel.appendChild(title);
            infoPanel.appendChild(reqText);
            infoPanel.appendChild(coursesDiv);

            if (minor.note) {
                const noteDiv = document.createElement('div');
                noteDiv.className = 'minor-note';
                noteDiv.textContent = minor.note;
                infoPanel.appendChild(noteDiv);
            }

            panel.appendChild(infoPanel);
        }

        function displayTrackSuggestions(trackKey) {
            const panel = document.getElementById('trackSuggestionsPanel');

            // Clear safely
            while (panel.firstChild) {
                panel.removeChild(panel.firstChild);
            }

            if (trackKey === 'all') {
                return;
            }

            const track = studentTracks[trackKey];
            const suggestedMinors = track.suggestedMinors.map(minorKey => {
                const minor = minors[minorKey];
                return {
                    key: minorKey,
                    name: minor.name,
                    typical: minor.typical
                };
            });

            const container = document.createElement('div');
            container.className = 'suggested-minors';

            const title = document.createElement('h3');
            title.textContent = 'Suggested Minors for ' + track.name + ' Students';

            const list = document.createElement('div');
            list.className = 'minor-list';

            suggestedMinors.forEach(m => {
                const chip = document.createElement('div');
                chip.className = 'minor-chip' + (!m.typical ? ' not-typical' : '');
                chip.textContent = m.name;
                chip.onclick = function() { selectMinor(m.key); };
                list.appendChild(chip);
            });

            container.appendChild(title);
            container.appendChild(list);
            panel.appendChild(container);
        }

        function selectMinor(minorKey) {
            document.getElementById('minorFilter').value = minorKey;
            document.getElementById('minorFilter').dispatchEvent(new Event('change'));
        }

        function highlightMinorCourses(minorKey) {
            const courseBlocks = document.querySelectorAll('.course-block');
            courseBlocks.forEach(block => {
                block.classList.remove('minor-highlight');
            });

            if (minorKey !== 'all') {
                courseBlocks.forEach(block => {
                    const courseCode = block.querySelector('.course-name').textContent;
                    if (isCourseInMinor(courseCode, minorKey)) {
                        block.classList.add('minor-highlight');
                    }
                });
            }
        }

        // Current course being viewed/edited
        let currentCourseData = null;

        function showCourseDetails(code, name, instructor, credits, room, courseId, quarter) {
            // Store course data for edit modal
            currentCourseData = { code, name, instructor, credits, room, courseId, quarter };

            // Build details content
            const content = document.getElementById('courseDetailsContent');
            content.innerHTML = `
                <p><strong>Course:</strong> ${code} - ${name || 'N/A'}</p>
                <p><strong>Instructor:</strong> ${instructor || 'TBD'}</p>
                <p><strong>Credits:</strong> ${credits || 'N/A'}</p>
                <p><strong>Room:</strong> ${room || 'TBD'}</p>
            `;

            document.getElementById('detailsModalTitle').textContent = code;
            document.getElementById('courseDetailsModal').classList.add('active');
        }

        function closeCourseDetailsModal() {
            document.getElementById('courseDetailsModal').classList.remove('active');
            currentCourseData = null;
        }

        function openEditModal() {
            if (!currentCourseData) return;

            // Close details modal
            document.getElementById('courseDetailsModal').classList.remove('active');

            // Fill edit form with current data
            document.getElementById('editCourseId').value = currentCourseData.courseId || '';
            document.getElementById('editQuarter').value = currentCourseData.quarter || '';
            document.getElementById('editCourseCode').value = currentCourseData.code || '';
            document.getElementById('editSection').value = '001';
            document.getElementById('editCredits').value = currentCourseData.credits || 5;
            document.getElementById('editEnrollmentCap').value = '';
            document.getElementById('editFaculty').value = currentCourseData.instructor || '';
            document.getElementById('editRoom').value = currentCourseData.room || '';
            document.getElementById('editStartTime').value = '';
            document.getElementById('editEndTime').value = '';
            document.getElementById('editNotes').value = '';

            // Clear day checkboxes
            ['M', 'T', 'W', 'Th', 'F'].forEach(day => {
                const cb = document.getElementById('editDay' + day);
                if (cb) cb.checked = false;
            });

            // Try to get more data from ScheduleManager if available
            if (typeof ScheduleManager !== 'undefined' && currentCourseData.courseId) {
                const schedule = ScheduleManager.getQuarterSchedule('2025-26', currentCourseData.quarter);
                const course = schedule.find(c => c.id === currentCourseData.courseId);
                if (course) {
                    document.getElementById('editSection').value = course.section || '001';
                    document.getElementById('editEnrollmentCap').value = course.enrollmentCap || '';
                    document.getElementById('editStartTime').value = course.startTime || '';
                    document.getElementById('editEndTime').value = course.endTime || '';
                    document.getElementById('editNotes').value = course.notes || '';
                    if (course.days && Array.isArray(course.days)) {
                        course.days.forEach(day => {
                            const cb = document.getElementById('editDay' + day);
                            if (cb) cb.checked = true;
                        });
                    }
                }
            }

            // Open edit modal
            document.getElementById('courseEditModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('courseEditModal').classList.remove('active');
        }

        function getEditSelectedDays() {
            const days = [];
            ['M', 'T', 'W', 'Th', 'F'].forEach(day => {
                const cb = document.getElementById('editDay' + day);
                if (cb && cb.checked) days.push(day);
            });
            return days;
        }

        function handleEditFormSubmit(e) {
            e.preventDefault();

            const courseId = document.getElementById('editCourseId').value;
            const quarter = document.getElementById('editQuarter').value;

            const updates = {
                section: document.getElementById('editSection').value,
                credits: parseInt(document.getElementById('editCredits').value) || 5,
                enrollmentCap: parseInt(document.getElementById('editEnrollmentCap').value) || null,
                assignedFaculty: document.getElementById('editFaculty').value || null,
                room: document.getElementById('editRoom').value || null,
                days: getEditSelectedDays(),
                startTime: document.getElementById('editStartTime').value || null,
                endTime: document.getElementById('editEndTime').value || null,
                notes: document.getElementById('editNotes').value || null
            };

            if (typeof ScheduleManager !== 'undefined' && courseId) {
                const result = ScheduleManager.updateCourseAssignment('2025-26', quarter, courseId, updates);
                if (result.success) {
                    showToast('Course updated successfully');
                    closeEditModal();
                    // Refresh the schedule view
                    const currentQuarter = document.getElementById('quarterSelect').value;
                    renderSchedule(currentQuarter);
                    renderOnlineCourses(currentQuarter);
                    renderArrangedCourses(currentQuarter);
                } else {
                    showToast(result.errors.join(', '), 'error');
                }
            } else {
                showToast('Changes saved locally');
                closeEditModal();
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.style.background = type === 'error' ? '#dc3545' : '#1f2937';
            toast.classList.add('visible');
            setTimeout(() => {
                toast.classList.remove('visible');
            }, 3000);
        }

        function highlightConflicts() {
            alert('Conflicts are highlighted in red (3+ courses) and orange (2 courses) in the schedule grid!');
        }

        function exportReport() {
            alert('Export functionality would generate a PDF report with full conflict analysis and recommendations.');
        }

        // Event listeners
        document.getElementById('quarterSelect').addEventListener('change', function() {
            const quarter = this.value;
            document.getElementById('quarterTitle').textContent = quarter.charAt(0).toUpperCase() + quarter.slice(1) + ' 2026';
            renderSchedule(quarter);
            renderOnlineCourses(quarter);
            renderArrangedCourses(quarter);
            renderEnrollmentAnalytics(quarter);
            renderConflicts(quarter);
            renderConflictSolver(quarter);
            renderRecommendations(quarter);
            updateStats(quarter);

            // Re-apply minor filter if active
            const minorFilter = document.getElementById('minorFilter').value;
            if (minorFilter !== 'all') {
                highlightMinorCourses(minorFilter);
            }
        });

        document.getElementById('minorFilter').addEventListener('change', function() {
            const minorKey = this.value;
            displayMinorInfo(minorKey);
            highlightMinorCourses(minorKey);
        });

        document.getElementById('trackFilter').addEventListener('change', function() {
            const trackKey = this.value;
            displayTrackSuggestions(trackKey);
        });

        // Initialize app - load data then render
        async function init() {
            await loadEnrollmentData();

            // Initialize ScheduleManager for editing
            if (typeof ScheduleManager !== 'undefined') {
                await ScheduleManager.init({ catalogPath: 'data/course-catalog.json' });
                console.log('ScheduleManager initialized');
            }

            // Initial render
            renderSchedule('spring');
            renderOnlineCourses('spring');
            renderArrangedCourses('spring');
            renderEnrollmentAnalytics('spring');
            renderConflicts('spring');
            renderConflictSolver('spring');
            renderRecommendations('spring');
            updateStats('spring');
        }

        // Start the app when page loads
        init();
    </script>

    <!-- Course Details Modal -->
    <div class="modal-overlay" id="courseDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="detailsModalTitle">Course Details</h2>
                <button class="modal-close" onclick="closeCourseDetailsModal()">&times;</button>
            </div>
            <div class="course-details-content" id="courseDetailsContent">
                <!-- Filled dynamically -->
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeCourseDetailsModal()">Close</button>
                <button class="btn-primary" id="editCourseBtn" onclick="openEditModal()">Edit Course</button>
            </div>
        </div>
    </div>

    <!-- Edit Course Modal -->
    <div class="modal-overlay" id="courseEditModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Edit Course</h2>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>

            <form id="editCourseForm" onsubmit="handleEditFormSubmit(event)">
                <input type="hidden" id="editCourseId">
                <input type="hidden" id="editQuarter">

                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Course Code</label>
                        <input type="text" id="editCourseCode" class="form-input" readonly style="background: #f3f4f6;">
                    </div>

                    <div class="form-input-group">
                        <div class="form-group">
                            <label for="editSection" class="form-label">Section</label>
                            <input type="text" id="editSection" class="form-input" maxlength="3">
                        </div>

                        <div class="form-group">
                            <label for="editCredits" class="form-label">Credits</label>
                            <input type="number" id="editCredits" class="form-input" min="1" max="15" step="1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editEnrollmentCap" class="form-label">Enrollment Cap</label>
                        <input type="number" id="editEnrollmentCap" class="form-input" min="1" max="100" step="1">
                    </div>

                    <div class="form-group">
                        <label for="editFaculty" class="form-label">Faculty</label>
                        <input type="text" id="editFaculty" class="form-input" placeholder="Instructor name">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Days</label>
                        <div style="display: flex; gap: 12px; margin-top: 6px;">
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayM" value="M"> M
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayT" value="T"> T
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayW" value="W"> W
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayTh" value="Th"> Th
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayF" value="F"> F
                            </label>
                        </div>
                    </div>

                    <div class="form-input-group">
                        <div class="form-group">
                            <label for="editStartTime" class="form-label">Start Time</label>
                            <input type="time" id="editStartTime" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="editEndTime" class="form-label">End Time</label>
                            <input type="time" id="editEndTime" class="form-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editRoom" class="form-label">Room</label>
                        <input type="text" id="editRoom" class="form-input" placeholder="e.g., CEB 242">
                    </div>

                    <div class="form-group">
                        <label for="editNotes" class="form-label">Notes</label>
                        <textarea id="editNotes" class="form-input" rows="2" placeholder="Optional notes..."></textarea>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span id="toastMessage">Changes saved</span>
    </div>
</body>
</html>
