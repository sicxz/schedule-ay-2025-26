<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Scheduler - EWU</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        select, button {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        select:hover, select:focus {
            border-color: #667eea;
            outline: none;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 600;
            padding: 10px 25px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* Dashboard Navigation Accordion */
        .dashboard-nav {
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-accordion-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .nav-accordion-toggle:hover {
            opacity: 0.95;
        }

        .nav-accordion-toggle .toggle-icon {
            transition: transform 0.3s;
        }

        .nav-accordion-toggle.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }

        .nav-accordion-content {
            padding: 16px 24px;
            display: block;
        }

        .nav-accordion-content.collapsed {
            display: none;
        }

        .nav-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .nav-row:last-child {
            border-bottom: none;
        }

        .nav-row-header {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6b7280;
            font-weight: 600;
            min-width: 70px;
        }

        .nav-row-items {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 6px;
            text-decoration: none;
            color: #374151;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid #e5e7eb;
            background: white;
        }

        .nav-link:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
            transform: none;
            box-shadow: none;
        }

        .nav-link .icon {
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .nav-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .nav-row-header {
                margin-bottom: 8px;
            }
        }

        /* Faculty Modal */
        .faculty-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .faculty-modal-overlay.visible {
            display: flex;
        }

        .faculty-modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .faculty-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
        }

        .faculty-modal-header h2 {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .faculty-modal-header .faculty-color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .faculty-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #6b7280;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .faculty-modal-close:hover {
            background: #f3f4f6;
            color: #374151;
            transform: none;
            box-shadow: none;
        }

        .faculty-modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: 60vh;
        }

        .faculty-section {
            margin-bottom: 20px;
        }

        .faculty-section h3 {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6b7280;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .faculty-schedule-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .faculty-schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: #f9fafb;
            border-radius: 8px;
            font-size: 14px;
        }

        .faculty-schedule-item .course-code {
            font-weight: 600;
            color: #111827;
        }

        .faculty-schedule-item .course-details {
            color: #6b7280;
            font-size: 13px;
        }

        .faculty-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .faculty-stat {
            background: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .faculty-stat .value {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
        }

        .faculty-stat .label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .faculty-pref-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .faculty-pref-tag {
            display: inline-block;
            padding: 4px 10px;
            background: #e0f2fe;
            color: #0369a1;
            border-radius: 4px;
            font-size: 13px;
        }

        .faculty-modal-section {
            margin-bottom: 20px;
        }

        .faculty-modal-section h4 {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6b7280;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .faculty-course-item {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px 12px;
            background: #f9fafb;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .faculty-course-item .course-code {
            font-weight: 600;
            color: #111827;
        }

        .faculty-course-item .course-title {
            color: #374151;
        }

        .faculty-course-item .course-details {
            color: #6b7280;
            font-size: 13px;
            width: 100%;
        }

        .faculty-modal-stats .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: #f9fafb;
            border-radius: 6px;
            margin-bottom: 6px;
        }

        .faculty-modal-stats .stat-item .stat-label {
            color: #6b7280;
            font-size: 14px;
        }

        .faculty-modal-stats .stat-item .stat-value {
            font-weight: 600;
            color: #111827;
        }

        .faculty-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .pref-tag {
            display: inline-block;
            padding: 6px 12px;
            background: #f3f4f6;
            color: #374151;
            border-radius: 6px;
            font-size: 13px;
        }

        .pref-link {
            display: inline-block;
            color: #667eea;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
        }

        .pref-link:hover {
            text-decoration: underline;
        }

        .faculty-legend-item {
            cursor: pointer;
            transition: background 0.2s;
            padding: 4px 8px;
            border-radius: 4px;
            margin: -4px -8px;
        }

        .faculty-legend-item:hover {
            background: #f3f4f6;
        }

        .stats-bar {
            padding: 20px 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            background: #fff;
            border-bottom: 2px solid #dee2e6;
        }

        .stat-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.critical {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #ffd93d 0%, #ff9f1c 100%);
            color: #333;
        }

        .stat-card.success {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
            color: white;
        }

        .stat-card.info {
            background: linear-gradient(135deg, #74c0fc 0%, #4dabf7 100%);
            color: white;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            gap: 1px;
            background: #dee2e6;
            border: 1px solid #dee2e6;
            margin-bottom: 30px;
        }

        .grid-header {
            background: #495057;
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
            font-size: 0.9em;
        }

        .time-slot {
            background: #495057;
            color: white;
            padding: 15px 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
        }

        .schedule-cell {
            background: white;
            padding: 8px;
            min-height: 80px;
            position: relative;
            transition: all 0.3s;
        }

        .schedule-cell:hover {
            background: #f8f9fa;
        }

        .course-block {
            background: #e9ecef;
            padding: 8px;
            border-radius: 6px;
            border-left: 4px solid #adb5bd;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 4px;
        }

        .course-block:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .course-block.conflict-0 {
            background: #fff5f5;
            border-left-color: #ff6b6b;
        }

        .course-block.conflict-1 {
            background: #fff3e0;
            border-left-color: #ffa726;
        }

        .course-block.conflict-2 {
            background: #fff9c4;
            border-left-color: #ffd93d;
        }

        .course-name {
            font-weight: 600;
            font-size: 0.85em;
            margin-bottom: 2px;
            color: #212529;
        }

        .course-details {
            font-size: 0.75em;
            color: #6c757d;
        }

        .conflict-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: bold;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1000px) {
            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }

        .conflicts-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }

        .conflicts-panel h2 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .conflict-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #adb5bd;
            transition: all 0.3s;
        }

        .conflict-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .conflict-item.critical {
            border-left-color: #ff6b6b;
        }

        .conflict-item.high {
            border-left-color: #ffa726;
        }

        .conflict-item.medium {
            border-left-color: #ffd93d;
        }

        .conflict-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .conflict-time {
            font-weight: 600;
            color: #212529;
            font-size: 1.1em;
        }

        .severity-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-badge.critical {
            background: #ff6b6b;
            color: white;
        }

        .severity-badge.high {
            background: #ffa726;
            color: white;
        }

        .severity-badge.medium {
            background: #ffd93d;
            color: #333;
        }

        .conflict-courses {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .conflict-course-tag {
            background: #e9ecef;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .recommendations {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }

        .recommendations h2 {
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .recommendation-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .recommendation-item h3 {
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .priority-high {
            border-left: 4px solid #fff;
        }

        .priority-critical {
            border-left: 4px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.2) !important;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .day-divider {
            grid-column: 1 / -1;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            margin: 10px 0;
            position: relative;
        }

        .day-divider::after {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 5px 15px;
            font-weight: 600;
            color: #667eea;
            border-radius: 20px;
            font-size: 0.85em;
        }

        .day-divider.mw::after {
            content: 'Monday/Wednesday';
        }

        .day-divider.tr::after {
            content: 'Tuesday/Thursday';
        }

        /* Faculty color coding */
        .faculty-masingale { border-left-color: #667eea !important; }
        .faculty-durr { border-left-color: #e67e22 !important; }
        .faculty-manikoth { border-left-color: #27ae60 !important; }
        .faculty-mills { border-left-color: #9b59b6 !important; }
        .faculty-lybbert { border-left-color: #e74c3c !important; }
        .faculty-hustrulid { border-left-color: #f39c12 !important; }
        .faculty-sopu { border-left-color: #3498db !important; }
        .faculty-norris { border-left-color: #1abc9c !important; }
        .faculty-braukmann { border-left-color: #34495e !important; }
        .faculty-allison { border-left-color: #d35400 !important; }
        .faculty-online { border-left-color: #7f8c8d !important; }
        .faculty-adjunct { border-left-color: #95a5a6 !important; }
        .faculty-tbd { border-left-color: #bdc3c7 !important; }

        .faculty-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .faculty-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }

        .faculty-color-bar {
            width: 30px;
            height: 15px;
            border-radius: 3px;
        }

        /* Minor highlighting */
        .course-block.minor-highlight {
            border-width: 3px;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .minor-info-panel {
            background: linear-gradient(135deg, #74c0fc 0%, #4dabf7 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .minor-info-panel h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .minor-courses {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .minor-course-tag {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 6px;
            backdrop-filter: blur(10px);
            font-size: 0.9em;
        }

        .minor-note {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.9em;
            font-style: italic;
        }

        .suggested-minors {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .suggested-minors h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .minor-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .minor-chip {
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid #667eea;
            color: #667eea;
            font-weight: 600;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .minor-chip:hover {
            background: #667eea;
            color: white;
        }

        .minor-chip.not-typical {
            border-color: #e67e22;
            color: #e67e22;
        }

        .minor-chip.not-typical:hover {
            background: #e67e22;
            color: white;
        }

        .special-sections-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 900px) {
            .special-sections-grid {
                grid-template-columns: 1fr;
            }
        }

        .online-section {
            background: linear-gradient(135deg, #74c0fc 0%, #4dabf7 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 0;
            color: white;
        }

        .online-section h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .online-courses {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }

        .online-course-block {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid white;
            backdrop-filter: blur(10px);
        }

        .arranged-section {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 0;
            color: white;
        }

        .arranged-section h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .arranged-courses {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }

        .arranged-course-block {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid white;
            backdrop-filter: blur(10px);
        }

        /* Enrollment indicators */
        .enrollment-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: 600;
            margin-left: 4px;
        }

        .enrollment-high {
            background: #ff6b6b;
            color: white;
        }

        .enrollment-medium {
            background: #ffd93d;
            color: #333;
        }

        .enrollment-low {
            background: #51cf66;
            color: white;
        }

        .trend-growing::after {
            content: " â†—";
            color: #51cf66;
            font-weight: bold;
        }

        .trend-declining::after {
            content: " â†˜";
            color: #ff6b6b;
            font-weight: bold;
        }

        .trend-stable::after {
            content: " â†’";
            color: #4dabf7;
            font-weight: bold;
        }

        .trend-new::after {
            content: " âœ¨";
            color: #9b59b6;
            font-weight: bold;
        }

        /* Enrollment tooltip */
        .enrollment-tooltip {
            position: absolute;
            background: #2c3e50;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.8em;
            z-index: 1000;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            pointer-events: none;
        }

        .enrollment-tooltip.show {
            display: block;
        }

        .enrollment-analytics {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .enrollment-analytics h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .enrollment-category {
            margin-bottom: 20px;
        }

        .enrollment-category h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .enrollment-course-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .enrollment-course-tag {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 4px solid;
            font-size: 0.85em;
        }

        .enrollment-course-tag.high {
            border-left-color: #ff6b6b;
        }

        .enrollment-course-tag.low {
            border-left-color: #51cf66;
        }

        .enrollment-course-tag.declining {
            border-left-color: #ffa726;
        }

        .quarterly-enrollment {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .quarterly-enrollment h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .enrollment-history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        .enrollment-history-table th {
            background: #f8f9fa;
            padding: 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }

        .enrollment-history-table td {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .enrollment-history-table tr:hover {
            background: #f8f9fa;
        }

        .enrollment-number {
            font-weight: 600;
            color: #495057;
        }

        .enrollment-split {
            font-size: 0.85em;
            color: #6c757d;
        }

        .course-note-badge {
            display: inline-block;
            background: #9b59b6;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            margin-left: 8px;
        }

        .conflict-solver-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }

        .conflict-solver-panel h2 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .conflict-solution-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ff6b6b;
        }

        .conflict-solution-card h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .solution-option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #51cf66;
        }

        .solution-option.creates-conflict {
            border-left-color: #ff6b6b;
            background: #fff5f5;
        }

        .solution-option.warning {
            border-left-color: #ffd93d;
            background: #fffdf0;
        }

        .solution-recommendation {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .solution-details {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .schedule-grid {
                grid-template-columns: 80px repeat(7, 1fr);
                font-size: 0.8em;
            }

            h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* Edit Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
        }
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            padding: 0;
            line-height: 1;
        }
        .modal-close:hover {
            color: #1f2937;
        }
        .modal-body {
            padding: 24px;
        }
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid #e5e7eb;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }
        .form-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        .course-details-content {
            padding: 20px 24px;
        }
        .course-details-content p {
            margin: 8px 0;
            color: #4b5563;
        }
        .course-details-content strong {
            color: #1f2937;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1f2937;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1100;
        }
        .toast.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Drag and Drop Styles */
        .course-block[draggable="true"] {
            cursor: grab;
        }
        .course-block[draggable="true"]:active {
            cursor: grabbing;
        }
        .course-block.dragging {
            opacity: 0.5;
            transform: scale(0.95);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .schedule-cell.drop-zone {
            transition: all 0.2s ease;
        }
        .schedule-cell.drag-over {
            background: #e7f5ff !important;
            border: 2px dashed #339af0;
            box-shadow: inset 0 0 10px rgba(51, 154, 240, 0.2);
        }
        .schedule-cell.drop-highlight {
            background: #d3f9d8 !important;
            border: 2px solid #51cf66;
        }
        .drag-ghost {
            position: fixed;
            pointer-events: none;
            z-index: 2000;
            opacity: 0.9;
            transform: rotate(3deg);
        }
        .drop-indicator {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 500;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1500;
            display: none;
            align-items: center;
            gap: 10px;
        }
        .drop-indicator.active {
            display: flex;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(20px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        /* Displaced Course Tray Sidebar */
        .displaced-tray {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 280px;
            background: white;
            box-shadow: 4px 0 20px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .displaced-tray.open {
            transform: translateX(0);
        }
        .displaced-tray-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .displaced-tray-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .displaced-count {
            background: rgba(255,255,255,0.2);
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
        }
        .displaced-tray-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            opacity: 0.8;
        }
        .displaced-tray-close:hover {
            opacity: 1;
        }
        .displaced-tray-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        .displaced-course-card {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: grab;
            transition: all 0.2s;
        }
        .displaced-course-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .displaced-course-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .displaced-course-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        .displaced-course-code {
            font-weight: 600;
            color: #1f2937;
        }
        .displaced-course-remove {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 2px;
            font-size: 1rem;
            line-height: 1;
        }
        .displaced-course-remove:hover {
            color: #ef4444;
        }
        .displaced-course-name {
            font-size: 0.85rem;
            color: #4b5563;
            margin-bottom: 6px;
        }
        .displaced-course-origin {
            font-size: 0.75rem;
            color: #9ca3af;
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        .displaced-tray-actions {
            padding: 16px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .displaced-tray-actions button {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .btn-add-course {
            color: white;
            border: none;
            font-weight: 600;
        }
        .btn-clear-all {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        .btn-clear-all:hover {
            background: #fecaca;
        }
        /* Swap Mode Toggle Switch */
        .swap-toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        .swap-toggle-label {
            font-size: 0.85rem;
            color: #6b7280;
            font-weight: 500;
        }
        .swap-toggle-label.active {
            color: #059669;
            font-weight: 600;
        }
        .swap-toggle {
            position: relative;
            width: 50px;
            height: 26px;
            cursor: pointer;
        }
        .swap-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .swap-toggle-slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #e5e7eb;
            border-radius: 26px;
            transition: 0.3s;
        }
        .swap-toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .swap-toggle input:checked + .swap-toggle-slider {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .swap-toggle input:checked + .swap-toggle-slider:before {
            transform: translateX(24px);
        }
        .displaced-tray.drag-over {
            background: #ecfdf5;
            box-shadow: 4px 0 20px rgba(16, 185, 129, 0.3);
        }
        .displaced-tray.drag-over .displaced-tray-content {
            border: 2px dashed #10b981;
            border-radius: 8px;
            margin: 8px;
        }
        .displaced-empty {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af;
        }
        .displaced-empty-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }
        /* Toggle button when tray is closed */
        .displaced-tray-toggle {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 8px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            z-index: 999;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-size: 0.85rem;
            font-weight: 500;
            box-shadow: 2px 0 10px rgba(0,0,0,0.2);
            display: none;
        }
        .displaced-tray-toggle.visible {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .displaced-tray-toggle .toggle-count {
            background: #ef4444;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            writing-mode: horizontal-tb;
        }
        /* Delete button on course blocks */
        .course-block .delete-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        .course-block:hover .delete-btn {
            opacity: 1;
        }
        .course-block .delete-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }
        /* Confirmation Modal */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .confirm-modal.active {
            display: flex;
        }
        .confirm-dialog {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .confirm-dialog h3 {
            margin: 0 0 12px 0;
            color: #1f2937;
        }
        .confirm-dialog p {
            color: #6b7280;
            margin: 0 0 20px 0;
        }
        .confirm-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        .confirm-actions button {
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
        }
        .btn-confirm-delete {
            background: #ef4444;
            color: white;
            border: none;
        }
        .btn-confirm-delete:hover {
            background: #dc2626;
        }
        .btn-confirm-cancel {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }
    </style>

    <!-- Schedule Manager Scripts -->
    <script src="js/config/constants.js"></script>
    <script src="js/schedule-manager.js"></script>
    <script src="js/data-loader.js"></script>
</head>
<body>
    <!-- Displaced Course Tray Sidebar -->
    <div class="displaced-tray" id="displacedTray" ondragover="handleTrayDragOver(event)" ondragleave="handleTrayDragLeave(event)" ondrop="handleTrayDrop(event)">
        <div class="displaced-tray-header">
            <div class="displaced-tray-title">
                Displaced Courses
                <span class="displaced-count" id="displacedCount">0</span>
            </div>
            <button class="displaced-tray-close" onclick="closeDisplacedTray()">&times;</button>
        </div>
        <div class="displaced-tray-content" id="displacedContent">
            <div class="displaced-empty">
                <div class="displaced-empty-icon">ðŸ“¦</div>
                <p>No displaced courses</p>
                <p style="font-size: 0.8rem;">Drag courses here or bump them from slots</p>
            </div>
        </div>
        <div class="displaced-tray-actions">
            <button class="btn-add-course" onclick="openAddCourseModal()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-bottom: 8px;">+ Add Course</button>
            <button class="btn-clear-all" onclick="clearAllDisplaced()">Clear All</button>
        </div>
    </div>

    <!-- Toggle button for closed tray -->
    <button class="displaced-tray-toggle" id="displacedToggle" onclick="openDisplacedTray()">
        <span class="toggle-count" id="toggleCount">0</span>
        Displaced
    </button>

    <!-- Delete Confirmation Modal -->
    <div class="confirm-modal" id="deleteConfirmModal">
        <div class="confirm-dialog">
            <h3>Delete Course</h3>
            <p id="deleteConfirmText">Are you sure you want to remove this course from the schedule?</p>
            <div class="confirm-actions">
                <button class="btn-confirm-cancel" onclick="closeDeleteConfirm()">Cancel</button>
                <button class="btn-confirm-delete" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Design Scheduler</h1>
            <p class="subtitle">Visual Course Scheduling & Conflict Detection Tool</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="quarterSelect">Select Quarter:</label>
                <select id="quarterSelect">
                    <option value="fall">Fall 2025</option>
                    <option value="winter">Winter 2026</option>
                    <option value="spring" selected>Spring 2026</option>
                </select>
            </div>

            <div class="control-group">
                <label for="courseFilter">Filter by Course:</label>
                <select id="courseFilter">
                    <option value="all">All Courses</option>
                    <option value="DESN 401">DESN 401 - Imaginary Worlds</option>
                    <option value="DESN 463">DESN 463 - Community Design</option>
                    <option value="DESN 379">DESN 379 - Web Dev 2</option>
                </select>
            </div>

            <div class="control-group">
                <label for="roomFilter">Filter by Room:</label>
                <select id="roomFilter">
                    <option value="all">All Rooms</option>
                    <option value="206">206 UX Lab</option>
                    <option value="207">207 Media Lab</option>
                    <option value="209">209 Mac Lab</option>
                    <option value="210">210 Mac Lab</option>
                    <option value="212">212 Project Lab</option>
                    <option value="CEB">CEB Rooms</option>
                </select>
            </div>

            <div class="control-group">
                <label for="minorFilter">Filter by Minor:</label>
                <select id="minorFilter">
                    <option value="all">All Courses</option>
                    <option value="ux">UX/Interaction Design</option>
                    <option value="animation">Animation</option>
                    <option value="gameDesign">Game Design</option>
                    <option value="graphicDesign">Graphic Design</option>
                    <option value="photography">Photography</option>
                    <option value="webDevelopment">Web Development</option>
                </select>
            </div>

            <div class="control-group">
                <label for="trackFilter">Student Track:</label>
                <select id="trackFilter">
                    <option value="all">All Tracks</option>
                    <option value="ux">UX Design</option>
                    <option value="interaction-design">Interaction Design</option>
                    <option value="web-development">Web Development</option>
                    <option value="animation">Animation</option>
                    <option value="game-design">Game Design</option>
                    <option value="motion">Motion Design</option>
                    <option value="photography">Photography</option>
                </select>
            </div>

        </div>

        <!-- Dashboard Navigation -->
        <div class="dashboard-nav">
            <div class="nav-accordion-toggle" onclick="toggleNavAccordion()">
                <span>ðŸ“Œ Dashboards & Tools</span>
                <span class="toggle-icon">â–¼</span>
            </div>
            <div class="nav-accordion-content" id="navAccordionContent">
                <!-- Analytics Row -->
                <div class="nav-row">
                    <span class="nav-row-header">Analytics</span>
                    <div class="nav-row-items">
                        <a href="enrollment-dashboard.html" class="nav-link"><span class="icon">ðŸ“Š</span>Enrollment</a>
                        <a href="pages/workload-dashboard.html" class="nav-link"><span class="icon">ðŸ‘¥</span>Workload</a>
                        <a href="pages/capacity-planning-dashboard.html" class="nav-link"><span class="icon">ðŸ“ˆ</span>Capacity</a>
                        <a href="pages/applied-learning-dashboard.html" class="nav-link"><span class="icon">ðŸŽ“</span>Applied Learning</a>
                    </div>
                </div>
                <!-- Planning Row -->
                <div class="nav-row">
                    <span class="nav-row-header">Planning</span>
                    <div class="nav-row-items">
                        <a href="pages/schedule-builder.html" class="nav-link"><span class="icon">ðŸ“…</span>Builder</a>
                        <a href="pages/course-management.html" class="nav-link"><span class="icon">ðŸ“š</span>Courses</a>
                        <a href="pages/workload-dashboard.html" class="nav-link"><span class="icon">ðŸ‘¥</span>Workload</a>
                        <a href="pages/constraints-dashboard.html" class="nav-link"><span class="icon">ðŸ”’</span>Constraints</a>
                        <a href="pages/demand-planning-dashboard.html" class="nav-link"><span class="icon">âš¡</span>Demand</a>
                    </div>
                </div>
                <!-- Tools Row -->
                <div class="nav-row">
                    <span class="nav-row-header">Tools</span>
                    <div class="nav-row-items">
                        <button onclick="highlightConflicts()" class="nav-link"><span class="icon">ðŸ”</span>Conflicts</button>
                        <button onclick="exportReport()" class="nav-link"><span class="icon">ðŸ“‹</span>Export</button>
                        <a href="pages/release-time-dashboard.html" class="nav-link"><span class="icon">ðŸ”§</span>Release Time</a>
                        <a href="pages/recommendations-dashboard.html" class="nav-link"><span class="icon">ðŸ’¡</span>Recommendations</a>
                    </div>
                </div>
            </div>
        </div>

        <div style="background: #e7f5ff; border-left: 4px solid #339af0; padding: 12px 16px; margin: 20px; border-radius: 8px; font-size: 0.9em;">
            <strong>ðŸ“Š Enrollment Data:</strong> Course enrollment badges show previous year's same-quarter enrollment.
            Example: <span style="background: #51cf66; color: white; padding: 2px 8px; border-radius: 12px; font-weight: 600;">ðŸ‘¥ 22 ('25)</span> means 22 students enrolled in this course during the same quarter in 2025.
        </div>

        <div class="stats-bar">
            <div class="stat-card critical">
                <div class="stat-number" id="criticalConflicts">3</div>
                <div class="stat-label">Critical Conflicts</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-number" id="totalConflicts">7</div>
                <div class="stat-label">Total Conflicts</div>
            </div>
            <div class="stat-card info">
                <div class="stat-number" id="totalCourses">15</div>
                <div class="stat-label">Total Courses</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="utilizationRate">78%</div>
                <div class="stat-label">Room Utilization</div>
            </div>
        </div>

        <div class="content">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff5f5; border: 2px solid #ff6b6b;"></div>
                    <span>Critical Conflict (3+ courses)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff3e0; border: 2px solid #ffa726;"></div>
                    <span>High Conflict (2 courses)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e9ecef; border: 2px solid #adb5bd;"></div>
                    <span>No Conflict</span>
                </div>
            </div>

            <div class="faculty-legend">
                <div class="faculty-legend-item" onclick="showFacultyModal('T.Masingale')">
                    <div class="faculty-color-bar" style="background: #667eea;"></div>
                    <span>T.Masingale</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('S.Durr')">
                    <div class="faculty-color-bar" style="background: #e67e22;"></div>
                    <span>S.Durr</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('C.Manikoth')">
                    <div class="faculty-color-bar" style="background: #27ae60;"></div>
                    <span>C.Manikoth</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('S.Mills')">
                    <div class="faculty-color-bar" style="background: #9b59b6;"></div>
                    <span>S.Mills</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('M.Lybbert')">
                    <div class="faculty-color-bar" style="background: #e74c3c;"></div>
                    <span>M.Lybbert</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('G.Hustrulid')">
                    <div class="faculty-color-bar" style="background: #f39c12;"></div>
                    <span>G.Hustrulid</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('A.Sopu')">
                    <div class="faculty-color-bar" style="background: #3498db;"></div>
                    <span>A.Sopu</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('E.Norris')">
                    <div class="faculty-color-bar" style="background: #1abc9c;"></div>
                    <span>E.Norris</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('J.Braukmann')">
                    <div class="faculty-color-bar" style="background: #34495e;"></div>
                    <span>J.Braukmann</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('S.Allison')">
                    <div class="faculty-color-bar" style="background: #d35400;"></div>
                    <span>S.Allison</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('Online')">
                    <div class="faculty-color-bar" style="background: #7f8c8d;"></div>
                    <span>Barton/Pettigrew (Online)</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('Adjunct')">
                    <div class="faculty-color-bar" style="background: #95a5a6;"></div>
                    <span>Adjunct</span>
                </div>
                <div class="faculty-legend-item" onclick="showFacultyModal('TBD')">
                    <div class="faculty-color-bar" style="background: #bdc3c7;"></div>
                    <span>TBD</span>
                </div>
            </div>

            <div id="minorInfoPanel"></div>
            <div id="trackSuggestionsPanel"></div>

            <div id="enrollmentAnalytics"></div>

            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #495057;">Schedule Grid - <span id="quarterTitle">Spring 2026</span></h2>
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div class="swap-toggle-container" title="When ON: Dropping a course onto an occupied slot swaps them. When OFF: The existing course goes to the displaced tray.">
                        <span class="swap-toggle-label" id="displaceLabel">Displace</span>
                        <label class="swap-toggle">
                            <input type="checkbox" id="swapModeToggle" onchange="updateSwapModeLabels()">
                            <span class="swap-toggle-slider"></span>
                        </label>
                        <span class="swap-toggle-label" id="swapLabel">Swap</span>
                    </div>
                    <button onclick="openAddCourseModal()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                        <span style="font-size: 1.2em;">+</span> Add Course
                    </button>
                </div>
            </div>
            <div class="schedule-grid" id="scheduleGrid"></div>

            <div class="special-sections-grid">
                <div id="onlineSection"></div>
                <div id="arrangedSection"></div>
            </div>

            <div class="analysis-grid">
                <div class="conflicts-panel">
                    <h2>Detected Conflicts</h2>
                    <div id="conflictsList" style="max-height: 400px; overflow-y: auto;"></div>
                </div>

                <div class="conflict-solver-panel">
                    <h2>ðŸ”§ Resolution Options</h2>
                    <p style="color: #666; font-size: 0.85em; margin-bottom: 15px;">
                        Solutions that won't create new conflicts
                    </p>
                    <div id="conflictSolverList" style="max-height: 350px; overflow-y: auto;"></div>
                </div>
            </div>

            <div class="recommendations" style="padding: 20px;">
                <h2 style="font-size: 1.2em;">Optimization Recommendations</h2>
                <div id="recommendationsList"></div>
            </div>
        </div>
    </div>

    <script>
        // Faculty color mapping
        const facultyColors = {
            'T.Masingale': { class: 'faculty-masingale', color: '#667eea', name: 'T.Masingale' },
            'T. Masingale': { class: 'faculty-masingale', color: '#667eea', name: 'T.Masingale' },
            'S.Durr': { class: 'faculty-durr', color: '#e67e22', name: 'S.Durr' },
            'C.Manikoth': { class: 'faculty-manikoth', color: '#27ae60', name: 'C.Manikoth' },
            'Manikoth': { class: 'faculty-manikoth', color: '#27ae60', name: 'C.Manikoth' },
            'S.Mills': { class: 'faculty-mills', color: '#9b59b6', name: 'S.Mills' },
            'M.Lybbert': { class: 'faculty-lybbert', color: '#e74c3c', name: 'M.Lybbert' },
            'G.Hustrulid': { class: 'faculty-hustrulid', color: '#f39c12', name: 'G.Hustrulid' },
            'A.Sopu': { class: 'faculty-sopu', color: '#3498db', name: 'A.Sopu' },
            'E.Norris': { class: 'faculty-norris', color: '#1abc9c', name: 'E.Norris' },
            'J.Braukmann': { class: 'faculty-braukmann', color: '#34495e', name: 'J.Braukmann' },
            'S.Allison': { class: 'faculty-allison', color: '#d35400', name: 'S.Allison' },
            'Barton/Pettigrew': { class: 'faculty-online', color: '#7f8c8d', name: 'Barton/Pettigrew' },
            'Adjunct': { class: 'faculty-adjunct', color: '#95a5a6', name: 'Adjunct' },
            'TBD': { class: 'faculty-tbd', color: '#bdc3c7', name: 'TBD' }
        };

        function getFacultyClass(instructor) {
            return facultyColors[instructor]?.class || 'faculty-tbd';
        }

        // Navigation accordion toggle
        function toggleNavAccordion() {
            const toggle = document.querySelector('.nav-accordion-toggle');
            const content = document.getElementById('navAccordionContent');
            toggle.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        }

        // Faculty modal functions
        function showFacultyModal(facultyName) {
            const overlay = document.getElementById('facultyModalOverlay');
            const nameEl = document.getElementById('facultyModalName');
            const scheduleEl = document.getElementById('facultyModalSchedule');
            const statsEl = document.getElementById('facultyModalStats');
            const prefsEl = document.getElementById('facultyModalPreferences');

            // Set faculty name with color
            const facultyInfo = facultyColors[facultyName] || { color: '#6b7280', name: facultyName };
            nameEl.textContent = facultyInfo.name || facultyName;
            nameEl.style.color = facultyInfo.color;

            // Get current schedule from scheduleData
            const facultyCourses = [];
            if (typeof scheduleData !== 'undefined') {
                const quarters = ['fall', 'winter', 'spring'];
                quarters.forEach(quarter => {
                    if (scheduleData[quarter]) {
                        scheduleData[quarter].forEach(course => {
                            if (course.instructor && (course.instructor.includes(facultyName) ||
                                (facultyInfo.name && course.instructor.includes(facultyInfo.name)))) {
                                facultyCourses.push({
                                    ...course,
                                    quarter: quarter.charAt(0).toUpperCase() + quarter.slice(1)
                                });
                            }
                        });
                    }
                });
            }

            // Populate schedule
            if (facultyCourses.length > 0) {
                scheduleEl.innerHTML = facultyCourses.map(course => `
                    <div class="faculty-course-item">
                        <span class="course-code">${course.code}</span>
                        <span class="course-title">${course.title || ''}</span>
                        <span class="course-details">${course.quarter} | ${course.days || ''} ${course.time || ''}</span>
                    </div>
                `).join('');
            } else {
                scheduleEl.innerHTML = '<p style="color: #6b7280; font-style: italic;">No scheduled courses found</p>';
            }

            // Calculate workload stats
            const totalCredits = facultyCourses.reduce((sum, c) => sum + (parseInt(c.credits) || 5), 0);
            const sectionCount = facultyCourses.length;
            statsEl.innerHTML = `
                <div class="stat-item"><span class="stat-label">Total Sections:</span> <span class="stat-value">${sectionCount}</span></div>
                <div class="stat-item"><span class="stat-label">Total Credits:</span> <span class="stat-value">${totalCredits}</span></div>
            `;

            // Preferences placeholder - can be loaded from scheduling-rules.json
            prefsEl.innerHTML = `
                <div class="faculty-tags">
                    <span class="pref-tag">See Constraints Dashboard for details</span>
                </div>
                <a href="pages/constraints-dashboard.html" class="pref-link">Manage Preferences â†’</a>
            `;

            overlay.classList.add('visible');
        }

        function closeFacultyModal(event) {
            if (event && event.target !== document.getElementById('facultyModalOverlay')) return;
            document.getElementById('facultyModalOverlay').classList.remove('visible');
        }

        // Minor data structure
        const minors = {
            ux: {
                name: 'UX/Interaction Design Minor',
                courses: ['DESN 338', 'DESN 348', 'DESN 458', 'DESN 366'],
                tracks: ['ux', 'interaction-design', 'web-development'],
                color: '#e74c3c',
                typical: true
            },
            animation: {
                name: 'Animation Minor',
                courses: ['DESN 326', 'DESN 355', 'DESN 365', 'DESN 336'],
                tracks: ['animation', 'motion'],
                color: '#f39c12',
                typical: false, // UX/Interaction/Web Dev typically don't pursue this
                note: 'UX, Interaction Design, and Web Dev students typically don\'t pursue this minor'
            },
            gameDesign: {
                name: 'Game Design Minor',
                courses: ['DESN 335', 'DESN 345', 'DESN 369', 'DESN 379'],
                tracks: ['animation', 'game-design'],
                color: '#27ae60',
                typical: true,
                note: 'Animation and Game Design students may pursue this minor'
            },
            graphicDesign: {
                name: 'Graphic Design Minor',
                courses: ['DESN 243', 'DESN 263', 'DESN 360', 'DESN 463'],
                tracks: ['all'],
                color: '#3498db',
                typical: true,
                note: 'Can be picked up along the way by any track'
            },
            photography: {
                name: 'Photography Minor',
                courses: ['DESN 350', 'DESN 301'],
                tracks: ['photography', 'visual-storytelling'],
                color: '#9b59b6',
                typical: true,
                note: 'PHOTO 350 only offered in Spring',
                seasonal: { 'DESN 350': 'spring' }
            },
            webDevelopment: {
                name: 'Web Development Minor',
                courses: ['DESN 368', 'DESN 369', 'DESN 379', 'DESN 468'],
                tracks: ['web-development', 'code-design'],
                color: '#667eea',
                typical: true
            }
        };

        // Student track definitions
        const studentTracks = {
            'ux': { name: 'UX Design', suggestedMinors: ['ux', 'graphicDesign', 'webDevelopment'] },
            'interaction-design': { name: 'Interaction Design', suggestedMinors: ['ux', 'graphicDesign', 'webDevelopment'] },
            'web-development': { name: 'Web Development', suggestedMinors: ['webDevelopment', 'graphicDesign', 'ux'] },
            'animation': { name: 'Animation', suggestedMinors: ['animation', 'gameDesign', 'graphicDesign'] },
            'game-design': { name: 'Game Design', suggestedMinors: ['gameDesign', 'animation', 'graphicDesign'] },
            'motion': { name: 'Motion Design', suggestedMinors: ['animation', 'graphicDesign'] },
            'photography': { name: 'Photography', suggestedMinors: ['photography', 'graphicDesign'] },
            'visual-storytelling': { name: 'Visual Storytelling', suggestedMinors: ['photography', 'graphicDesign'] },
            'code-design': { name: 'Code + Design', suggestedMinors: ['webDevelopment', 'gameDesign', 'graphicDesign'] }
        };

        // Load dynamic enrollment data from JSON file
        let enrollmentData = {};

        async function loadEnrollmentData() {
            try {
                const response = await fetch('./enrollment-dashboard-data.json');
                if (response.ok) {
                    const data = await response.json();
                    enrollmentData = data.courseStats || {};
                    console.log('âœ… Loaded dynamic enrollment data');
                    console.log(`   Total courses: ${Object.keys(enrollmentData).length}`);
                    return true;
                }
            } catch (error) {
                console.warn('âš ï¸ Could not load enrollment-dashboard-data.json, using fallback data');
            }
            // Fallback to hardcoded data if JSON fails
            enrollmentData = fallbackEnrollmentData;
            return false;
        }

        // Fallback enrollment data (used if JSON file is not available)
        const fallbackEnrollmentData = {
            "DESN 100": {
                average: 35,
                peak: 48,
                trend: "declining",
                peakQuarter: "fall-2022",
                quarterly: {
                    "winter-2023": 38,
                    "winter-2024": 24,
                    "winter-2025": 22
                }
            },
            "DESN 200": { average: 26, peak: 44, trend: "growing", peakQuarter: "fall-2024" },
            "DESN 216": {
                average: 52,
                peak: 73,
                trend: "declining",
                peakQuarter: "fall-2022",
                quarterly: {
                    "winter-2023": { total: 38, online: 19, inPerson: 19 },
                    "winter-2024": { total: 25, online: 13, inPerson: 12 },
                    "winter-2025": { total: 22, online: 11, inPerson: 11 }
                }
            },
            "DESN 243": { average: 17, peak: 25, trend: "stable", peakQuarter: "spring-2023" },
            "DESN 263": { average: 18, peak: 25, trend: "stable", peakQuarter: "spring-2023" },
            "DESN 301": { average: 21, peak: 25, trend: "growing", peakQuarter: "fall-2024" },
            "DESN 305": { average: 22, peak: 23, trend: "stable", peakQuarter: "spring-2024" },
            "DESN 326": { average: 25, peak: 25, trend: "stable", peakQuarter: "fall-2023" },
            "DESN 335": { average: 24, peak: 24, trend: "stable", peakQuarter: "winter-2025" },
            "DESN 336": { average: 18, peak: 21, trend: "growing", peakQuarter: "spring-2025" },
            "DESN 338": { average: 20, peak: 30, trend: "declining", peakQuarter: "fall-2022" },
            "DESN 345": { average: 0, peak: 0, trend: "new", peakQuarter: "never-offered", isNew: true, note: "New course - Digital Game Design (Spring 2026)" },
            "DESN 348": { average: 16, peak: 20, trend: "stable", peakQuarter: "winter-2024" },
            "DESN 350": { average: 10, peak: 10, trend: "stable", peakQuarter: "spring" },
            "DESN 355": { average: 19, peak: 22, trend: "stable", peakQuarter: "winter-2024" },
            "DESN 359": { average: 19, peak: 24, trend: "growing", peakQuarter: "winter-2024" },
            "DESN 360": { average: 17, peak: 19, trend: "stable", peakQuarter: "winter-2025" },
            "DESN 365": { average: 15, peak: 16, trend: "stable", peakQuarter: "spring-2024" },
            "DESN 366": { average: 12, peak: 18, trend: "declining", peakQuarter: "spring-2023" },
            "DESN 368": { average: 18, peak: 20, trend: "stable", peakQuarter: "fall" },
            "DESN 369": { average: 0, peak: 0, trend: "new", peakQuarter: "never-offered", isNew: true, note: "New course - Web Dev 1 (Winter 2026)" },
            "DESN 374": { average: 22, peak: 25, trend: "stable", peakQuarter: "fall" },
            "DESN 378": { average: 15, peak: 16, trend: "stable", peakQuarter: "winter" },
            "DESN 379": { average: 0, peak: 0, trend: "new", peakQuarter: "never-offered", isNew: true, note: "New course - Web Dev 2 (Spring 2026)" },
            "DESN 384": { average: 19, peak: 24, trend: "stable", peakQuarter: "winter-2023" },
            "DESN 401": { average: 16, peak: 21, trend: "growing", peakQuarter: "winter-2025" },
            "DESN 458": { average: 12, peak: 15, trend: "stable", peakQuarter: "spring-2024" },
            "DESN 463": { average: 16, peak: 24, trend: "growing", peakQuarter: "spring-2025" },
            "DESN 468": { average: 12, peak: 13, trend: "stable", peakQuarter: "spring-2024" },
            "DESN 480": { average: 15, peak: 20, trend: "stable", peakQuarter: "winter-2023" },
            "DESN 490": { average: 15, peak: 25, trend: "growing", peakQuarter: "spring-2025" }
        };

        function getEnrollmentLevel(average) {
            if (average >= 30) return 'high';
            if (average >= 15) return 'medium';
            return 'low';
        }

        function getEnrollmentData(courseCode) {
            return enrollmentData[courseCode] || { average: 0, peak: 0, trend: "unknown", peakQuarter: "" };
        }

        const scheduleData = {
            fall: {
                'MW': {
                    '10:00-12:00': [
                        { code: 'DESN 368', name: 'Code + Design 1', room: '206', instructor: 'T.Masingale', credits: 5 },
                        { code: 'DESN 243', name: 'Typography', room: '209', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 490', name: 'Capstone', room: '210', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'A.Sopu', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 338', name: 'UX 1', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 463', name: 'Community Dr.', room: '209', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 301', name: 'Visual Storyte.', room: '210', instructor: 'S.Mills', credits: 5 },
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'CEB 102', instructor: 'A.Sopu', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'S.Allison', credits: 5 }
                    ],
                    '16:00-18:00': [
                        { code: 'DESN 366', name: 'Production Des.', room: '206', instructor: 'M.Lybbert', credits: 5 }
                    ]
                },
                'TR': {
                    '10:00-12:00': [
                        { code: 'DESN 374', name: 'AI + Design', room: '209', instructor: 'T.Masingale', credits: 5 },
                        { code: 'DESN 200', name: 'Visual Thinking', room: '210', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 359', name: 'Histories of Des.', room: 'CEB 102', instructor: 'S.Durr', credits: 5 },
                        { code: 'ITGS 110', name: 'FYE: Humanities', room: 'CEB 104', instructor: 'S.Mills', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 480', name: 'Pro. Practice', room: '206', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 326', name: 'Intro to Anim.', room: '209', instructor: 'G.Hustrulid', credits: 5 },
                        { code: 'DESN 263', name: 'VCD 1', room: '210', instructor: 'A.Sopu', credits: 5 },
                        { code: 'DESN 200', name: 'Visual Thinking', room: 'CEB 104', instructor: 'S.Mills', credits: 5 }
                    ]
                },
                'ONLINE': {
                    'async': [
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'ONLINE', instructor: 'Barton/Pettigrew', credits: 5 }
                    ]
                }
            },
            winter: {
                'MW': {
                    '10:00-12:00': [
                        { code: 'DESN 335', name: 'Board Game', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 243', name: 'Typography', room: '209', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'CEB 102', instructor: 'A.Sopu', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 348', name: 'UX 2', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 360', name: 'Zine Pubic.', room: '209', instructor: 'S.Mills', credits: 5 },
                        { code: 'DESN 480', name: 'Pro. Practice', room: '210', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'A.Sopu', credits: 5 }
                    ],
                    '16:00-18:00': [
                        { code: 'DESN 338', name: 'UX 1', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 378', name: 'Code + Design 2', room: '209', instructor: 'T. Masingale', credits: 5 }
                    ]
                },
                'TR': {
                    '10:00-12:00': [
                        { code: 'DESN 369', name: 'Web Dev. 1', room: '206', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 490', name: 'Capstone', room: '209', instructor: 'TBD', credits: 5 },
                        { code: 'DESN 359', name: 'Histories of Des.', room: '210', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 200', name: 'Visual Thinking', room: 'CEB 102', instructor: 'S.Mills', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 374', name: 'AI + Design', room: '206', instructor: 'T. Masingale', credits: 5 },
                        { code: 'DESN 355', name: 'Motion Design', room: '209', instructor: 'G.Hustrulid', credits: 5 },
                        { code: 'DESN 263', name: 'VCD 1', room: '210', instructor: 'A.Sopu', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'S.Allison', credits: 5 }
                    ],
                    '16:00-18:00': [
                        { code: 'DESN 336', name: '3D Animation', room: '209', instructor: 'Adjunct', credits: 5 }
                    ]
                },
                'ONLINE': {
                    'async': [
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'ONLINE', instructor: 'Barton/Pettigrew', credits: 5 }
                    ]
                },
                'ARRANGED': {
                    'arranged': [
                        { code: 'DESN 396', name: 'Japan Study Ab.', room: 'ARRANGED', instructor: 'M.Lybbert', credits: 5 }
                    ]
                }
            },
            spring: {
                'MW': {
                    '10:00-12:00': [
                        { code: 'DESN 305', name: 'Social Media', room: '206', instructor: 'E.Norris', credits: 5 },
                        { code: 'DESN 374', name: 'AI + Design', room: '209', instructor: 'T. Masingale', credits: 5 },
                        { code: 'DESN 490', name: 'Capstone', room: '210', instructor: 'TBD', credits: 5 },
                        { code: 'DESN 359', name: 'Histories of Des.', room: 'CEB 102', instructor: 'S.Durr', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 338', name: 'UX 1', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 345', name: 'Digital Game', room: '209', instructor: 'Manikoth', credits: 5 },
                        { code: 'DESN 263', name: 'VCD 1', room: '210', instructor: 'A.Sopu', credits: 5 },
                        { code: 'DESN 200', name: 'Visual Thinking', room: 'CEB 102', instructor: 'S.Mills', credits: 5 }
                    ],
                    '16:00-18:00': [
                        { code: 'DESN 458', name: 'UX 3', room: '206', instructor: 'M.Lybbert', credits: 5 },
                        { code: 'DESN 350', name: 'Digital Photo', room: '209', instructor: 'Adjunct', credits: 5 }
                    ]
                },
                'TR': {
                    '10:00-12:00': [
                        { code: 'DESN 379', name: 'Web Dev. 2', room: '206', instructor: 'C.Manikoth', credits: 5 },
                        { code: 'DESN 401', name: 'Imaginary Ws.', room: '209', instructor: 'S.Mills', credits: 5 },
                        { code: 'DESN 463', name: 'Community Dr.', room: '210', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'CEB 102', instructor: 'A.Sopu', credits: 5 }
                    ],
                    '13:00-15:00': [
                        { code: 'DESN 468', name: 'Code + Design 3', room: '206', instructor: 'T. Masingale', credits: 5 },
                        { code: 'DESN 365', name: 'Motion Des. 2', room: '209', instructor: 'G.Hustrulid', credits: 5 },
                        { code: 'DESN 243', name: 'Typography', room: '210', instructor: 'S.Durr', credits: 5 },
                        { code: 'DESN 384', name: 'Digital Sound', room: 'CEB 102', instructor: 'J.Braukmann', credits: 5 },
                        { code: 'DESN 100', name: 'Drawing Com.', room: 'CEB 104', instructor: 'A.Sopu', credits: 5 }
                    ]
                },
                'ONLINE': {
                    'async': [
                        { code: 'DESN 216', name: 'Digital Fdns.', room: 'ONLINE', instructor: 'Barton/Pettigrew', credits: 5 }
                    ]
                }
            }
        };

        const conflictData = {
            spring: [
                {
                    time: 'Tuesday & Thursday, 10:00 AM - 12:00 PM',
                    severity: 'critical',
                    courses: ['DESN 379 - Web Dev 2', 'DESN 401 - Imaginary Worlds', 'DESN 463 - Community Design'],
                    impact: 'Students cannot take multiple upper-division electives simultaneously',
                    affected: 'High'
                }
            ],
            fall: [
                {
                    time: 'Monday & Wednesday, 10:00 AM - 12:00 PM',
                    severity: 'high',
                    courses: ['DESN 368 - Code + Design 1', 'DESN 490 - Capstone'],
                    impact: 'Seniors in code track cannot complete both courses',
                    affected: 'High'
                },
                {
                    time: 'Monday & Wednesday, 1:00 PM - 3:00 PM',
                    severity: 'medium',
                    courses: ['DESN 338 - UX 1', 'DESN 463 - Community Design', 'DESN 301 - Visual Storytelling'],
                    impact: 'UX track students limited in elective choices',
                    affected: 'Medium'
                }
            ],
            winter: [
                {
                    time: 'Monday & Wednesday, 1:00 PM - 3:00 PM',
                    severity: 'critical',
                    courses: ['DESN 348 - UX 2', 'DESN 480 - Professional Practice'],
                    impact: 'Seniors pursuing UX minor must choose between DESN 348 (required for UX minor) and DESN 480 (required to graduate). This prevents seniors from completing both the UX minor and graduation requirements in the same quarter.',
                    affected: 'High'
                },
                {
                    time: 'Tuesday & Thursday, 10:00 AM - 12:00 PM',
                    severity: 'high',
                    courses: ['DESN 369 - Web Dev 1', 'DESN 490 - Capstone'],
                    impact: 'Web development students delayed in capstone',
                    affected: 'Medium'
                }
            ]
        };

        const recommendations = {
            spring: [
                {
                    priority: 'high',
                    title: 'Move DESN 463 to Monday/Wednesday 1-3 PM',
                    description: 'Relocating Community Design eliminates the critical three-way conflict and S. Durr has no conflicts at this time.'
                }
            ],
            fall: [
                {
                    priority: 'high',
                    title: 'Add Second Capstone Section',
                    description: 'Offer DESN 490 at Tuesday/Thursday 1-3 PM to allow seniors flexibility in completing degree requirements.'
                }
            ],
            winter: [
                {
                    priority: 'critical',
                    title: 'URGENT: Resolve DESN 348/480 Senior Graduation Conflict',
                    description: 'DESN 348 (UX 2 - UX minor requirement) conflicts with DESN 480 (Professional Practice - required to graduate). Seniors cannot complete UX minor and graduate on time. Recommendation: Move DESN 480 to TR 13:00-15:00 or offer additional DESN 348 section at different time (MW 16:00-18:00 or TR time slot).'
                },
                {
                    priority: 'high',
                    title: 'Optimize DESN 100 Winter Sections',
                    description: 'DESN 100 winter enrollment has declined from 38 (2023) to 22 (2025) students. Currently offering 2 sections, but only 1 section is needed. Consider consolidating to a single section.'
                },
                {
                    priority: 'high',
                    title: 'Review DESN 216 Winter Capacity',
                    description: 'DESN 216 winter shows declining enrollment (38â†’25â†’22 students, split 50/50 between online and in-person). The in-person section now has only ~11 students. Consider consolidating to online-only or offering in-person every other year.'
                }
            ]
        };

        /**
         * Check for imported schedule data from schedule builder
         */
        function checkForImportedSchedule() {
            // Check URL params for import flag
            const urlParams = new URLSearchParams(window.location.search);
            if (!urlParams.get('import')) return;

            const importedData = localStorage.getItem('importedScheduleData');
            if (!importedData) {
                console.log('No imported schedule data found');
                return;
            }

            try {
                const parsed = JSON.parse(importedData);
                if (parsed.source !== 'schedule-builder') return;

                console.log('Importing schedule from schedule builder:', parsed);

                // Merge imported schedule data into scheduleData
                ['fall', 'winter', 'spring'].forEach(quarter => {
                    if (parsed.scheduleData[quarter]) {
                        // Replace schedule data for this quarter
                        scheduleData[quarter] = parsed.scheduleData[quarter];
                    }
                });

                // Show import notification
                showImportNotification(parsed.academicYear, parsed.generatedAt);

                // Clear the import flag from URL without reloading
                window.history.replaceState({}, document.title, window.location.pathname);

                // Clear localStorage after import
                localStorage.removeItem('importedScheduleData');

            } catch (error) {
                console.error('Error importing schedule:', error);
            }
        }

        /**
         * Show notification about imported schedule
         */
        function showImportNotification(year, generatedAt) {
            const notification = document.createElement('div');
            notification.className = 'import-notification';
            notification.innerHTML = `
                <div class="import-notification-content">
                    <span class="import-icon">âœ“</span>
                    <span>Schedule imported for ${year} (generated ${new Date(generatedAt).toLocaleString()})</span>
                    <button onclick="this.parentElement.parentElement.remove()">Ã—</button>
                </div>
            `;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            document.body.appendChild(notification);

            // Auto-remove after 5 seconds
            setTimeout(() => notification.remove(), 5000);
        }

        function renderSchedule(quarter) {
            const grid = document.getElementById('scheduleGrid');
            const data = scheduleData[quarter];

            // Clear grid safely
            while (grid.firstChild) {
                grid.removeChild(grid.firstChild);
            }

            // Header row - create elements safely
            const headers = ['Time', '206 UX Lab', '207 Media Lab', '209 Mac Lab', '210 Mac Lab', '212 Project Lab', 'CEB 102', 'CEB 104'];
            headers.forEach(text => {
                const header = document.createElement('div');
                header.className = 'grid-header';
                header.textContent = text;
                grid.appendChild(header);
            });

            const times = ['10:00-12:00', '13:00-15:00', '16:00-18:00'];
            const days = ['MW', 'TR'];
            const rooms = ['206', '207', '209', '210', '212', 'CEB 102', 'CEB 104'];

            days.forEach((day, dayIndex) => {
                // Add divider for each day section
                const divider = document.createElement('div');
                divider.className = 'day-divider ' + (dayIndex === 0 ? 'mw' : 'tr');
                grid.appendChild(divider);

                times.forEach(time => {
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.textContent = day;
                    timeSlot.appendChild(document.createElement('br'));
                    timeSlot.appendChild(document.createTextNode(time));
                    grid.appendChild(timeSlot);

                    rooms.forEach(room => {
                        const courses = data[day] && data[day][time] ?
                            data[day][time].filter(c => c.room === room) : [];

                        const cell = document.createElement('div');
                        cell.className = 'schedule-cell drop-zone';
                        cell.dataset.day = day;
                        cell.dataset.time = time;
                        cell.dataset.room = room;

                        courses.forEach(course => {
                            const conflictLevel = courses.length > 2 ? 0 : courses.length > 1 ? 1 : 2;
                            const facultyClass = getFacultyClass(course.instructor);
                            const enrollment = getEnrollmentData(course.code);

                            // Get quarter-specific enrollment from previous year instead of overall average
                            const prevYearQuarter = quarter === 'fall' ? 'fall-2025' :
                                                   quarter === 'winter' ? 'winter-2025' :
                                                   quarter === 'spring' ? 'spring-2025' : null;

                            let displayEnrollment = enrollment.average; // fallback
                            let tooltipText = 'Avg enrollment: ' + enrollment.average;
                            let showYearIndicator = false;

                            if (prevYearQuarter && enrollment.quarterly && enrollment.quarterly[prevYearQuarter]) {
                                const prevYearData = enrollment.quarterly[prevYearQuarter];
                                displayEnrollment = typeof prevYearData === 'object' ? prevYearData.total : prevYearData;
                                tooltipText = quarter.charAt(0).toUpperCase() + quarter.slice(1) + ' 2025: ' + displayEnrollment + ' students';
                                showYearIndicator = true;
                            } else if (enrollment.isNew) {
                                displayEnrollment = 'NEW';
                                tooltipText = 'New course - no historical data';
                            }

                            const enrollmentLevel = typeof displayEnrollment === 'number' ? getEnrollmentLevel(displayEnrollment) : 'medium';
                            const trendClass = 'trend-' + enrollment.trend;

                            // Generate a course ID for editing
                            const courseId = '2025-26-' + quarter + '-' + course.code.replace(/\s+/g, '').toLowerCase() + '-001';

                            const block = document.createElement('div');
                            block.className = 'course-block conflict-' + conflictLevel + ' ' + facultyClass + ' ' + trendClass;
                            block.dataset.courseId = courseId;
                            block.dataset.quarter = quarter;
                            block.dataset.courseCode = course.code;
                            block.dataset.day = day;
                            block.dataset.time = time;
                            block.dataset.room = room;
                            block.draggable = true;
                            block.title = tooltipText + ' | Peak: ' + enrollment.peak + ' | Trend: ' + enrollment.trend + ' | Drag to move';
                            block.onclick = function(e) {
                                // Don't trigger click if we're dragging
                                if (!block.classList.contains('dragging')) {
                                    showCourseDetails(course.code, course.name, course.instructor, course.credits, course.room, courseId, quarter, day, time);
                                }
                            };

                            if (courses.length > 1) {
                                const badge = document.createElement('span');
                                badge.className = 'conflict-badge';
                                badge.textContent = courses.length;
                                block.appendChild(badge);
                            }

                            // Add delete button
                            const deleteBtn = document.createElement('button');
                            deleteBtn.className = 'delete-btn';
                            deleteBtn.innerHTML = '&times;';
                            deleteBtn.title = 'Click to delete, Shift+Click to move to tray';
                            deleteBtn.onclick = function(e) {
                                e.stopPropagation();
                                deleteCourse(course.code, day, time, course.room, e.shiftKey);
                            };
                            block.appendChild(deleteBtn);

                            const nameDiv = document.createElement('div');
                            nameDiv.className = 'course-name';
                            nameDiv.textContent = course.code + ' ';
                            const enrollBadge = document.createElement('span');
                            enrollBadge.className = 'enrollment-badge enrollment-' + enrollmentLevel;
                            enrollBadge.textContent = 'ðŸ‘¥ ' + displayEnrollment;
                            if (showYearIndicator) {
                                const yearSpan = document.createElement('span');
                                yearSpan.style.fontSize = '0.75em';
                                yearSpan.style.opacity = '0.8';
                                yearSpan.textContent = " ('25)";
                                enrollBadge.appendChild(yearSpan);
                            }
                            nameDiv.appendChild(enrollBadge);

                            const titleDiv = document.createElement('div');
                            titleDiv.className = 'course-details';
                            titleDiv.textContent = course.name;

                            const instructorDiv = document.createElement('div');
                            instructorDiv.className = 'course-details';
                            instructorDiv.textContent = course.instructor;

                            block.appendChild(nameDiv);
                            block.appendChild(titleDiv);
                            block.appendChild(instructorDiv);
                            cell.appendChild(block);
                        });

                        grid.appendChild(cell);
                    });
                });
            });

            // Setup drag-and-drop after grid is rendered
            setupDragAndDrop();
        }

        // ============================================
        // DRAG AND DROP FUNCTIONALITY
        // ============================================

        let draggedCourse = null;

        function setupDragAndDrop() {
            // Setup draggable course blocks
            document.querySelectorAll('.course-block[draggable="true"]').forEach(block => {
                block.addEventListener('dragstart', handleDragStart);
                block.addEventListener('dragend', handleDragEnd);
            });

            // Setup drop zones (schedule cells)
            document.querySelectorAll('.schedule-cell.drop-zone').forEach(cell => {
                cell.addEventListener('dragover', handleDragOver);
                cell.addEventListener('dragleave', handleDragLeave);
                cell.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedCourse = {
                element: this,
                courseId: this.dataset.courseId,
                courseCode: this.dataset.courseCode,
                quarter: this.dataset.quarter,
                originalDay: this.dataset.day,
                originalTime: this.dataset.time,
                originalRoom: this.dataset.room
            };

            this.classList.add('dragging');

            // Set transfer data
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', JSON.stringify({
                courseId: draggedCourse.courseId,
                courseCode: draggedCourse.courseCode,
                quarter: draggedCourse.quarter
            }));

            // Show drop indicator
            const indicator = document.getElementById('dropIndicator');
            document.getElementById('dropIndicatorText').textContent =
                'Dragging ' + draggedCourse.courseCode + ' - Drop on any time slot to move';
            indicator.classList.add('active');

            // Highlight all drop zones
            document.querySelectorAll('.schedule-cell.drop-zone').forEach(cell => {
                cell.style.opacity = '1';
            });
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedCourse = null;

            // Hide drop indicator
            document.getElementById('dropIndicator').classList.remove('active');

            // Remove all drag-over classes
            document.querySelectorAll('.schedule-cell').forEach(cell => {
                cell.classList.remove('drag-over');
                cell.style.opacity = '';
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';

            if (!this.classList.contains('drag-over')) {
                // Remove highlight from other cells
                document.querySelectorAll('.schedule-cell.drag-over').forEach(cell => {
                    cell.classList.remove('drag-over');
                });
                this.classList.add('drag-over');

                // Update indicator with target info
                const day = this.dataset.day;
                const time = this.dataset.time;
                const room = this.dataset.room;
                document.getElementById('dropIndicatorText').textContent =
                    'Drop to move to ' + day + ' ' + time + ' in Room ' + room;
            }
        }

        function handleDragLeave(e) {
            // Only remove if we're actually leaving this cell
            if (!this.contains(e.relatedTarget)) {
                this.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');

            if (!draggedCourse) return;

            const targetDay = this.dataset.day;
            const targetTime = this.dataset.time;
            const targetRoom = this.dataset.room;
            const quarter = document.getElementById('quarterSelect').value;
            const data = scheduleData[quarter];

            // Check if dropping from displaced tray
            if (draggedCourse.isFromDisplacedTray) {
                // Check if target cell has existing courses with same room
                if (data[targetDay] && data[targetDay][targetTime]) {
                    const existingInRoom = data[targetDay][targetTime].filter(c => c.room === targetRoom);
                    // Move existing courses to displaced tray
                    existingInRoom.forEach(existing => {
                        addToDisplacedTray({
                            code: existing.code,
                            name: existing.name,
                            instructor: existing.instructor,
                            credits: existing.credits,
                            originalDay: targetDay,
                            originalTime: targetTime,
                            originalRoom: targetRoom
                        });
                        const idx = data[targetDay][targetTime].findIndex(c => c.code === existing.code && c.room === existing.room);
                        if (idx > -1) data[targetDay][targetTime].splice(idx, 1);
                    });
                }

                // Add course from displaced tray to schedule
                if (!data[targetDay]) data[targetDay] = {};
                if (!data[targetDay][targetTime]) data[targetDay][targetTime] = [];
                data[targetDay][targetTime].push({
                    code: draggedCourse.courseCode,
                    name: draggedCourse.courseName,
                    instructor: draggedCourse.instructor || 'TBD',
                    credits: draggedCourse.credits || 5,
                    room: targetRoom
                });

                // Remove from displaced tray
                removeFromDisplacedTray(draggedCourse.displacedIndex);

                saveScheduleData(); // Persist changes
                renderSchedule(quarter);
                renderConflicts(quarter);
                updateStats(quarter);
                showToast('Placed ' + draggedCourse.courseCode + ' at ' + targetDay + ' ' + targetTime);
                return;
            }

            // Don't do anything if dropped in the same cell (for regular drag)
            if (targetDay === draggedCourse.originalDay &&
                targetTime === draggedCourse.originalTime &&
                targetRoom === draggedCourse.originalRoom) {
                showToast('Course already in this slot');
                return;
            }

            // Move the course (handles displacement)
            moveCourse(draggedCourse, targetDay, targetTime, targetRoom);
        }

        function moveCourse(course, newDay, newTime, newRoom) {
            const quarter = document.getElementById('quarterSelect').value;

            // Update local schedule data
            const data = scheduleData[quarter];

            // Find and remove from original location
            if (data[course.originalDay] && data[course.originalDay][course.originalTime]) {
                const originalCourses = data[course.originalDay][course.originalTime];
                const courseIndex = originalCourses.findIndex(c => c.code === course.courseCode);

                if (courseIndex > -1) {
                    const movedCourse = originalCourses.splice(courseIndex, 1)[0];

                    // Update course with new location
                    movedCourse.room = newRoom;

                    // Check for existing courses in target room and displace them
                    if (!data[newDay]) data[newDay] = {};
                    if (!data[newDay][newTime]) data[newDay][newTime] = [];

                    const existingInRoom = data[newDay][newTime].filter(c => c.room === newRoom);
                    const hasExisting = existingInRoom.length > 0;
                    let swappedCourse = null;

                    if (hasExisting) {
                        if (swapMode) {
                            // SWAP MODE: Move existing course to the original location
                            existingInRoom.forEach(existing => {
                                swappedCourse = { ...existing }; // Copy for toast message

                                // First, remove from target location (before changing room)
                                const idx = data[newDay][newTime].findIndex(c => c.code === existing.code && c.room === newRoom);
                                if (idx > -1) {
                                    const removedCourse = data[newDay][newTime].splice(idx, 1)[0];
                                    // Update the removed course's room to original room
                                    removedCourse.room = course.originalRoom;
                                    // Add to original location
                                    if (!data[course.originalDay]) data[course.originalDay] = {};
                                    if (!data[course.originalDay][course.originalTime]) data[course.originalDay][course.originalTime] = [];
                                    data[course.originalDay][course.originalTime].push(removedCourse);
                                }
                            });
                        } else {
                            // DISPLACE MODE: Move existing course to displaced tray
                            existingInRoom.forEach(existing => {
                                addToDisplacedTray({
                                    code: existing.code,
                                    name: existing.name,
                                    instructor: existing.instructor,
                                    credits: existing.credits,
                                    originalDay: newDay,
                                    originalTime: newTime,
                                    originalRoom: newRoom
                                });
                                // Remove from schedule
                                const idx = data[newDay][newTime].findIndex(c => c.code === existing.code && c.room === existing.room);
                                if (idx > -1) data[newDay][newTime].splice(idx, 1);
                            });
                        }
                    }

                    // Add to new location
                    data[newDay][newTime].push(movedCourse);

                    // Also update ScheduleManager if available
                    if (typeof ScheduleManager !== 'undefined') {
                        const updates = {
                            room: newRoom,
                            days: newDay === 'MW' ? ['M', 'W'] : ['T', 'Th'],
                            startTime: convertTimeSlotToStart(newTime),
                            endTime: convertTimeSlotToEnd(newTime)
                        };

                        ScheduleManager.updateCourseAssignment('2025-26', quarter, course.courseId, updates);
                    }

                    // Save and re-render the schedule
                    saveScheduleData(); // Persist changes
                    renderSchedule(quarter);
                    renderConflicts(quarter);
                    renderConflictSolver(quarter);
                    updateStats(quarter);

                    let toastMsg = 'Moved ' + course.courseCode + ' to ' + newDay + ' ' + newTime + ' Room ' + newRoom;
                    if (hasExisting) {
                        if (swapMode && swappedCourse) {
                            toastMsg += ' (swapped with ' + swappedCourse.code + ')';
                        } else {
                            toastMsg += ' (' + existingInRoom.length + ' course' + (existingInRoom.length > 1 ? 's' : '') + ' displaced)';
                        }
                    }
                    showToast(toastMsg);
                } else {
                    showToast('Could not find course to move', 'error');
                }
            } else {
                showToast('Could not find original course location', 'error');
            }
        }

        function convertTimeSlotToStart(timeSlot) {
            const start = timeSlot.split('-')[0];
            return start + ':00';
        }

        function convertTimeSlotToEnd(timeSlot) {
            const end = timeSlot.split('-')[1];
            return end + ':00';
        }

        function renderOnlineCourses(quarter) {
            const onlineSection = document.getElementById('onlineSection');
            const data = scheduleData[quarter];

            // Clear section safely
            while (onlineSection.firstChild) {
                onlineSection.removeChild(onlineSection.firstChild);
            }

            if (!data['ONLINE']) {
                return;
            }

            const onlineCourses = data['ONLINE']['async'] || [];

            if (onlineCourses.length === 0) {
                return;
            }

            const section = document.createElement('div');
            section.className = 'online-section';

            const heading = document.createElement('h3');
            heading.textContent = 'ðŸ“± Online Courses (Asynchronous)';
            section.appendChild(heading);

            const coursesContainer = document.createElement('div');
            coursesContainer.className = 'online-courses';

            onlineCourses.forEach(course => {
                const facultyClass = getFacultyClass(course.instructor);
                const block = document.createElement('div');
                block.className = 'online-course-block ' + facultyClass;

                const nameDiv = document.createElement('div');
                nameDiv.className = 'course-name';
                nameDiv.style.cssText = 'color: white; font-size: 1em; margin-bottom: 5px;';
                nameDiv.textContent = course.code;

                const titleDiv = document.createElement('div');
                titleDiv.className = 'course-details';
                titleDiv.style.color = 'rgba(255,255,255,0.9)';
                titleDiv.textContent = course.name;

                const instructorDiv = document.createElement('div');
                instructorDiv.className = 'course-details';
                instructorDiv.style.color = 'rgba(255,255,255,0.9)';
                instructorDiv.textContent = course.instructor;

                const creditsDiv = document.createElement('div');
                creditsDiv.className = 'course-details';
                creditsDiv.style.cssText = 'color: rgba(255,255,255,0.9); margin-top: 5px;';
                creditsDiv.textContent = course.credits + ' credits';

                block.appendChild(nameDiv);
                block.appendChild(titleDiv);
                block.appendChild(instructorDiv);
                block.appendChild(creditsDiv);
                coursesContainer.appendChild(block);
            });

            section.appendChild(coursesContainer);
            onlineSection.appendChild(section);
        }

        function renderArrangedCourses(quarter) {
            const arrangedSection = document.getElementById('arrangedSection');
            const data = scheduleData[quarter];

            // Clear section safely
            while (arrangedSection.firstChild) {
                arrangedSection.removeChild(arrangedSection.firstChild);
            }

            if (!data['ARRANGED']) {
                return;
            }

            const arrangedCourses = data['ARRANGED']['arranged'] || [];

            if (arrangedCourses.length === 0) {
                return;
            }

            const section = document.createElement('div');
            section.className = 'arranged-section';

            const heading = document.createElement('h3');
            heading.textContent = 'âœˆï¸ Arranged Courses (Study Abroad & Independent Study)';
            section.appendChild(heading);

            const coursesContainer = document.createElement('div');
            coursesContainer.className = 'arranged-courses';

            arrangedCourses.forEach(course => {
                const facultyClass = getFacultyClass(course.instructor);
                const block = document.createElement('div');
                block.className = 'arranged-course-block ' + facultyClass;

                const nameDiv = document.createElement('div');
                nameDiv.className = 'course-name';
                nameDiv.style.cssText = 'color: white; font-size: 1em; margin-bottom: 5px;';
                nameDiv.textContent = course.code;

                const titleDiv = document.createElement('div');
                titleDiv.className = 'course-details';
                titleDiv.style.color = 'rgba(255,255,255,0.9)';
                titleDiv.textContent = course.name;

                const instructorDiv = document.createElement('div');
                instructorDiv.className = 'course-details';
                instructorDiv.style.color = 'rgba(255,255,255,0.9)';
                instructorDiv.textContent = course.instructor;

                const creditsDiv = document.createElement('div');
                creditsDiv.className = 'course-details';
                creditsDiv.style.cssText = 'color: rgba(255,255,255,0.9); margin-top: 5px;';
                creditsDiv.textContent = course.credits + ' credits';

                block.appendChild(nameDiv);
                block.appendChild(titleDiv);
                block.appendChild(instructorDiv);
                block.appendChild(creditsDiv);
                coursesContainer.appendChild(block);
            });

            section.appendChild(coursesContainer);
            arrangedSection.appendChild(section);
        }

        // Helper: Create quarter data cell content
        function createQuarterCell(data, isNew) {
            const cell = document.createElement('td');
            if (isNew) {
                const span = document.createElement('span');
                span.style.cssText = 'color: #9b59b6; font-weight: 600;';
                span.textContent = 'NEW';
                cell.appendChild(span);
            } else if (!data) {
                cell.textContent = '-';
            } else if (typeof data === 'object' && data.total !== undefined) {
                const numSpan = document.createElement('span');
                numSpan.className = 'enrollment-number';
                numSpan.textContent = data.total;
                cell.appendChild(numSpan);
                cell.appendChild(document.createElement('br'));
                const splitSpan = document.createElement('span');
                splitSpan.className = 'enrollment-split';
                splitSpan.textContent = '(' + (data.online || '-') + ' online, ' + (data.inPerson || '-') + ' in-person)';
                cell.appendChild(splitSpan);
            } else {
                const numSpan = document.createElement('span');
                numSpan.className = 'enrollment-number';
                numSpan.textContent = data;
                cell.appendChild(numSpan);
            }
            return cell;
        }

        // Helper: Create enrollment category section
        function createEnrollmentCategory(title, subtitle, courses, type, formatFn) {
            const section = document.createElement('div');
            section.className = 'enrollment-category';

            const h3 = document.createElement('h3');
            h3.textContent = title;

            const p = document.createElement('p');
            p.style.cssText = 'color: #666; font-size: 0.9em; margin-bottom: 10px;';
            p.textContent = subtitle;

            const list = document.createElement('div');
            list.className = 'enrollment-course-list';

            courses.forEach(c => {
                const tag = document.createElement('div');
                tag.className = 'enrollment-course-tag ' + type;
                const strong = document.createElement('strong');
                strong.textContent = c.code;
                tag.appendChild(strong);
                tag.appendChild(document.createTextNode(' - ' + formatFn(c)));
                list.appendChild(tag);
            });

            section.appendChild(h3);
            section.appendChild(p);
            section.appendChild(list);
            return section;
        }

        function renderEnrollmentAnalytics(quarter) {
            const analyticsPanel = document.getElementById('enrollmentAnalytics');
            const data = scheduleData[quarter];

            // Clear safely
            while (analyticsPanel.firstChild) {
                analyticsPanel.removeChild(analyticsPanel.firstChild);
            }

            // Collect all courses from the quarter
            let allCourses = [];
            ['MW', 'TR'].forEach(day => {
                if (data[day]) {
                    ['10:00-12:00', '13:00-15:00', '16:00-18:00'].forEach(time => {
                        if (data[day][time]) {
                            allCourses = allCourses.concat(data[day][time]);
                        }
                    });
                }
            });

            if (data['ONLINE'] && data['ONLINE']['async']) {
                allCourses = allCourses.concat(data['ONLINE']['async']);
            }

            // Categorize courses
            const highEnrollment = [];
            const lowEnrollment = [];
            const decliningTrend = [];

            allCourses.forEach(course => {
                const enrollment = getEnrollmentData(course.code);
                if (enrollment.average >= 30) highEnrollment.push({ ...course, enrollment });
                if (enrollment.average < 15 && enrollment.average > 0) lowEnrollment.push({ ...course, enrollment });
                if (enrollment.trend === 'declining') decliningTrend.push({ ...course, enrollment });
            });

            const coursesWithHistory = allCourses
                .reduce((unique, course) => {
                    if (!unique.find(c => c.code === course.code)) unique.push(course);
                    return unique;
                }, [])
                .sort((a, b) => parseInt(a.code.split(' ')[1]) - parseInt(b.code.split(' ')[1]));

            const quarterName = quarter.charAt(0).toUpperCase() + quarter.slice(1);
            const q2023Key = quarter + '-2023';
            const q2024Key = quarter + '-2024';
            const q2025Key = quarter + '-2025';

            // Main container
            const container = document.createElement('div');
            container.className = 'enrollment-analytics';

            const mainTitle = document.createElement('h2');
            mainTitle.textContent = 'ðŸ“Š Enrollment Analytics - ' + quarterName + ' 2026';
            container.appendChild(mainTitle);

            // Per-Class Enrollment History (collapsible)
            if (coursesWithHistory.length > 0) {
                const historySection = document.createElement('div');
                historySection.className = 'quarterly-enrollment';

                const accordionHeader = document.createElement('h3');
                accordionHeader.style.cssText = 'cursor: pointer; user-select: none; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;';

                const headerText = document.createElement('span');
                headerText.textContent = 'ðŸ“ˆ Per-Class Enrollment History ';
                const countSpan = document.createElement('span');
                countSpan.style.cssText = 'font-size: 0.8em; color: #666; font-weight: normal;';
                countSpan.textContent = '(' + coursesWithHistory.length + ' courses)';
                headerText.appendChild(countSpan);

                const arrow = document.createElement('span');
                arrow.className = 'accordion-arrow';
                arrow.style.fontSize = '0.8em';
                arrow.textContent = 'â–¶';

                accordionHeader.appendChild(headerText);
                accordionHeader.appendChild(arrow);

                const contentDiv = document.createElement('div');
                contentDiv.style.display = 'none';

                accordionHeader.onclick = function() {
                    if (contentDiv.style.display === 'none') {
                        contentDiv.style.display = 'block';
                        arrow.textContent = 'â–¼';
                    } else {
                        contentDiv.style.display = 'none';
                        arrow.textContent = 'â–¶';
                    }
                };

                const historyDesc = document.createElement('p');
                historyDesc.style.cssText = 'color: #666; font-size: 0.9em; margin-bottom: 15px;';
                historyDesc.textContent = 'Historical enrollment data for ' + quarterName + ' quarter courses';

                const table = document.createElement('table');
                table.className = 'enrollment-history-table';

                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                ['Course', 'Course Name', 'Instructor', quarterName + ' 2023', quarterName + ' 2024', quarterName + ' 2025', 'Trend'].forEach(text => {
                    const th = document.createElement('th');
                    th.textContent = text;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                const tbody = document.createElement('tbody');
                coursesWithHistory.forEach(c => {
                    const enrollment = getEnrollmentData(c.code);
                    const quarterly = enrollment.quarterly || {};
                    const row = document.createElement('tr');

                    // Course code cell
                    const codeCell = document.createElement('td');
                    const codeStrong = document.createElement('strong');
                    codeStrong.textContent = c.code;
                    codeCell.appendChild(codeStrong);
                    if (enrollment.isNew) {
                        const badge = document.createElement('span');
                        badge.className = 'course-note-badge';
                        badge.textContent = 'NEW';
                        codeCell.appendChild(badge);
                    }

                    const nameCell = document.createElement('td');
                    nameCell.textContent = c.name;

                    const instructorCell = document.createElement('td');
                    instructorCell.textContent = c.instructor;

                    const trendCell = document.createElement('td');
                    const trendIcon = enrollment.trend === 'declining' ? 'ðŸ“‰' : enrollment.trend === 'growing' ? 'ðŸ“ˆ' : enrollment.trend === 'new' ? 'âœ¨' : 'âž¡ï¸';
                    trendCell.textContent = trendIcon + ' ' + enrollment.trend;

                    row.appendChild(codeCell);
                    row.appendChild(nameCell);
                    row.appendChild(instructorCell);
                    row.appendChild(createQuarterCell(quarterly[q2023Key], enrollment.isNew));
                    row.appendChild(createQuarterCell(quarterly[q2024Key], enrollment.isNew));
                    row.appendChild(createQuarterCell(quarterly[q2025Key], enrollment.isNew));
                    row.appendChild(trendCell);
                    tbody.appendChild(row);
                });

                table.appendChild(thead);
                table.appendChild(tbody);
                contentDiv.appendChild(historyDesc);
                contentDiv.appendChild(table);
                historySection.appendChild(accordionHeader);
                historySection.appendChild(contentDiv);
                container.appendChild(historySection);
            }

            // High Demand section
            if (highEnrollment.length > 0) {
                container.appendChild(createEnrollmentCategory(
                    'ðŸ”´ High Demand Courses (30+ students)',
                    'These courses may need larger rooms or additional sections',
                    highEnrollment,
                    'high',
                    c => 'Avg: ' + c.enrollment.average + ' | Peak: ' + c.enrollment.peak
                ));
            }

            // Low Enrollment section
            if (lowEnrollment.length > 0) {
                container.appendChild(createEnrollmentCategory(
                    'ðŸŸ¢ Low Enrollment Courses (<15 students)',
                    'Consider consolidation or review offering frequency',
                    lowEnrollment,
                    'low',
                    c => 'Avg: ' + c.enrollment.average + ' | Instructor: ' + c.instructor
                ));
            }

            // Declining Trend section
            if (decliningTrend.length > 0) {
                container.appendChild(createEnrollmentCategory(
                    'âš ï¸ Declining Enrollment Trends',
                    'Courses showing declining enrollment patterns',
                    decliningTrend,
                    'declining',
                    c => 'Avg: ' + c.enrollment.average + ' | Trend: ' + c.enrollment.trend + ' â†˜'
                ));
            }

            analyticsPanel.appendChild(container);
        }

        function renderConflicts(quarter) {
            const conflictsList = document.getElementById('conflictsList');
            const conflicts = conflictData[quarter] || [];

            // Clear safely
            while (conflictsList.firstChild) {
                conflictsList.removeChild(conflictsList.firstChild);
            }

            if (conflicts.length === 0) {
                const noConflicts = document.createElement('p');
                noConflicts.style.cssText = 'color: #51cf66; font-weight: 600;';
                noConflicts.textContent = 'No major conflicts detected for this quarter!';
                conflictsList.appendChild(noConflicts);
                return;
            }

            conflicts.forEach(conflict => {
                const item = document.createElement('div');
                item.className = 'conflict-item ' + conflict.severity;

                const header = document.createElement('div');
                header.className = 'conflict-header';

                const timeSpan = document.createElement('span');
                timeSpan.className = 'conflict-time';
                timeSpan.textContent = conflict.time;

                const severityBadge = document.createElement('span');
                severityBadge.className = 'severity-badge ' + conflict.severity;
                severityBadge.textContent = conflict.severity;

                header.appendChild(timeSpan);
                header.appendChild(severityBadge);

                const impactP = document.createElement('p');
                impactP.style.cssText = 'margin: 10px 0; color: #495057;';
                impactP.textContent = conflict.impact;

                const affectedP = document.createElement('p');
                affectedP.style.cssText = 'margin: 10px 0; color: #6c757d; font-size: 0.9em;';
                const affectedStrong = document.createElement('strong');
                affectedStrong.textContent = 'Students Affected:';
                affectedP.appendChild(affectedStrong);
                affectedP.appendChild(document.createTextNode(' ' + conflict.affected));

                const coursesDiv = document.createElement('div');
                coursesDiv.className = 'conflict-courses';
                conflict.courses.forEach(course => {
                    const tag = document.createElement('span');
                    tag.className = 'conflict-course-tag';
                    tag.textContent = course;
                    coursesDiv.appendChild(tag);
                });

                item.appendChild(header);
                item.appendChild(impactP);
                item.appendChild(affectedP);
                item.appendChild(coursesDiv);
                conflictsList.appendChild(item);
            });
        }

        function renderConflictSolver(quarter) {
            const solverList = document.getElementById('conflictSolverList');
            const data = scheduleData[quarter];

            // Build schedule matrix from current quarter data
            const scheduleMatrix = {};
            const days = ['MW', 'TR'];
            const times = ['10:00-12:00', '13:00-15:00', '16:00-18:00'];

            days.forEach(day => {
                times.forEach(time => {
                    const key = `${day} ${time}`;
                    const courses = data[day] && data[day][time] ? data[day][time] : [];
                    scheduleMatrix[key] = courses.map(c => `${c.code} (${c.room})`);
                });
            });

            // Define conflicts that need automated resolution
            const conflictsToSolve = [];

            // Winter: DESN 348/480 conflict
            if (quarter === 'winter') {
                conflictsToSolve.push({
                    name: 'DESN 348 / DESN 480 Conflict',
                    description: 'Both courses scheduled MW 13:00-15:00. Seniors cannot complete UX minor and graduate on time.',
                    affectedStudents: 17,
                    currentSlot: 'MW 13:00-15:00',
                    courseToMove: 'DESN 480 (Professional Practice)',
                    instructor: 'C.Manikoth',
                    alternativeSlots: [
                        'TR 16:00-18:00',
                        'MW 16:00-18:00',
                        'TR 13:00-15:00',
                        'TR 10:00-12:00'
                    ]
                });
            }

            // Spring: TR 10-12 three-way conflict
            if (quarter === 'spring') {
                conflictsToSolve.push({
                    name: 'Spring TR 10-12 Three-Way Conflict',
                    description: 'DESN 379, DESN 401, and DESN 463 all at TR 10:00-12:00. Students cannot take multiple desired upper-division courses.',
                    affectedStudents: 46,
                    currentSlot: 'TR 10:00-12:00',
                    courseToMove: 'DESN 463 (Community Design)',
                    instructor: 'S.Durr',
                    alternativeSlots: [
                        'MW 13:00-15:00',
                        'MW 16:00-18:00',
                        'TR 13:00-15:00',
                        'TR 16:00-18:00'
                    ]
                });
            }

            // Clear safely
            while (solverList.firstChild) {
                solverList.removeChild(solverList.firstChild);
            }

            if (conflictsToSolve.length === 0) {
                const noConflicts = document.createElement('p');
                noConflicts.style.cssText = 'color: #51cf66; font-weight: 600;';
                noConflicts.textContent = 'âœ“ No urgent conflicts requiring automated resolution for this quarter.';
                solverList.appendChild(noConflicts);
                return;
            }

            // Analyze solutions for each conflict
            conflictsToSolve.forEach(conflict => {
                const solutions = conflict.alternativeSlots.map(slot => {
                    const existingCourses = scheduleMatrix[slot] || [];
                    const roomsUsed = existingCourses.length;
                    const roomsAvailable = 6 - roomsUsed;

                    const wouldCreateConflict = roomsUsed >= 4;
                    const hasSpace = roomsAvailable > 0;

                    const instructorConflict = existingCourses.some(course =>
                        course.includes(conflict.instructor) ||
                        course.includes(conflict.instructor.split('.')[1])
                    );

                    let status = 'viable';
                    let recommendation = 'âœ… RECOMMENDED';

                    if (instructorConflict) {
                        status = 'blocked';
                        recommendation = 'âŒ Instructor conflict';
                    } else if (!hasSpace) {
                        status = 'blocked';
                        recommendation = 'âŒ No rooms available';
                    } else if (wouldCreateConflict) {
                        status = 'warning';
                        recommendation = 'âš ï¸ May create new conflict';
                    } else if (roomsUsed <= 2) {
                        recommendation = 'âœ… BEST OPTION';
                    }

                    return { slot, existingCourses, roomsAvailable, status, recommendation, instructorConflict };
                }).sort((a, b) => {
                    if (a.status === 'viable' && b.status !== 'viable') return -1;
                    if (b.status === 'viable' && a.status !== 'viable') return 1;
                    return b.roomsAvailable - a.roomsAvailable;
                });

                const card = document.createElement('div');
                card.className = 'conflict-solution-card';

                const title = document.createElement('h3');
                title.textContent = conflict.name;

                const infoP = document.createElement('p');
                infoP.style.cssText = 'color: #666; margin-bottom: 15px;';
                const impactStrong = document.createElement('strong');
                impactStrong.textContent = 'Impact:';
                infoP.appendChild(impactStrong);
                infoP.appendChild(document.createTextNode(' ' + conflict.affectedStudents + ' students affected'));
                infoP.appendChild(document.createElement('br'));
                const issueStrong = document.createElement('strong');
                issueStrong.textContent = 'Issue:';
                infoP.appendChild(issueStrong);
                infoP.appendChild(document.createTextNode(' ' + conflict.description));
                infoP.appendChild(document.createElement('br'));
                const slotStrong = document.createElement('strong');
                slotStrong.textContent = 'Current Slot:';
                infoP.appendChild(slotStrong);
                infoP.appendChild(document.createTextNode(' ' + conflict.currentSlot));

                const analysisH4 = document.createElement('h4');
                analysisH4.style.cssText = 'margin-top: 15px; margin-bottom: 10px; color: #495057;';
                analysisH4.textContent = 'Automated Solutions Analysis:';

                const matrixP = document.createElement('p');
                matrixP.style.cssText = 'font-size: 0.9em; color: #666; margin-bottom: 15px;';
                matrixP.appendChild(document.createTextNode('Matrix analysis for moving '));
                const courseStrong = document.createElement('strong');
                courseStrong.textContent = conflict.courseToMove;
                matrixP.appendChild(courseStrong);
                matrixP.appendChild(document.createTextNode(' (' + conflict.instructor + '):'));

                card.appendChild(title);
                card.appendChild(infoP);
                card.appendChild(analysisH4);
                card.appendChild(matrixP);

                solutions.forEach(sol => {
                    const option = document.createElement('div');
                    option.className = 'solution-option' + (sol.status === 'blocked' ? ' creates-conflict' : sol.status === 'warning' ? ' warning' : '');

                    const recDiv = document.createElement('div');
                    recDiv.className = 'solution-recommendation';
                    recDiv.textContent = sol.recommendation + ' Move to ' + sol.slot;

                    const detailsDiv = document.createElement('div');
                    detailsDiv.className = 'solution-details';
                    const schedStrong = document.createElement('strong');
                    schedStrong.textContent = 'Currently scheduled:';
                    detailsDiv.appendChild(schedStrong);
                    detailsDiv.appendChild(document.createTextNode(' ' + (sol.existingCourses.length > 0 ? sol.existingCourses.join(', ') : 'EMPTY SLOT')));
                    detailsDiv.appendChild(document.createElement('br'));
                    const roomsStrong = document.createElement('strong');
                    roomsStrong.textContent = 'Rooms available:';
                    detailsDiv.appendChild(roomsStrong);
                    detailsDiv.appendChild(document.createTextNode(' ' + sol.roomsAvailable + ' of 6'));
                    detailsDiv.appendChild(document.createElement('br'));

                    if (sol.instructorConflict) {
                        const warnSpan = document.createElement('span');
                        warnSpan.style.color = '#ff6b6b';
                        warnSpan.textContent = 'âš ï¸ Instructor already teaching at this time';
                        detailsDiv.appendChild(warnSpan);
                    }
                    if (sol.status === 'viable' && sol.roomsAvailable >= 4) {
                        const okSpan = document.createElement('span');
                        okSpan.style.color = '#51cf66';
                        okSpan.textContent = 'âœ“ Minimal impact, plenty of space';
                        detailsDiv.appendChild(okSpan);
                    }

                    option.appendChild(recDiv);
                    option.appendChild(detailsDiv);
                    card.appendChild(option);
                });

                solverList.appendChild(card);
            });
        }

        function renderRecommendations(quarter) {
            const recList = document.getElementById('recommendationsList');
            const recs = recommendations[quarter] || [];

            // Clear safely
            while (recList.firstChild) {
                recList.removeChild(recList.firstChild);
            }

            if (recs.length === 0) {
                const noRecs = document.createElement('p');
                noRecs.textContent = 'No specific recommendations for this quarter.';
                recList.appendChild(noRecs);
                return;
            }

            recs.forEach(rec => {
                const item = document.createElement('div');
                let className = 'recommendation-item';
                if (rec.priority === 'critical') className += ' priority-critical';
                else if (rec.priority === 'high') className += ' priority-high';
                item.className = className;

                const title = document.createElement('h3');
                title.textContent = rec.title;

                const desc = document.createElement('p');
                desc.textContent = rec.description;

                item.appendChild(title);
                item.appendChild(desc);
                recList.appendChild(item);
            });
        }

        function updateStats(quarter) {
            const data = scheduleData[quarter];
            const conflicts = conflictData[quarter] || [];

            let totalCourses = 0;
            Object.values(data).forEach(dayData => {
                Object.values(dayData).forEach(timeSlot => {
                    totalCourses += timeSlot.length;
                });
            });

            const criticalConflicts = conflicts.filter(c => c.severity === 'critical').length;

            // Calculate room utilization (excluding room 207 - Media Lab flex space)
            const rooms = ['206', '209', '210', '212', 'CEB 102', 'CEB 104']; // Excluding 207
            const times = ['10:00-12:00', '13:00-15:00', '16:00-18:00'];
            const days = ['MW', 'TR'];

            let totalSlots = 0;
            let filledSlots = 0;

            days.forEach(day => {
                if (data[day]) {
                    times.forEach(time => {
                        if (data[day][time]) {
                            rooms.forEach(room => {
                                totalSlots++;
                                const coursesInRoom = data[day][time].filter(c => c.room === room);
                                if (coursesInRoom.length > 0) {
                                    filledSlots++;
                                }
                            });
                        }
                    });
                }
            });

            const utilizationRate = totalSlots > 0 ? Math.round((filledSlots / totalSlots) * 100) : 0;

            document.getElementById('criticalConflicts').textContent = criticalConflicts;
            document.getElementById('totalConflicts').textContent = conflicts.length;
            document.getElementById('totalCourses').textContent = totalCourses;
            document.getElementById('utilizationRate').textContent = utilizationRate + '%';
        }

        function isCourseInMinor(courseCode, minorKey) {
            return minors[minorKey].courses.includes(courseCode);
        }

        function displayMinorInfo(minorKey) {
            const panel = document.getElementById('minorInfoPanel');

            // Clear safely
            while (panel.firstChild) {
                panel.removeChild(panel.firstChild);
            }

            if (minorKey === 'all') {
                return;
            }

            const minor = minors[minorKey];

            const infoPanel = document.createElement('div');
            infoPanel.className = 'minor-info-panel';

            const title = document.createElement('h3');
            title.textContent = minor.name;

            const reqText = document.createElement('p');
            reqText.textContent = 'Required Courses:';

            const coursesDiv = document.createElement('div');
            coursesDiv.className = 'minor-courses';
            minor.courses.forEach(course => {
                const tag = document.createElement('div');
                tag.className = 'minor-course-tag';
                tag.textContent = course;
                coursesDiv.appendChild(tag);
            });

            infoPanel.appendChild(title);
            infoPanel.appendChild(reqText);
            infoPanel.appendChild(coursesDiv);

            if (minor.note) {
                const noteDiv = document.createElement('div');
                noteDiv.className = 'minor-note';
                noteDiv.textContent = minor.note;
                infoPanel.appendChild(noteDiv);
            }

            panel.appendChild(infoPanel);
        }

        function displayTrackSuggestions(trackKey) {
            const panel = document.getElementById('trackSuggestionsPanel');

            // Clear safely
            while (panel.firstChild) {
                panel.removeChild(panel.firstChild);
            }

            if (trackKey === 'all') {
                return;
            }

            const track = studentTracks[trackKey];
            const suggestedMinors = track.suggestedMinors.map(minorKey => {
                const minor = minors[minorKey];
                return {
                    key: minorKey,
                    name: minor.name,
                    typical: minor.typical
                };
            });

            const container = document.createElement('div');
            container.className = 'suggested-minors';

            const title = document.createElement('h3');
            title.textContent = 'Suggested Minors for ' + track.name + ' Students';

            const list = document.createElement('div');
            list.className = 'minor-list';

            suggestedMinors.forEach(m => {
                const chip = document.createElement('div');
                chip.className = 'minor-chip' + (!m.typical ? ' not-typical' : '');
                chip.textContent = m.name;
                chip.onclick = function() { selectMinor(m.key); };
                list.appendChild(chip);
            });

            container.appendChild(title);
            container.appendChild(list);
            panel.appendChild(container);
        }

        function selectMinor(minorKey) {
            document.getElementById('minorFilter').value = minorKey;
            document.getElementById('minorFilter').dispatchEvent(new Event('change'));
        }

        function highlightMinorCourses(minorKey) {
            const courseBlocks = document.querySelectorAll('.course-block');
            courseBlocks.forEach(block => {
                block.classList.remove('minor-highlight');
            });

            if (minorKey !== 'all') {
                courseBlocks.forEach(block => {
                    const courseCode = block.querySelector('.course-name').textContent;
                    if (isCourseInMinor(courseCode, minorKey)) {
                        block.classList.add('minor-highlight');
                    }
                });
            }
        }

        // Current course being viewed/edited
        let currentCourseData = null;

        function showCourseDetails(code, name, instructor, credits, room, courseId, quarter, day, time) {
            // Store course data for edit modal
            currentCourseData = { code, name, instructor, credits, room, courseId, quarter, day, time };

            // Format day/time for display
            const dayDisplay = day || 'TBD';
            const timeDisplay = time || 'TBD';

            // Build details content
            const content = document.getElementById('courseDetailsContent');
            content.innerHTML = `
                <p><strong>Course:</strong> ${code} - ${name || 'N/A'}</p>
                <p><strong>Instructor:</strong> ${instructor || 'TBD'}</p>
                <p><strong>Credits:</strong> ${credits || 'N/A'}</p>
                <p><strong>Days:</strong> ${dayDisplay}</p>
                <p><strong>Time:</strong> ${timeDisplay}</p>
                <p><strong>Room:</strong> ${room || 'TBD'}</p>
            `;

            document.getElementById('detailsModalTitle').textContent = code;
            document.getElementById('courseDetailsModal').classList.add('active');
        }

        function closeCourseDetailsModal() {
            document.getElementById('courseDetailsModal').classList.remove('active');
            currentCourseData = null;
        }

        function openEditModal() {
            if (!currentCourseData) return;

            // Close details modal
            document.getElementById('courseDetailsModal').classList.remove('active');

            // Fill edit form with current data
            document.getElementById('editCourseId').value = currentCourseData.courseId || '';
            document.getElementById('editCourseCode').value = currentCourseData.code || '';
            document.getElementById('editSection').value = '001';
            document.getElementById('editCredits').value = currentCourseData.credits || 5;

            // Set year and quarter
            document.getElementById('editYear').value = '2025-26'; // Current academic year
            document.getElementById('editQuarter').value = currentCourseData.quarter || 'spring';

            // Default enrollment cap is 24 for most courses
            const specialCaps = { 'DESN 399': 5, 'DESN 491': 10, 'DESN 495': 15, 'DESN 499': 10 };
            const defaultCap = specialCaps[currentCourseData.code] || 24;
            document.getElementById('editEnrollmentCap').value = defaultCap;
            document.getElementById('editRoom').value = currentCourseData.room || '';
            document.getElementById('editNotes').value = '';

            // Parse time slot (e.g., "10:00-12:00" -> start: "10:00", end: "12:00")
            let startTime = '';
            let endTime = '';
            if (currentCourseData.time) {
                const timeParts = currentCourseData.time.split('-');
                if (timeParts.length === 2) {
                    startTime = timeParts[0];
                    endTime = timeParts[1];
                }
            }
            document.getElementById('editStartTime').value = startTime;
            document.getElementById('editEndTime').value = endTime;

            // Clear day checkboxes first
            ['M', 'T', 'W', 'Th', 'F'].forEach(day => {
                const cb = document.getElementById('editDay' + day);
                if (cb) cb.checked = false;
            });

            // Set day checkboxes based on current day pattern (e.g., "MW" -> M, W checked)
            if (currentCourseData.day) {
                const dayPattern = currentCourseData.day;
                if (dayPattern === 'MW') {
                    document.getElementById('editDayM').checked = true;
                    document.getElementById('editDayW').checked = true;
                } else if (dayPattern === 'TR') {
                    document.getElementById('editDayT').checked = true;
                    document.getElementById('editDayTh').checked = true;
                } else {
                    // Handle other patterns by checking matching days
                    if (dayPattern.includes('M')) document.getElementById('editDayM').checked = true;
                    if (dayPattern.includes('T') && !dayPattern.includes('Th')) document.getElementById('editDayT').checked = true;
                    if (dayPattern.includes('W')) document.getElementById('editDayW').checked = true;
                    if (dayPattern.includes('Th')) document.getElementById('editDayTh').checked = true;
                    if (dayPattern.includes('F')) document.getElementById('editDayF').checked = true;
                }
            }

            // Set faculty dropdown - find matching option
            const facultySelect = document.getElementById('editFaculty');
            const instructorValue = currentCourseData.instructor || '';
            let facultyFound = false;

            // Normalize instructor name for matching (handle various formats)
            const normalizeInstructor = (name) => {
                if (!name) return '';
                return name.toLowerCase().replace(/[^a-z]/g, '');
            };

            const normalizedInstructor = normalizeInstructor(instructorValue);

            for (let i = 0; i < facultySelect.options.length; i++) {
                const optionValue = facultySelect.options[i].value;
                const optionText = facultySelect.options[i].text;

                // Try exact match first
                if (optionValue === instructorValue || optionText === instructorValue) {
                    facultySelect.selectedIndex = i;
                    facultyFound = true;
                    break;
                }

                // Try normalized match (handles "T.Masingale" vs "Travis Masingale")
                const normalizedOption = normalizeInstructor(optionValue);
                const normalizedOptionText = normalizeInstructor(optionText);

                if (normalizedOption && normalizedInstructor.includes(normalizedOption.slice(-6)) ||
                    normalizedOptionText && normalizedInstructor.includes(normalizedOptionText.slice(-6))) {
                    facultySelect.selectedIndex = i;
                    facultyFound = true;
                    break;
                }

                // Check if last names match
                const instructorLastName = instructorValue.split(' ').pop()?.toLowerCase() || '';
                const optionLastName = optionText.split(' ').pop()?.toLowerCase() || '';
                if (instructorLastName && optionLastName && instructorLastName === optionLastName) {
                    facultySelect.selectedIndex = i;
                    facultyFound = true;
                    break;
                }
            }

            // If still not found, try to add the instructor as a custom option
            if (!facultyFound && instructorValue && instructorValue !== 'TBD') {
                console.log('Instructor not found in dropdown:', instructorValue);
                // Set to first matching partial or leave as placeholder
                facultySelect.selectedIndex = 0;
            }

            // Try to get more data from ScheduleManager if available
            if (typeof ScheduleManager !== 'undefined' && currentCourseData.courseId) {
                const schedule = ScheduleManager.getQuarterSchedule('2025-26', currentCourseData.quarter);
                const course = schedule.find(c => c.id === currentCourseData.courseId);
                if (course) {
                    document.getElementById('editSection').value = course.section || '001';
                    // Only override enrollment cap if ScheduleManager has one set
                    if (course.enrollmentCap) {
                        document.getElementById('editEnrollmentCap').value = course.enrollmentCap;
                    }
                    document.getElementById('editNotes').value = course.notes || '';
                    // Override with ScheduleManager data if available
                    if (course.startTime) document.getElementById('editStartTime').value = course.startTime;
                    if (course.endTime) document.getElementById('editEndTime').value = course.endTime;
                    if (course.days && Array.isArray(course.days)) {
                        // Clear and reset days
                        ['M', 'T', 'W', 'Th', 'F'].forEach(day => {
                            const cb = document.getElementById('editDay' + day);
                            if (cb) cb.checked = false;
                        });
                        course.days.forEach(day => {
                            const cb = document.getElementById('editDay' + day);
                            if (cb) cb.checked = true;
                        });
                    }
                }
            }

            // Open edit modal
            document.getElementById('courseEditModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('courseEditModal').classList.remove('active');
        }

        function getEditSelectedDays() {
            const days = [];
            ['M', 'T', 'W', 'Th', 'F'].forEach(day => {
                const cb = document.getElementById('editDay' + day);
                if (cb && cb.checked) days.push(day);
            });
            return days;
        }

        function handleEditFormSubmit(e) {
            e.preventDefault();

            const courseId = document.getElementById('editCourseId').value;
            const year = document.getElementById('editYear').value;
            // Capitalize quarter to match ScheduleManager format (e.g., "fall" -> "Fall")
            const quarterRaw = document.getElementById('editQuarter').value;
            const quarter = quarterRaw.charAt(0).toUpperCase() + quarterRaw.slice(1);

            const updates = {
                section: document.getElementById('editSection').value,
                credits: parseInt(document.getElementById('editCredits').value) || 5,
                enrollmentCap: parseInt(document.getElementById('editEnrollmentCap').value) || 24,
                assignedFaculty: document.getElementById('editFaculty').value || null,
                room: document.getElementById('editRoom').value || null,
                days: getEditSelectedDays(),
                startTime: document.getElementById('editStartTime').value || null,
                endTime: document.getElementById('editEndTime').value || null,
                notes: document.getElementById('editNotes').value || null
            };

            if (typeof ScheduleManager !== 'undefined' && courseId) {
                const result = ScheduleManager.updateCourseAssignment(year, quarter, courseId, updates);
                if (result.success) {
                    showToast('Course updated successfully');
                    closeEditModal();
                    // Refresh the schedule view
                    const currentQuarter = document.getElementById('quarterSelect').value;
                    renderSchedule(currentQuarter);
                    renderOnlineCourses(currentQuarter);
                    renderArrangedCourses(currentQuarter);
                } else {
                    showToast(result.errors.join(', '), 'error');
                }
            } else {
                showToast('Changes saved locally');
                closeEditModal();
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.style.background = type === 'error' ? '#dc3545' : '#1f2937';
            toast.classList.add('visible');
            setTimeout(() => {
                toast.classList.remove('visible');
            }, 3000);
        }

        function highlightConflicts() {
            alert('Conflicts are highlighted in red (3+ courses) and orange (2 courses) in the schedule grid!');
        }

        function exportReport() {
            alert('Export functionality would generate a PDF report with full conflict analysis and recommendations.');
        }

        // Event listeners
        document.getElementById('quarterSelect').addEventListener('change', function() {
            const quarter = this.value;
            document.getElementById('quarterTitle').textContent = quarter.charAt(0).toUpperCase() + quarter.slice(1) + ' 2026';
            renderSchedule(quarter);
            renderOnlineCourses(quarter);
            renderArrangedCourses(quarter);
            renderEnrollmentAnalytics(quarter);
            renderConflicts(quarter);
            renderConflictSolver(quarter);
            renderRecommendations(quarter);
            updateStats(quarter);

            // Re-apply minor filter if active
            const minorFilter = document.getElementById('minorFilter').value;
            if (minorFilter !== 'all') {
                highlightMinorCourses(minorFilter);
            }
        });

        document.getElementById('minorFilter').addEventListener('change', function() {
            const minorKey = this.value;
            displayMinorInfo(minorKey);
            highlightMinorCourses(minorKey);
        });

        document.getElementById('trackFilter').addEventListener('change', function() {
            const trackKey = this.value;
            displayTrackSuggestions(trackKey);
        });

        // ============================================
        // DISPLACED COURSES TRAY
        // ============================================

        let displacedCourses = [];
        let courseToDelete = null;
        let swapMode = false; // false = displace, true = swap

        // Update swap mode labels when toggle changes
        function updateSwapModeLabels() {
            swapMode = document.getElementById('swapModeToggle').checked;
            document.getElementById('displaceLabel').classList.toggle('active', !swapMode);
            document.getElementById('swapLabel').classList.toggle('active', swapMode);
            // Save preference
            localStorage.setItem('swapMode', swapMode ? 'true' : 'false');
        }

        // Load swap mode preference
        function loadSwapMode() {
            const saved = localStorage.getItem('swapMode');
            swapMode = saved === 'true';
            document.getElementById('swapModeToggle').checked = swapMode;
            updateSwapModeLabels();
        }

        // Load displaced courses from localStorage
        function loadDisplacedCourses() {
            const saved = localStorage.getItem('displacedCourses');
            if (saved) {
                displacedCourses = JSON.parse(saved);
                updateDisplacedTray();
            }
        }

        // Save displaced courses to localStorage
        function saveDisplacedCourses() {
            localStorage.setItem('displacedCourses', JSON.stringify(displacedCourses));
        }

        // Add a course to the displaced tray
        function addToDisplacedTray(course) {
            displacedCourses.push(course);
            saveDisplacedCourses();
            updateDisplacedTray();
            openDisplacedTray();
        }

        // Remove a course from displaced tray
        function removeFromDisplacedTray(index) {
            displacedCourses.splice(index, 1);
            saveDisplacedCourses();
            updateDisplacedTray();
        }

        // Clear all displaced courses
        function clearAllDisplaced() {
            displacedCourses = [];
            saveDisplacedCourses();
            updateDisplacedTray();
            closeDisplacedTray();
        }

        // Update the displaced tray display
        function updateDisplacedTray() {
            const content = document.getElementById('displacedContent');
            const countBadge = document.getElementById('displacedCount');
            const toggleCount = document.getElementById('toggleCount');
            const toggle = document.getElementById('displacedToggle');

            countBadge.textContent = displacedCourses.length;
            toggleCount.textContent = displacedCourses.length;

            // Show/hide toggle button
            if (displacedCourses.length > 0) {
                toggle.classList.add('visible');
            } else {
                toggle.classList.remove('visible');
            }

            if (displacedCourses.length === 0) {
                content.innerHTML = `
                    <div class="displaced-empty">
                        <div class="displaced-empty-icon">ðŸ“¦</div>
                        <p>No displaced courses</p>
                        <p style="font-size: 0.8rem;">Courses bumped from their slots will appear here</p>
                    </div>
                `;
                return;
            }

            content.innerHTML = displacedCourses.map((course, index) => `
                <div class="displaced-course-card" draggable="true"
                     data-displaced-index="${index}"
                     data-course-code="${course.code}"
                     ondragstart="handleDisplacedDragStart(event, ${index})"
                     ondragend="handleDisplacedDragEnd(event)">
                    <div class="displaced-course-header">
                        <span class="displaced-course-code">${course.code}</span>
                        <button class="displaced-course-remove" onclick="removeFromDisplacedTray(${index})" title="Remove">&times;</button>
                    </div>
                    <div class="displaced-course-name">${course.name || ''}</div>
                    <div class="displaced-course-origin">was at: ${course.originalDay} ${course.originalTime}, Room ${course.originalRoom}</div>
                </div>
            `).join('');
        }

        // Open displaced tray
        function openDisplacedTray() {
            document.getElementById('displacedTray').classList.add('open');
            document.getElementById('displacedToggle').classList.remove('visible');
        }

        // Close displaced tray
        function closeDisplacedTray() {
            document.getElementById('displacedTray').classList.remove('open');
            if (displacedCourses.length > 0) {
                document.getElementById('displacedToggle').classList.add('visible');
            }
        }

        // Handle drag start from displaced tray
        function handleDisplacedDragStart(e, index) {
            const course = displacedCourses[index];
            e.target.classList.add('dragging');

            draggedCourse = {
                element: e.target,
                courseCode: course.code,
                courseName: course.name,
                instructor: course.instructor,
                credits: course.credits,
                isFromDisplacedTray: true,
                displacedIndex: index,
                originalDay: course.originalDay,
                originalTime: course.originalTime,
                originalRoom: course.originalRoom
            };

            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', JSON.stringify(draggedCourse));

            // Show drop indicator
            const indicator = document.getElementById('dropIndicator');
            document.getElementById('dropIndicatorText').textContent =
                'Dragging ' + course.code + ' - Drop on schedule to place';
            indicator.classList.add('active');
        }

        // Handle drag end from displaced tray
        function handleDisplacedDragEnd(e) {
            e.target.classList.remove('dragging');
            document.getElementById('dropIndicator').classList.remove('active');
            document.querySelectorAll('.schedule-cell').forEach(cell => {
                cell.classList.remove('drag-over');
            });
        }

        // Handle drag over the displaced tray (to drop courses into it)
        function handleTrayDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            document.getElementById('displacedTray').classList.add('drag-over');
            // Auto-open tray when dragging over
            openDisplacedTray();
        }

        // Handle drag leave from displaced tray
        function handleTrayDragLeave(e) {
            // Only remove if leaving the tray entirely
            if (!e.currentTarget.contains(e.relatedTarget)) {
                document.getElementById('displacedTray').classList.remove('drag-over');
            }
        }

        // Handle drop onto displaced tray
        function handleTrayDrop(e) {
            e.preventDefault();
            document.getElementById('displacedTray').classList.remove('drag-over');

            if (!draggedCourse || draggedCourse.isFromDisplacedTray) return;

            const quarter = document.getElementById('quarterSelect').value;
            const data = scheduleData[quarter];

            // Remove course from schedule and add to tray
            if (data[draggedCourse.originalDay] && data[draggedCourse.originalDay][draggedCourse.originalTime]) {
                const courses = data[draggedCourse.originalDay][draggedCourse.originalTime];
                const courseIndex = courses.findIndex(c => c.code === draggedCourse.courseCode);

                if (courseIndex > -1) {
                    const course = courses.splice(courseIndex, 1)[0];
                    addToDisplacedTray({
                        code: course.code,
                        name: course.name,
                        instructor: course.instructor,
                        credits: course.credits,
                        originalDay: draggedCourse.originalDay,
                        originalTime: draggedCourse.originalTime,
                        originalRoom: draggedCourse.originalRoom
                    });

                    renderSchedule(quarter);
                    renderConflicts(quarter);
                    updateStats(quarter);
                    showToast(course.code + ' moved to displaced tray');
                }
            }

            // Clear dragged course
            draggedCourse = null;
            document.getElementById('dropIndicator').classList.remove('active');
        }

        // ============================================
        // DELETE COURSE FUNCTIONALITY
        // ============================================

        function deleteCourse(courseCode, day, time, room, shiftKey) {
            if (shiftKey) {
                // Shift+Click: Move to displaced tray
                const data = scheduleData[document.getElementById('quarterSelect').value];
                if (data[day] && data[day][time]) {
                    const courseIndex = data[day][time].findIndex(c => c.code === courseCode && c.room === room);
                    if (courseIndex > -1) {
                        const course = data[day][time][courseIndex];
                        addToDisplacedTray({
                            code: course.code,
                            name: course.name,
                            instructor: course.instructor,
                            credits: course.credits,
                            originalDay: day,
                            originalTime: time,
                            originalRoom: room
                        });
                        data[day][time].splice(courseIndex, 1);
                        saveScheduleData(); // Persist changes
                        renderSchedule(document.getElementById('quarterSelect').value);
                        showToast(courseCode + ' moved to displaced tray');
                    }
                }
            } else {
                // Regular click: Show confirmation dialog
                courseToDelete = { courseCode, day, time, room };
                document.getElementById('deleteConfirmText').textContent =
                    'Are you sure you want to permanently remove ' + courseCode + ' from the schedule?';
                document.getElementById('deleteConfirmModal').classList.add('active');
            }
        }

        function confirmDelete() {
            if (!courseToDelete) return;

            const { courseCode, day, time, room } = courseToDelete;
            const quarter = document.getElementById('quarterSelect').value;
            const data = scheduleData[quarter];

            if (data[day] && data[day][time]) {
                const courseIndex = data[day][time].findIndex(c => c.code === courseCode && c.room === room);
                if (courseIndex > -1) {
                    data[day][time].splice(courseIndex, 1);
                    saveScheduleData(); // Persist changes
                    renderSchedule(quarter);
                    renderConflicts(quarter);
                    updateStats(quarter);
                    showToast(courseCode + ' removed from schedule');
                }
            }

            closeDeleteConfirm();
        }

        function closeDeleteConfirm() {
            document.getElementById('deleteConfirmModal').classList.remove('active');
            courseToDelete = null;
        }

        // ============================================
        // ADD COURSE FUNCTIONALITY
        // ============================================

        function openAddCourseModal() {
            document.getElementById('addCourseForm').reset();
            document.getElementById('addDayM').checked = true;
            document.getElementById('addDayW').checked = true;
            document.getElementById('addCourseModal').classList.add('active');
        }

        function closeAddCourseModal() {
            document.getElementById('addCourseModal').classList.remove('active');
        }

        function getAddSelectedDays() {
            const days = [];
            ['M', 'T', 'W', 'Th', 'F'].forEach(day => {
                const cb = document.getElementById('addDay' + day);
                if (cb && cb.checked) days.push(day);
            });
            return days;
        }

        function handleAddCourseSubmit(e) {
            e.preventDefault();

            const courseCode = document.getElementById('addCourseCode').value;
            const courseName = document.getElementById('addCourseCode').options[document.getElementById('addCourseCode').selectedIndex].text.split(' - ')[1] || '';
            const section = document.getElementById('addSection').value;
            const credits = parseInt(document.getElementById('addCredits').value);
            const instructor = document.getElementById('addFaculty').value || 'TBD';
            const days = getAddSelectedDays();
            const startTime = document.getElementById('addStartTime').value;
            const endTime = document.getElementById('addEndTime').value;
            const room = document.getElementById('addRoom').value;

            // Determine day pattern (MW or TR)
            const dayPattern = (days.includes('M') || days.includes('W')) ? 'MW' : 'TR';
            const timeSlot = startTime.replace(':', '') === '1000' ? '10:00-12:00' :
                            startTime.replace(':', '') === '1300' ? '13:00-15:00' : '16:00-18:00';

            const quarter = document.getElementById('quarterSelect').value;
            const data = scheduleData[quarter];

            // Ensure structure exists
            if (!data[dayPattern]) data[dayPattern] = {};
            if (!data[dayPattern][timeSlot]) data[dayPattern][timeSlot] = [];

            // Add the course
            data[dayPattern][timeSlot].push({
                code: courseCode,
                name: courseName,
                instructor: instructor,
                credits: credits,
                room: room
            });

            closeAddCourseModal();
            saveScheduleData(); // Save to localStorage
            renderSchedule(quarter);
            renderConflicts(quarter);
            updateStats(quarter);
            showToast(courseCode + ' added to schedule');
        }

        // Schedule data persistence
        function saveScheduleData() {
            try {
                localStorage.setItem('designSchedulerData', JSON.stringify(scheduleData));
                console.log('Schedule data saved to localStorage');
            } catch (e) {
                console.warn('Could not save schedule data:', e);
            }
        }

        function loadScheduleData() {
            try {
                const saved = localStorage.getItem('designSchedulerData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // Merge saved data into scheduleData
                    for (const quarter of ['fall', 'winter', 'spring']) {
                        if (parsed[quarter]) {
                            scheduleData[quarter] = parsed[quarter];
                        }
                    }
                    console.log('Schedule data loaded from localStorage');
                    return true;
                }
            } catch (e) {
                console.warn('Could not load schedule data:', e);
            }
            return false;
        }

        function clearScheduleData() {
            localStorage.removeItem('designSchedulerData');
            showToast('Schedule data cleared - refresh to reset');
        }

        // Initialize app - load data then render
        // Faculty data from workload-data.json
        let facultyList = [];

        async function loadFacultyData() {
            try {
                const response = await fetch('workload-data.json');
                if (response.ok) {
                    const data = await response.json();
                    if (data.facultyWorkload) {
                        facultyList = Object.keys(data.facultyWorkload).sort();
                        populateFacultyDropdowns();
                    }
                }
            } catch (error) {
                console.warn('Could not load faculty data:', error);
            }
        }

        function populateFacultyDropdowns() {
            const addFacultySelect = document.getElementById('addFaculty');
            const editFacultySelect = document.getElementById('editFaculty');

            // Clear existing options except first placeholder
            [addFacultySelect, editFacultySelect].forEach(select => {
                if (!select) return;
                // Keep first option (placeholder)
                while (select.options.length > 1) {
                    select.remove(1);
                }
                // Add faculty options
                facultyList.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    select.appendChild(option);
                });
                // Add TBD option at end
                const tbdOption = document.createElement('option');
                tbdOption.value = 'TBD';
                tbdOption.textContent = 'TBD';
                select.appendChild(tbdOption);
            });
        }

        async function init() {
            await loadEnrollmentData();
            await loadFacultyData();

            // Load saved schedule data from localStorage
            loadScheduleData();

            // Check for imported schedule from schedule builder
            checkForImportedSchedule();

            // Initialize ScheduleManager for editing
            if (typeof ScheduleManager !== 'undefined') {
                await ScheduleManager.init({ catalogPath: 'data/course-catalog.json' });
                console.log('ScheduleManager initialized');
            }

            // Load displaced courses from localStorage
            loadDisplacedCourses();

            // Load swap mode preference
            loadSwapMode();

            // Initial render
            renderSchedule('spring');
            renderOnlineCourses('spring');
            renderArrangedCourses('spring');
            renderEnrollmentAnalytics('spring');
            renderConflicts('spring');
            renderConflictSolver('spring');
            renderRecommendations('spring');
            updateStats('spring');
        }

        // Start the app when page loads
        init();
    </script>

    <!-- Course Details Modal -->
    <div class="modal-overlay" id="courseDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="detailsModalTitle">Course Details</h2>
                <button class="modal-close" onclick="closeCourseDetailsModal()">&times;</button>
            </div>
            <div class="course-details-content" id="courseDetailsContent">
                <!-- Filled dynamically -->
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeCourseDetailsModal()">Close</button>
                <button class="btn-primary" id="editCourseBtn" onclick="openEditModal()">Edit Course</button>
            </div>
        </div>
    </div>

    <!-- Edit Course Modal -->
    <div class="modal-overlay" id="courseEditModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Edit Course</h2>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>

            <form id="editCourseForm" onsubmit="handleEditFormSubmit(event)">
                <input type="hidden" id="editCourseId">

                <div class="modal-body">
                    <div class="form-input-group">
                        <div class="form-group">
                            <label class="form-label">Course Code</label>
                            <input type="text" id="editCourseCode" class="form-input" readonly style="background: #f3f4f6;">
                        </div>

                        <div class="form-group">
                            <label for="editSection" class="form-label">Section</label>
                            <input type="text" id="editSection" class="form-input" maxlength="3">
                        </div>
                    </div>

                    <div class="form-input-group">
                        <div class="form-group">
                            <label for="editYear" class="form-label">Academic Year</label>
                            <select id="editYear" class="form-select">
                                <option value="2025-26">2025-26</option>
                                <option value="2026-27">2026-27</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="editQuarter" class="form-label">Quarter</label>
                            <select id="editQuarter" class="form-select">
                                <option value="fall">Fall</option>
                                <option value="winter">Winter</option>
                                <option value="spring">Spring</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="editCredits" class="form-label">Credits</label>
                            <input type="number" id="editCredits" class="form-input" min="1" max="15" step="1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editEnrollmentCap" class="form-label">Enrollment Cap</label>
                        <input type="number" id="editEnrollmentCap" class="form-input" min="1" max="100" step="1">
                    </div>

                    <div class="form-group">
                        <label for="editFaculty" class="form-label">Faculty</label>
                        <select id="editFaculty" class="form-select">
                            <option value="">Select Instructor...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Days</label>
                        <div style="display: flex; gap: 12px; margin-top: 6px;">
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayM" value="M"> M
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayT" value="T"> T
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayW" value="W"> W
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayTh" value="Th"> Th
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="editDayF" value="F"> F
                            </label>
                        </div>
                    </div>

                    <div class="form-input-group">
                        <div class="form-group">
                            <label for="editStartTime" class="form-label">Start Time</label>
                            <input type="time" id="editStartTime" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="editEndTime" class="form-label">End Time</label>
                            <input type="time" id="editEndTime" class="form-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editRoom" class="form-label">Room</label>
                        <input type="text" id="editRoom" class="form-input" placeholder="e.g., CEB 242">
                    </div>

                    <div class="form-group">
                        <label for="editNotes" class="form-label">Notes</label>
                        <textarea id="editNotes" class="form-input" rows="2" placeholder="Optional notes..."></textarea>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div class="modal-overlay" id="addCourseModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Add Course to Schedule</h2>
                <button class="modal-close" onclick="closeAddCourseModal()">&times;</button>
            </div>

            <form id="addCourseForm" onsubmit="handleAddCourseSubmit(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="addCourseCode" class="form-label">Course</label>
                        <select id="addCourseCode" class="form-select" required>
                            <option value="">Select Course...</option>
                            <option value="DESN 100">DESN 100 - Drawing for Communication</option>
                            <option value="DESN 200">DESN 200 - Visual Thinking + Making</option>
                            <option value="DESN 216">DESN 216 - Digital Foundations</option>
                            <option value="DESN 243">DESN 243 - Typography</option>
                            <option value="DESN 263">DESN 263 - Visual Communication Design</option>
                            <option value="DESN 301">DESN 301 - Visual Storytelling</option>
                            <option value="DESN 326">DESN 326 - Introduction to Animation</option>
                            <option value="DESN 338">DESN 338 - UX Design 1</option>
                            <option value="DESN 348">DESN 348 - UX Design 2</option>
                            <option value="DESN 355">DESN 355 - Motion Design</option>
                            <option value="DESN 359">DESN 359 - Histories of Design</option>
                            <option value="DESN 368">DESN 368 - Code + Design 1</option>
                            <option value="DESN 369">DESN 369 - Web Development 1</option>
                            <option value="DESN 378">DESN 378 - Code + Design 2</option>
                            <option value="DESN 379">DESN 379 - Web Development 2</option>
                            <option value="DESN 458">DESN 458 - UX Design 3</option>
                            <option value="DESN 463">DESN 463 - Community-Driven Design</option>
                            <option value="DESN 468">DESN 468 - Code + Design 3</option>
                            <option value="DESN 480">DESN 480 - Professional Practice</option>
                            <option value="DESN 490">DESN 490 - Senior Capstone</option>
                        </select>
                    </div>

                    <div class="form-input-group">
                        <div class="form-group">
                            <label for="addSection" class="form-label">Section</label>
                            <input type="text" id="addSection" class="form-input" value="001" maxlength="3" required>
                        </div>

                        <div class="form-group">
                            <label for="addCredits" class="form-label">Credits</label>
                            <input type="number" id="addCredits" class="form-input" value="5" min="1" max="15" step="1" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="addFaculty" class="form-label">Instructor</label>
                        <select id="addFaculty" class="form-select">
                            <option value="">Select Instructor...</option>
                            <option value="T.Masingale">T.Masingale</option>
                            <option value="S.Durr">S.Durr</option>
                            <option value="C.Manikoth">C.Manikoth</option>
                            <option value="S.Mills">S.Mills</option>
                            <option value="M.Lybbert">M.Lybbert</option>
                            <option value="G.Hustrulid">G.Hustrulid</option>
                            <option value="A.Sopu">A.Sopu</option>
                            <option value="E.Norris">E.Norris</option>
                            <option value="J.Braukmann">J.Braukmann</option>
                            <option value="S.Allison">S.Allison</option>
                            <option value="TBD">TBD</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Days</label>
                        <div style="display: flex; gap: 12px; margin-top: 6px;">
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="addDayM" value="M" checked> M
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="addDayT" value="T"> T
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="addDayW" value="W" checked> W
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="addDayTh" value="Th"> Th
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                                <input type="checkbox" id="addDayF" value="F"> F
                            </label>
                        </div>
                    </div>

                    <div class="form-input-group">
                        <div class="form-group">
                            <label for="addStartTime" class="form-label">Start Time</label>
                            <select id="addStartTime" class="form-select" required>
                                <option value="10:00">10:00 AM</option>
                                <option value="13:00">1:00 PM</option>
                                <option value="16:00">4:00 PM</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="addEndTime" class="form-label">End Time</label>
                            <select id="addEndTime" class="form-select" required>
                                <option value="12:00">12:00 PM</option>
                                <option value="15:00">3:00 PM</option>
                                <option value="18:00">6:00 PM</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="addRoom" class="form-label">Room</label>
                        <select id="addRoom" class="form-select" required>
                            <option value="">Select Room...</option>
                            <option value="206">206 - UX Lab</option>
                            <option value="207">207 - Media Lab</option>
                            <option value="209">209 - Mac Lab</option>
                            <option value="210">210 - Mac Lab</option>
                            <option value="212">212 - Project Lab</option>
                            <option value="CEB 102">CEB 102</option>
                            <option value="CEB 104">CEB 104</option>
                        </select>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeAddCourseModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Add to Schedule</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Drop Indicator -->
    <div class="drop-indicator" id="dropIndicator">
        <span id="dropIndicatorText">Drop to move course</span>
    </div>

    <!-- Faculty Modal -->
    <div class="faculty-modal-overlay" id="facultyModalOverlay" onclick="closeFacultyModal(event)">
        <div class="faculty-modal" onclick="event.stopPropagation()">
            <div class="faculty-modal-header">
                <h3 id="facultyModalName">Faculty Name</h3>
                <button class="faculty-modal-close" onclick="closeFacultyModal()">&times;</button>
            </div>
            <div class="faculty-modal-body">
                <div class="faculty-modal-section">
                    <h4>Current Schedule</h4>
                    <div id="facultyModalSchedule">
                        <!-- Schedule items will be populated by JavaScript -->
                    </div>
                </div>
                <div class="faculty-modal-section">
                    <h4>Workload Summary</h4>
                    <div class="faculty-modal-stats" id="facultyModalStats">
                        <!-- Stats will be populated by JavaScript -->
                    </div>
                </div>
                <div class="faculty-modal-section">
                    <h4>Preferences</h4>
                    <div id="facultyModalPreferences">
                        <!-- Preferences will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span id="toastMessage">Changes saved</span>
    </div>
</body>
</html>
